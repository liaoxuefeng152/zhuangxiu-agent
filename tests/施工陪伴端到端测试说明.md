# 施工陪伴完整端到端测试说明

## 测试脚本

`test_construction_e2e_full.py` - 施工陪伴完整端到端测试

## 测试流程

### 1. 用户登录
- 使用开发环境mock登录

### 2. 设置开工日期
- 调用 `POST /constructions/start-date`
- 设置开工日期（默认明天）
- 初始化所有阶段（S00-S05）的进度计划

### 3. S00阶段 - 材料进场人工核对
- 获取材料清单：`GET /material-checks/material-list`
- 提交材料核对：`POST /material-checks/submit`
- 更新S00阶段状态为 `checked`

### 4. S01-S05阶段验收
对每个阶段（S01-S05）执行：
1. 上传验收照片：`POST /acceptance/upload-photo`（每个阶段2张）
2. 提交验收分析：`POST /acceptance/analyze`
3. 更新阶段状态为 `completed`

### 5. 查看验收报告
- 调用 `GET /acceptance/list`
- 显示所有验收报告列表
- 按阶段、严重程度、状态分类显示

### 6. 查看施工照片
- 调用 `GET /construction-photos`
- 显示所有施工照片
- 按阶段分组显示

### 7. 查看台账报告
- 调用 `GET /acceptance/list`（验收报告汇总）
- 按阶段统计：总数、通过数、需整改数

## 运行方法

```bash
cd tests
python3 test_construction_e2e_full.py
```

## 测试数据

- **测试照片**: `tests/fixtures/acceptance-photo.png`
- **材料清单**: 从报价单/合同自动同步，如果没有则使用模拟数据

## 预期结果

### 验收报告列表
- 应能看到S01-S05各阶段的验收报告
- 每个报告包含：阶段、严重程度、状态、创建时间

### 施工照片列表
- 应能看到所有上传的验收照片
- 按阶段分组显示

### 台账报告统计
- 应能看到各阶段的统计信息
- 总数、通过数、需整改数

## 前端验证

测试完成后，在前端验证：

1. **我的数据 → 验收报告**
   - 应能看到所有验收报告
   - 可以点击查看详情

2. **我的数据 → 台账报告**
   - 应能看到台账统计
   - 按阶段显示汇总信息

3. **我的数据 → 施工照片**
   - 应能看到所有施工照片
   - 按阶段分组显示

## 注意事项

1. **阶段顺序**: S00（材料核对）必须在S01之前完成
2. **照片上传**: 每个阶段至少需要1张照片才能提交验收
3. **状态更新**: 每个阶段完成后需要更新阶段状态
4. **流程互锁**: 前置阶段未完成时，后续阶段会被锁定

## 测试报告

测试完成后会自动生成Markdown格式的测试报告：
- `tests/construction_e2e_report_YYYYMMDD_HHMMSS.md`

报告包含：
- 完整的测试流程记录
- 各阶段验收结果
- 验收报告列表
- 施工照片统计
- 台账报告统计
- 数据验证结果
