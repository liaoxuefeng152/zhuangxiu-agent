# 施工陪伴页（P09）测试用例

**页面标识**：P09 施工陪伴页（核心页）  
**版本**：V2.6.3  
**覆盖需求**：FR-011 ~ FR-018、FR-012a、FR-029 ~ FR-031  
**测试类型**：功能点验证 + 端到端测试

---

## 一、前置条件

| 条件 | 说明 |
|------|------|
| 登录状态 | 需已登录（有 access_token） |
| 网络 | 可访问后端 API（如 http://120.26.201.61:8001/api/v1） |
| 环境 | 微信开发者工具 或 真机预览 |

---

## 二、功能点测试用例

### 2.1 页面展示与加载（FR-011、FR-012）

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-001 | 首次加载-未设置开工日期 | P0 | 新用户/未设置开工日期 | 点击 TabBar「施工陪伴」 | 展示「请先设置开工日期」、快捷选择（7/15/30天后开工）、「选择其他日期」、提醒设置入口 | |
| TC-P09-002 | 首次加载-加载中状态 | P0 | 已登录，有网络 | 点击 TabBar「施工陪伴」 | 先显示「加载中…」，再展示内容 | |
| TC-P09-003 | 加载失败-401/404 静默 | P1 | 未登录或后端无进度 | 进入施工页 | 使用本地缓存展示，或显示设置开工日期；无错误弹窗 | |
| TC-P09-004 | 6 阶段卡片展示 | P0 | 已设置开工日期 | 进入施工页 | 展示 6 张阶段卡片：S00 材料进场核对、S01 隐蔽工程、S02 泥瓦工、S03 木工、S04 油漆、S05 安装收尾；每张含图标、名称、状态角标、计划时间、进度条、操作区 | |
| TC-P09-005 | 顶部导航栏 | P0 | 任意状态 | 查看顶部 | 左侧「返回」、中间「施工陪伴」、右侧占位；返回点击跳转首页 | |
| TC-P09-006 | 开工日期区域 | P0 | 已设置开工日期 | 查看开工日期卡片 | 显示「开工日期：YYYY-MM-DD」、编辑、提醒设置 | |
| TC-P09-007 | 全局进度概览 | P0 | 已设置开工日期 | 查看进度概览卡片 | 显示「整体进度：X%」；若落后计划则显示「X阶段落后计划X天」 | |
| TC-P09-008 | 待提醒红点 | P1 | 阶段在提醒时间窗口内 | 查看阶段卡片 | 待提醒阶段卡片右上角显示 8rpx 红色红点 | |

---

### 2.2 开工日期设置（FR-011）

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-010 | 快捷选择 7 天后开工 | P0 | 未设置开工日期 | 点击「7天后开工」 | 日期保存，展示 6 阶段卡片，Toast「进度计划更新成功」 | |
| TC-P09-011 | 快捷选择 15/30 天后开工 | P1 | 未设置开工日期 | 分别点击「15天后开工」「30天后开工」 | 同上 | |
| TC-P09-012 | 选择其他日期 | P0 | 未设置开工日期 | 点击「选择其他日期」，选择明天并确认 | 同上 | |
| TC-P09-013 | 编辑已有开工日期 | P0 | 已设置开工日期 | 点击「编辑」，选择新日期并确认 | 开工日期更新，阶段时间重算，Toast「进度计划更新成功」 | |
| TC-P09-014 | 日期选择取消 | P1 | 任意 | 打开日期选择器后取消 | 保持原日期，无变更 | |

---

### 2.3 S00 材料进场核对入口管控（FR-012a，V2.6.3）

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-020 | 未上传报价单-按钮置灰 | P0 | 已设置开工日期，未上传报价单/合同 | 进入施工页，查看 S00 | 「人工核对」按钮置灰（颜色 #E5E5E5） | |
| TC-P09-021 | 未上传报价单-点击提示 | P0 | 同上 | 点击 S00「人工核对」 | Toast「请先上传报价单以获取材料清单」，不跳转 | |
| TC-P09-022 | 已上传报价单-按钮可点 | P0 | 已上传报价单且分析完成 | 进入施工页，查看 S00 | 「人工核对」按钮可点击，非置灰 | |
| TC-P09-023 | 已上传报价单-点击跳转 | P0 | 同上 | 点击 S00「人工核对」 | 跳转 P37 材料进场人工核对页，Toast「请按清单逐项勾选并拍照留证」 | |
| TC-P09-024 | 从报价单页返回刷新 | P0 | 初始无材料清单 | 进入 P37→点击「去上传报价单」→上传报价单完成→返回 P09 | P09 重新拉取材料清单，S00「人工核对」变为可点击 | |
| TC-P09-025 | 清单加载失败兜底 | P1 | 材料清单 API 返回异常 | 进入施工页 | 「人工核对」置灰，点击提示「请先上传报价单以获取材料清单」 | |

---

### 2.4 流程互锁（FR-013）

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-030 | S00 未完成时 S01 置灰 | P0 | S00 未完成 | 查看 S01 卡片 | 「AI验收」按钮置灰 | |
| TC-P09-031 | S00 未完成点击 S01 | P0 | 同上 | 点击 S01「AI验收」 | Toast「请先完成材料进场人工核对」，不跳转 | |
| TC-P09-032 | S01 未完成时 S02 置灰 | P0 | S00 已完成，S01 未完成 | 查看 S02 | 「AI验收」置灰 | |
| TC-P09-033 | 前置未完成点击后续阶段 | P0 | S02 未完成 | 点击 S03「AI验收」 | Toast「请先完成泥瓦工验收」，不跳转 | |
| TC-P09-034 | S00 完成后 S01 解锁 | P0 | S00 已完成 | 查看 S01 | 「AI验收」可点击 | |
| TC-P09-035 | 依次完成解锁下一阶段 | P0 | 逐阶段完成 | 完成 S01→查看 S02；完成 S02→查看 S03… | 每完成一阶段，下一阶段「AI验收」解锁 | |

---

### 2.5 智能提醒设置（FR-014）

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-040 | 打开提醒设置弹窗 | P0 | 任意 | 点击「提醒设置」 | 弹出弹窗，含「智能提醒总开关」「提醒提前天数」、保存按钮 | |
| TC-P09-041 | 切换提醒开关 | P0 | 弹窗已打开 | 点击开关 | 开关状态切换，开关样式变化（on 态 #007AFF） | |
| TC-P09-042 | 选择提醒提前天数 | P0 | 弹窗已打开 | 点击「提醒提前天数」选择 1/2/3/5/7 天 | 选中项高亮，选择器展示所选天数 | |
| TC-P09-043 | 保存提醒设置 | P0 | 修改了设置 | 点击「保存设置」 | 弹窗关闭，Toast「提醒设置成功」；本地 storage 更新 | |
| TC-P09-044 | 点击遮罩关闭弹窗 | P1 | 弹窗已打开 | 点击弹窗外部遮罩 | 弹窗关闭，设置未保存 | |
| TC-P09-045 | 未设置开工日期也可开提醒 | P1 | 未设置开工日期 | 点击「提醒设置」 | 可打开提醒弹窗并保存 | |

---

### 2.6 阶段时间校准（FR-015）

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-050 | 调整时间入口显示 | P0 | 阶段为 in_progress 或 pending | 查看阶段卡片 | 显示「调整时间」链接 | |
| TC-P09-051 | 已完成阶段无调整时间 | P0 | 阶段为 completed | 查看该阶段卡片 | 不显示「调整时间」 | |
| TC-P09-052 | 调整时间成功 | P0 | 阶段进行中 | 点击「调整时间」，选择晚于开工日期的日期并确认 | 阶段计划时间更新，Toast「时间校准成功，后续进度计划已同步更新」 | |
| TC-P09-053 | 选择早于开工日期 | P1 | 同上 | 选择早于开工日期的日期 | Toast「校准时间须大于预计开始时间」，不更新 | |
| TC-P09-054 | 选择早于今天 | P1 | 同上 | 选择过去的日期 | Toast「请选择当前日期及以后的时间」，不更新 | |
| TC-P09-055 | 离线时调整时间 | P1 | 断网 | 点击「调整时间」并确认 | Toast「时间已缓存，联网后自动更新」，本地显示（待同步） | |

---

### 2.7 核对指引 / 验收指引（FR-012、P31）

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-060 | S00 核对指引 | P0 | S00 可操作 | 点击 S00「核对指引」 | 弹出验收指引弹窗，展示材料核对要点 | |
| TC-P09-061 | S01 验收指引 | P0 | S01 可操作 | 点击 S01「验收指引」 | 弹出验收指引弹窗，展示隐蔽工程验收要点 | |
| TC-P09-062 | 前置锁定时段点击指引 | P1 | S01 未解锁 | 点击 S01「验收指引」 | Toast「请先完成材料进场人工核对」，不弹窗 | |
| TC-P09-063 | 关闭指引弹窗 | P1 | 弹窗已打开 | 点击关闭或遮罩 | 弹窗关闭 | |

---

### 2.8 记录板块与查看台账（FR-018）

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-070 | 未完成阶段记录文案 | P0 | 阶段未完成 | 查看 S00/S01 等记录板块 | 显示「待人工核对」或「待验收」 | |
| TC-P09-071 | 待整改阶段记录文案 | P0 | 阶段为 rectify | 查看该阶段记录板块 | 显示「待整改」 | |
| TC-P09-072 | 已完成阶段显示查看按钮 | P0 | S00 已完成 | 查看 S00 记录板块 | 显示「查看台账/报告」链接 | |
| TC-P09-073 | S00 查看台账跳转 | P0 | S00 已完成 | 点击「查看台账/报告」 | 跳转 P37 材料进场人工核对页（记录模式） | |
| TC-P09-074 | S01~S05 查看报告跳转 | P0 | S01 已完成 | 点击 S01「查看台账/报告」 | 跳转 P30 验收页，对应 stage | |
| TC-P09-075 | 进度条颜色 | P1 | 不同状态 | 查看各阶段进度条 | 待开始 #EEEEEE，进行中 #007AFF，已完成 #00CC66，待整改 #FF9900 | |

---

### 2.9 一键分享进度（FR-017）

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-080 | 点击一键分享 | P0 | 已设置开工日期 | 点击底部「一键分享进度」 | 跳转 P32 分享页 | |
| TC-P09-081 | 分享页数据 | P1 | 同上 | 进入分享页后检查 | 展示 6 阶段进度、开工日期、提醒状态等 | |

---

### 2.10 从首页 6 阶段入口进入（关联 P02 FR-008）

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-090 | 首页点击阶段进入并滚动 | P0 | 已设置开工日期 | 首页点击某阶段快捷入口 | 进入 P09 并滚动至高亮该阶段，短暂高亮后消失 | |
| TC-P09-091 | 未设置开工日期点击阶段 | P1 | 未设置开工日期 | 首页点击阶段入口 | 入口置灰或 Toast「请先设置开工日期」 | |

---

### 2.11 视觉与交互规范

| 编号 | 用例名称 | 优先级 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|
| TC-P09-100 | 主按钮样式 | P2 | 查看「一键分享进度」 | 88rpx 高，圆角 16rpx，线性渐变 #007AFF | |
| TC-P09-101 | 卡片圆角阴影 | P2 | 查看阶段卡片 | 圆角 16rpx，阴影 0 2rpx 8rpx rgba(0,0,0,0.1) | |
| TC-P09-102 | 状态角标颜色 | P2 | 查看不同状态 | 已完成 #00CC66，进行中 #007AFF，待开始 #999999，待整改 #FF9900 | |
| TC-P09-103 | 页面可滚动 | P1 | 内容超出屏幕 | 上下滑动 | 内容可正常滚动，无 scroll-view padding 相关警告 | |
| TC-P09-104 | TabBar 展示 | P0 | 任意 | 查看底部 | 含「首页」「施工陪伴」「我的」，施工陪伴选中态 | |

---

### 2.12 异常与边界

| 编号 | 用例名称 | 优先级 | 前置条件 | 操作步骤 | 预期结果 | 实际结果 |
|------|----------|--------|----------|----------|----------|----------|
| TC-P09-110 | 未登录访问 | P0 | 已登出 | 点击 TabBar「施工陪伴」 | 可进入，若无本地缓存则显示设置开工日期；API 401 时静默 | |
| TC-P09-111 | 网络异常加载 | P1 | 断网 | 进入施工页 | 使用本地缓存；若无缓存则显示设置开工日期 | |
| TC-P09-112 | 返回首页 | P0 | 任意 | 点击顶部「返回」 | 跳转首页（TabBar switchTab） | |

---

## 三、端到端测试场景

### E2E-P09-01：新用户首次使用施工陪伴（P0）

**目标**：从未设置开工日期到完成 S00 材料核对的完整路径。

| 步骤 | 操作 | 预期结果 | 实际 |
|------|------|----------|------|
| 1 | 登录后点击 TabBar「施工陪伴」 | 进入施工页，展示「请先设置开工日期」 | |
| 2 | 点击「7天后开工」 | 展示 6 阶段卡片，S00 可操作（若有材料清单）或置灰（若无） | |
| 3 | 若 S00 置灰，先进入 P05 上传报价单 | 报价单分析完成后返回 | |
| 4 | 再次进入施工陪伴页 | S00「人工核对」可点击 | |
| 5 | 点击 S00「人工核对」 | 跳转 P37，展示材料清单 | |
| 6 | 勾选材料并拍照，点击「核对通过」 | 提交成功，返回 P09，S00 显示「已核对」，S01 解锁 | |
| 7 | 点击 S01「AI验收」 | 跳转 P15 验收拍照页 | |

**验证点**：开工日期设置 → S00 入口管控 → 材料核对 → 流程互锁。

---

### E2E-P09-02：6 阶段顺序验收全流程（P0）

**目标**：从 S00 到 S05 依次完成的完整流程。

| 步骤 | 操作 | 预期结果 | 实际 |
|------|------|----------|------|
| 1 | 确认开工日期已设置，S00 可操作 | 6 阶段展示，S00 非置灰 | |
| 2 | 完成 S00 材料核对（P37） | 返回 P09，S00 已核对，S01 解锁 | |
| 3 | 完成 S01 隐蔽工程验收（P15→分析→P30） | S01 已通过，S02 解锁 | |
| 4 | 依次完成 S02 泥瓦工、S03 木工、S04 油漆、S05 安装收尾 | 每阶段通过后下一阶段解锁 | |
| 5 | 全部完成后查看整体进度 | 整体进度 100% | |
| 6 | 点击各阶段「查看台账/报告」 | S00→P37，S01~S05→P30 对应 stage | |

**验证点**：流程互锁、状态更新、记录查看。

---

### E2E-P09-03：提醒设置与同步（P1）

**目标**：提醒设置保存及与 P19 双向同步。

| 步骤 | 操作 | 预期结果 | 实际 |
|------|------|----------|------|
| 1 | 点击「提醒设置」 | 弹窗打开 | |
| 2 | 关闭智能提醒开关，选择「5天」，保存 | Toast「提醒设置成功」 | |
| 3 | 进入「我的」→「账户与通知设置」 | 开关为关，提前天数为 5 天 | |
| 4 | 在设置页修改为 3 天并保存 | 保存成功 | |
| 5 | 返回施工陪伴页，点击「提醒设置」 | 弹窗显示 3 天 | |

**验证点**：P09 与 P19 提醒设置双向同步。

---

### E2E-P09-04：S00 入口管控完整链路（P0）

**目标**：验证 V2.6.3 S00 入口管控与材料清单联调。

| 步骤 | 操作 | 预期结果 | 实际 |
|------|------|----------|------|
| 1 | 新用户，已设置开工日期，未上传报价单 | S00「人工核对」置灰 | |
| 2 | 点击 S00「人工核对」 | Toast「请先上传报价单以获取材料清单」 | |
| 3 | 进入 P05 上传报价单，分析完成 | 返回可来自报告页或手动返回 | |
| 4 | 进入施工陪伴页 | 预拉材料清单，S00「人工核对」可点击 | |
| 5 | 点击「人工核对」 | 跳转 P37，有材料清单 | |
| 6 | P37 清单为空时点击「去上传报价单」 | 跳转 P05 | |
| 7 | 上传完成后返回 P09 | S00 可点击，再进 P37 有清单 | |

**验证点**：材料清单为空置灰、有清单解锁、返回刷新。

---

### E2E-P09-05：阶段时间调整与进度重算（P1）

**目标**：验证时间校准功能及后端同步。

| 步骤 | 操作 | 预期结果 | 实际 |
|------|------|----------|------|
| 1 | 选择 S01（进行中）点击「调整时间」 | 弹出日期选择器 | |
| 2 | 选择比原计划晚 5 天的日期并确认 | Toast「时间校准成功…」，计划时间更新 | |
| 3 | 若有（待同步）标记 | 联网后标记消失 | |
| 4 | 选择早于开工日期的日期 | Toast 提示须晚于开工日期，不更新 | |

**验证点**：时间校准校验、成功提示、错误拦截。

---

## 四、测试数据准备

| 场景 | 需准备 |
|------|--------|
| 无开工日期 | 清除 construction_start_date、construction_stage_status |
| 无材料清单 | 确保该用户无已分析完成的报价单/合同 |
| 有材料清单 | 上传报价单并等待分析完成 |
| 各阶段不同状态 | 通过实际操作或 Mock 接口调整 stage status |
| 提醒时间窗口 | 设置开工日期使某阶段处于「开始前 N 天」或「验收前 N 天」 |

---

## 五、回归检查清单

发布前建议快速回归以下用例：

- [ ] TC-P09-001、002、004（页面展示）
- [ ] TC-P09-010、013（开工日期）
- [ ] TC-P09-020~024（S00 入口管控）
- [ ] TC-P09-030~035（流程互锁）
- [ ] TC-P09-040~043（提醒设置）
- [ ] TC-P09-070~074（记录板块）
- [ ] E2E-P09-01、E2E-P09-02、E2E-P09-04

---

## 六、附录：需求 ID 映射

| 需求 ID | 对应用例 |
|---------|----------|
| FR-011 | TC-P09-001~002, 010~014 |
| FR-012 | TC-P09-004~008, 060~061 |
| FR-012a | TC-P09-020~025 |
| FR-013 | TC-P09-030~035 |
| FR-014 | TC-P09-040~045 |
| FR-015 | TC-P09-050~055 |
| FR-017 | TC-P09-080~081 |
| FR-018 | TC-P09-070~075 |
