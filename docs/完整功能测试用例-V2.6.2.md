# 装修避坑管家 - 完整功能测试用例（PRD V2.6.2）

**版本**：V2.6.2  
**依据文档**：V2.6.1最新产品需求文档.md、V2.6.1最新原型文档.md（对齐V15.3原型）  
**适用范围**：微信小程序功能测试、接口测试、端到端测试  
**更新日期**：2026-02-13

---

## 一、测试用例说明

| 字段 | 说明 |
|------|------|
| 用例编号 | TC-模块-序号（如 TC-AUTH-01） |
| 优先级 | P0=阻塞、P1=高、P2=中、P3=低 |
| 功能ID | 对应 PRD 中的 FR-xxx |
| 测试类型 | 功能测试、接口测试、UI测试、集成测试、E2E测试 |
| 前置条件 | 执行测试前必须满足的条件 |
| 测试步骤 | 详细的操作步骤（含API调用） |
| 预期结果 | 期望的输出结果 |
| 后置条件 | 测试执行后的状态 |

---

## 二、核心功能模块测试用例

### 2.1 用户认证与引导模块（P01/P02/P10/P19）

#### 2.1.1 引导页（P01）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-AUTH-01 | FR-001 | 引导页首次展示 | P0 | 首次打开小程序，未缓存onboarding_completed | 1. 打开小程序<br>2. 检查页面元素 | 展示3张引导页，品牌图标80rpx×80rpx，主标题36rpx加粗，副标题28rpx，3项核心能力，主按钮「开始使用」 | 页面正常展示 |
| TC-AUTH-02 | FR-002 | 引导页滑动切换 | P1 | 在引导页 | 1. 左右滑动切换<br>2. 点击页码指示器 | 可切换3张，页码指示器更新（选中态#007AFF），倒计时重置，动效0.2s | 当前页更新 |
| TC-AUTH-03 | FR-003 | 开始使用跳转 | P0 | 在引导页第3页 | 1. 点击「开始使用」按钮<br>2. 检查本地缓存 | 跳转至P02首页，本地缓存`onboarding_completed=true`，按钮点击动效0.1s按压缩放 | 已跳转首页 |
| TC-AUTH-04 | FR-003 | 跳过按钮跳转 | P1 | 在引导页任意页 | 1. 点击右上角「跳过」 | 跳转至P02首页，缓存`onboarding_completed=true` | 已跳转首页 |
| TC-AUTH-05 | FR-003 | 倒计时结束跳转 | P2 | 在引导页，倒计时3秒 | 1. 等待倒计时结束 | 自动跳转至P02首页 | 已跳转首页 |
| TC-AUTH-06 | FR-003 | 权限请求弹窗 | P0 | 首次进入首页 | 1. 跳转后检查弹窗 | 弹出「进度+消息提醒权限请求弹窗」，含「允许」「拒绝」按钮，底部提示文字 | 弹窗正常显示 |
| TC-AUTH-07 | FR-003 | 权限允许处理 | P1 | 权限请求弹窗 | 1. 点击「允许」 | 授权成功，后续可接收微信服务通知，Toast提示「提醒权限已开启」 | 权限已授权 |
| TC-AUTH-08 | FR-003 | 权限拒绝处理 | P2 | 权限请求弹窗 | 1. 点击「拒绝」 | 不影响首页使用，仅关闭微信服务通知，保留小程序内提醒，提示「拒绝后可在【我的-设置】二次开启」 | 权限未授权 |
| TC-AUTH-09 | FR-001 | 引导页不再展示 | P0 | 已缓存onboarding_completed=true | 1. 重新打开小程序 | 直接进入P02首页，不展示引导页 | 跳过引导页 |

#### 2.1.2 首页（P02）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-HOME-01 | FR-005 | 城市定位入口展示 | P0 | 在首页 | 1. 检查顶部水滴状入口 | 显示当前城市简称（如"深"），未选择时显示"定位"，背景#007AFF，文字24rpx#FFFFFF | 入口正常显示 |
| TC-HOME-02 | FR-005 | 城市定位入口点击 | P1 | 在首页 | 1. 点击水滴状入口 | 跳转至P38城市选择页，点击动效0.1s背景加深#0066CC | 已跳转城市选择页 |
| TC-HOME-03 | FR-006 | 消息提醒图标展示 | P0 | 在首页 | 1. 检查右上角消息图标 | 40rpx图标，有未读时右上角8rpx红色红点#FF3333 | 图标正常显示 |
| TC-HOME-04 | FR-006 | 消息提醒图标点击 | P1 | 有未读消息 | 1. 点击消息图标 | 跳转至P14消息中心页，未读红点自动消除 | 已跳转消息中心 |
| TC-HOME-05 | FR-007 | 核心功能4宫格展示 | P0 | 在首页 | 1. 检查4宫格布局 | 90%宽居中，4个卡片（装修公司检测/报价分析/合同审核/AI施工验收），含40rpx图标+28rpx文字 | 4宫格正常显示 |
| TC-HOME-06 | FR-007 | 核心功能4宫格点击 | P0 | 在首页 | 1. 点击「装修公司检测」<br>2. 点击「报价分析」<br>3. 点击「合同审核」<br>4. 点击「AI施工验收」 | 分别跳转P03/P05/P07/P09，点击动效0.1s按压缩放 | 跳转成功 |
| TC-HOME-07 | FR-008 | 6大阶段快捷入口展示 | P0 | 在首页 | 1. 检查6大阶段入口 | 90%宽、120rpx高，横向可滑动，每个阶段卡片60rpx×60rpx图标+24rpx文字，待提醒阶段加8rpx红色红点 | 入口正常显示 |
| TC-HOME-08 | FR-008 | 6大阶段快捷入口点击 | P1 | 在首页，已设置开工日期 | 1. 点击对应阶段 | 跳转至P09该阶段详情区域，滑动流畅无卡顿 | 跳转成功 |
| TC-HOME-09 | FR-008 | 6大阶段入口无数据 | P2 | 未设置开工日期 | 1. 点击阶段入口 | 入口置灰，Toast提示「请先设置开工日期」 | 提示正常 |
| TC-HOME-10 | FR-009 | 轮播图展示 | P1 | 在首页 | 1. 检查轮播图 | 100%宽、200rpx高，3张图片（6大阶段介绍/智能提醒/会员权益），底部圆点指示器 | 轮播图正常显示 |
| TC-HOME-11 | FR-009 | 轮播图自动轮播 | P2 | 在首页 | 1. 等待3秒 | 自动切换到下一张，手动滑动可暂停自动轮播 | 轮播正常 |
| TC-HOME-12 | FR-010 | 会员权益金卡展示 | P1 | 在首页 | 1. 检查会员权益卡片 | 90%宽、80rpx高，背景线性渐变#FFCC00，左侧文字「6大阶段全报告解锁+无限次AI提醒」，右侧「立即开通」 | 卡片正常显示 |
| TC-HOME-13 | FR-010 | 会员权益金卡点击 | P1 | 在首页 | 1. 点击「立即开通」 | 跳转至P26会员权益页 | 已跳转会员页 |

#### 2.1.3 用户登录与认证

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-LOGIN-01 | - | 微信登录（开发环境） | P0 | 开发环境 | 1. POST /api/v1/users/login<br>2. body: {"code":"dev_weapp_mock"} | 返回200，data包含access_token、user_id | 已登录 |
| TC-LOGIN-02 | - | 微信登录（生产环境） | P0 | 生产环境，已获取微信code | 1. POST /api/v1/users/login<br>2. body: {"code":"真实微信code"} | 返回200，data包含access_token、user_id、nickname、avatar | 已登录 |
| TC-LOGIN-03 | - | 用户信息获取 | P0 | 已登录 | 1. GET /api/v1/users/profile<br>2. Header: Authorization Bearer {token} | 返回200，data包含用户信息（头像、昵称、会员状态、会员到期时间） | 获取成功 |
| TC-LOGIN-04 | - | Token过期处理 | P0 | Token已过期 | 1. 使用过期token访问需认证接口 | 返回401错误，前端清除token并跳转登录 | Token已清除 |
| TC-LOGIN-05 | - | 未登录访问 | P0 | 未登录 | 1. 无token访问需认证接口 | 返回401错误，提示「请先登录」 | 返回401 |

---

### 2.2 公司风险检测模块（P03/P04/P11）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-COMPANY-01 | FR-011 | 公司名称输入 | P0 | 在公司输入页 | 1. 输入公司名称（≥3字符）<br>2. 检查输入框 | 支持输入，自动去空格，最大50字符，右侧显示「已输入X/50字」 | 输入成功 |
| TC-COMPANY-02 | FR-012 | 公司名称模糊搜索 | P1 | 在公司输入页，输入≥3字符 | 1. GET /api/v1/companies/search?q=xxx<br>2. 检查匹配列表 | 返回匹配结果列表，最多5条，按相似度排序，每行含公司名称+地区 | 列表正常显示 |
| TC-COMPANY-03 | FR-013 | 提交公司检测 | P0 | 已输入有效公司名 | 1. POST /api/v1/companies/scan<br>2. body: {"company_name":"xxx"} | 返回200，data包含scan_id，状态为analyzing | 检测已提交 |
| TC-COMPANY-04 | FR-014 | 检测进度展示 | P0 | 从公司输入页跳转 | 1. 进入P04检测中页<br>2. 检查进度元素 | 显示加载动画60rpx×60rpx，进度文字「正在核验工商信息，检测中...80%」，进度条70%宽、6rpx高，主色#007AFF | 进度正常显示 |
| TC-COMPANY-05 | FR-014 | 检测结果查询 | P0 | 检测进行中/完成 | 1. GET /api/v1/companies/scan/{scan_id}<br>2. 轮询查询（每2秒） | 返回检测状态（analyzing→completed），完成后返回风险等级、风险详情 | 结果正常返回 |
| TC-COMPANY-06 | FR-014 | 检测完成自动跳转 | P0 | 检测进度100% | 1. 等待进度完成 | 自动跳转至P11公司风险报告详情页，无手动操作 | 已跳转报告页 |
| TC-COMPANY-07 | FR-014 | 检测超时处理 | P1 | 检测超8秒 | 1. 等待超时 | 进度文字变为「分析超时，点击重试」，进度条可点击，点击保留原参数重新请求 | 超时提示正常 |
| TC-COMPANY-08 | - | 检测记录列表 | P1 | 已登录 | 1. GET /api/v1/companies/scans | 返回200，data包含用户的所有检测记录，按时间倒序 | 列表正常返回 |
| TC-COMPANY-09 | - | 公司风险报告详情 | P0 | 检测完成 | 1. GET /api/v1/companies/scan/{scan_id} | 返回200，data包含风险等级（high/mid/low）、风险详情、风险原因、工商信息 | 报告正常返回 |
| TC-COMPANY-10 | - | 历史记录查看 | P2 | 在公司输入页 | 1. 点击右上角「历史记录」 | 弹出弹窗（90%宽、50%高），展示最近10条检测记录，每条含公司名称+「重新检测」「删除」按钮 | 历史记录正常显示 |
| TC-COMPANY-11 | - | 手动提交检测 | P2 | 无匹配结果 | 1. 点击「手动提交检测」<br>2. 确认弹窗 | 弹出二次确认弹窗，确认后跳转P04，Toast提示「人工检测将在1-2个工作日完成」 | 手动提交成功 |

---

### 2.3 报价单分析模块（P05/P06/P12）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-QUOTE-01 | FR-016 | 未检测公司提示 | P1 | 未检测公司，进入报价单上传页 | 1. 检查顶部提示条 | 显示红色提示条100%宽、44rpx高，背景#FFF7E5，文字「⚠️ 未检测装修公司，分析结果可能存在偏差」，右侧「立即检测」按钮 | 提示条正常显示 |
| TC-QUOTE-02 | FR-017 | 报价单文件上传 | P0 | 在报价单页 | 1. 点击上传框<br>2. 选择PDF/JPG/PNG文件（≤10MB）<br>3. POST /api/v1/quotes/upload | 返回200，data包含quote_id，状态为analyzing，进度条实时更新 | 上传成功 |
| TC-QUOTE-03 | FR-017 | 文件格式校验 | P1 | 选择文件 | 1. 上传非PDF/JPG/PNG格式 | 返回400错误，Toast提示「仅支持PDF/JPG/PNG格式」 | 格式校验正常 |
| TC-QUOTE-04 | FR-017 | 文件大小校验 | P1 | 选择文件 | 1. 上传>10MB文件 | 返回400错误，Toast提示「文件不能超过10MB」 | 大小校验正常 |
| TC-QUOTE-05 | FR-017 | 拍照上传 | P1 | 在报价单页 | 1. 点击「拍照上传」<br>2. 跳转P15拍照页（标注「报价单拍摄」） | 相机权限拒绝则弹出「从相册选择」按钮，支持一键跳转权限设置页 | 拍照流程正常 |
| TC-QUOTE-06 | FR-017 | 示例查看 | P2 | 在报价单页 | 1. 点击右下角「示例查看」 | 弹出半透明弹窗（90%宽/60%高），展示规范报价单示例图3张，支持双指缩放/左右滑动 | 示例正常显示 |
| TC-QUOTE-07 | FR-018 | 报价单分析结果 | P0 | 分析完成 | 1. GET /api/v1/quotes/quote/{quote_id} | 返回200，data包含风险等级、漏项分析、虚高分析、预估省钱金额、本地市场价对比 | 结果正常返回 |
| TC-QUOTE-08 | FR-034 | 报价单报告预览 | P1 | 有分析结果 | 1. 进入P06报价单分析结果预览页 | 显示核心风险展示、前3项漏项/虚高项（30%核心内容），预估省钱金额，解锁完整报告入口 | 预览正常显示 |
| TC-QUOTE-09 | - | 报价单列表 | P1 | 已登录 | 1. GET /api/v1/quotes/list | 返回200，data包含用户的所有报价单记录，按时间倒序 | 列表正常返回 |
| TC-QUOTE-10 | - | 报价单详情（完整报告） | P0 | 报告已解锁 | 1. GET /api/v1/quotes/quote/{quote_id} | 返回200，data包含完整分析结果（所有漏项/虚高项、详细对比、整改建议） | 详情正常返回 |
| TC-QUOTE-11 | - | 断点续传 | P2 | 上传中断 | 1. 上传过程中断网<br>2. 重新连接后点击「点击继续」 | 接续上传，进度条从断点继续 | 续传成功 |

---

### 2.4 合同审核模块（P07/P08/P13）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-CONTRACT-01 | FR-016 | 合同文件上传 | P0 | 在合同页 | 1. POST /api/v1/contracts/upload<br>2. 上传PDF/JPG/PNG文件（≤10MB） | 返回200，data包含contract_id，状态为analyzing | 上传成功 |
| TC-CONTRACT-02 | FR-017 | 合同分析结果 | P0 | 分析完成 | 1. GET /api/v1/contracts/contract/{contract_id} | 返回200，data包含风险等级、风险条款、修正建议、合规范本对比 | 结果正常返回 |
| TC-CONTRACT-03 | FR-033 | 合同报告预览 | P1 | 有分析结果 | 1. 进入P08合同审核结果预览页 | 显示核心风险条款展示、前3项霸王条款（30%核心内容），修正建议数，解锁完整报告入口 | 预览正常显示 |
| TC-CONTRACT-04 | - | 合同列表 | P0 | 已登录 | 1. GET /api/v1/contracts/list | 返回200，data包含用户的所有合同记录，按时间倒序 | 列表正常返回 |
| TC-CONTRACT-05 | - | 合同详情（含summary） | P0 | 有合同记录 | 1. GET /api/v1/contracts/contract/{contract_id} | 返回200，data包含完整合同分析结果，包含summary字段（AI生成的摘要） | 详情正常返回 |
| TC-CONTRACT-06 | - | 合规范本示例 | P2 | 在合同页 | 1. 点击「合规范本示例」 | 弹出弹窗展示合规范本示例，支持查看 | 示例正常显示 |

---

### 2.5 施工进度管理模块（P09）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-CONSTRUCTION-01 | FR-011 | 设置开工日期 | P0 | 无开工日期 | 1. POST /api/v1/constructions/start-date<br>2. body: {"start_date":"2026-02-15"} | 返回200，自动计算6大阶段预计开始/验收时间，Toast提示「进度计划更新成功」 | 开工日期已设置 |
| TC-CONSTRUCTION-02 | FR-011 | 编辑开工日期 | P1 | 已设置开工日期 | 1. 点击「编辑」<br>2. 选择新日期<br>3. PUT /api/v1/constructions/start-date | 阶段时间自动重新推算，Toast提示「进度计划更新成功」 | 日期已更新 |
| TC-CONSTRUCTION-03 | FR-011 | 快捷日期选择 | P1 | 在日期选择器 | 1. 点击7/15/30天快捷选择 | 自动填充对应日期，确认后生效 | 快捷选择成功 |
| TC-CONSTRUCTION-04 | FR-012 | 进度计划查询 | P0 | 已设置开工日期 | 1. GET /api/v1/constructions/schedule | 返回200，data包含6大阶段（S00-S05）进度计划，每个阶段含status、start_date、end_date、locked状态 | 计划正常返回 |
| TC-CONSTRUCTION-05 | FR-012 | 阶段卡片展示 | P0 | 在施工陪伴页 | 1. 检查阶段卡片 | 每个卡片含阶段图标、名称32rpx#333333、状态角标、计划时间、进度条、操作区 | 卡片正常显示 |
| TC-CONSTRUCTION-06 | FR-012 | 进度条颜色 | P1 | 在施工陪伴页 | 1. 检查不同状态的进度条 | 待开始（灰#EEEEEE）、进行中（#007AFF）、已完成（#00CC66）、延期（橙#FF9900） | 颜色正确 |
| TC-CONSTRUCTION-07 | FR-013 | 流程互锁规则-S00解锁 | P0 | S00未核对 | 1. 检查S01-S05按钮状态 | S01-S05按钮置灰#E5E5E5，不可点击，点击Toast提示「请先完成材料进场人工核对」 | 互锁正常 |
| TC-CONSTRUCTION-08 | FR-013 | 流程互锁规则-后端校验 | P0 | 前置阶段未通过 | 1. PUT /api/v1/constructions/stage-status<br>2. body: {"stage":"S01","status":"completed"}<br>3. S00未通过 | 返回409错误，detail提示「请先完成S00阶段验收/核对」 | 后端校验正常 |
| TC-CONSTRUCTION-09 | FR-013 | S00操作按钮 | P0 | 在施工陪伴页，S00阶段 | 1. 检查S00操作区 | 显示「人工核对」「核对指引」按钮 | 按钮正常显示 |
| TC-CONSTRUCTION-10 | FR-013 | S01-S05操作按钮 | P0 | 在施工陪伴页，S01-S05阶段 | 1. 检查操作区 | 显示「AI验收」「验收指引」按钮 | 按钮正常显示 |
| TC-CONSTRUCTION-11 | FR-014 | 智能提醒设置 | P1 | 在施工陪伴页 | 1. 点击开工日期旁「提醒设置」<br>2. 弹出弹窗（90%宽、60%高）<br>3. 设置「智能提醒总开关」「提醒提前天数」（1/2/3/5/7天）<br>4. PUT /api/v1/users/settings | 设置实时同步后端+P19，双向同步，Toast提示「提醒设置成功」 | 设置成功 |
| TC-CONSTRUCTION-12 | FR-015 | 阶段时间校准 | P1 | 在施工陪伴页，阶段in_progress/pending状态 | 1. 点击「调整时间」<br>2. 弹出微信原生日期选择器<br>3. PUT /api/v1/constructions/stage-calibrate | 修改后后端重新计算提醒时间，Toast提示「时间调整成功，提醒同步更新」 | 校准成功 |
| TC-CONSTRUCTION-13 | FR-015 | 时间校准冲突 | P1 | 校准时间早于开工日期 | 1. 选择早于开工日期的日期 | Toast提示「调整时间需晚于开工日期，请重新选择」 | 校验正常 |
| TC-CONSTRUCTION-14 | FR-017 | 进度分享功能 | P2 | 在施工陪伴页，有进度数据 | 1. 点击底部「一键分享进度」 | 跳转P32，自动携带6大阶段进度+提醒状态+开工日期 | 分享成功 |
| TC-CONSTRUCTION-15 | FR-018 | 记录板块展示 | P1 | 在施工陪伴页，阶段已完成 | 1. 检查记录板块 | 已完成阶段显示「查看台账/报告」按钮，其他状态显示状态文字（待人工核对/待验收/待整改） | 板块正常显示 |
| TC-CONSTRUCTION-16 | FR-018 | 查看台账/报告 | P1 | 在施工陪伴页，阶段已完成 | 1. 点击「查看台账/报告」 | S00跳转P37，S01-S05跳转P30 | 跳转成功 |
| TC-CONSTRUCTION-17 | - | 进度计划404处理 | P1 | 未设置开工日期 | 1. GET /api/v1/constructions/schedule | 返回404，前端静默处理，加载本地缓存或显示默认状态 | 404处理正常 |
| TC-CONSTRUCTION-18 | - | 进度计划401处理 | P1 | 未登录 | 1. GET /api/v1/constructions/schedule | 返回401，前端清除token并跳转登录 | 401处理正常 |

---

### 2.6 材料进场人工核对模块（P37）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-MATERIAL-01 | FR-019 | 材料清单加载 | P0 | 已上传报价单，进入材料核对页 | 1. GET /api/v1/material-checks/material-list<br>2. 检查材料清单区域 | 自动同步报价单材料清单，按「关键材料→辅助材料」排序，每项含名称、规格/品牌、数量、「拍照/上传」按钮 | 清单正常加载 |
| TC-MATERIAL-02 | FR-019 | 材料清单为空 | P1 | 未上传报价单 | 1. 进入材料核对页 | 显示「未同步到材料清单，请先上传报价单」，含「去上传」按钮→P05 | 提示正常 |
| TC-MATERIAL-03 | FR-020 | 材料拍照上传 | P0 | 在材料核对页 | 1. 点击「拍照/上传」<br>2. 唤起微信原生相机<br>3. POST /api/v1/acceptance/upload-photo | 上传成功，显示80rpx×80rpx缩略图（最多3张），未上传显示"待上传"22rpx#FF9900 | 照片上传成功 |
| TC-MATERIAL-04 | FR-020 | 拍照指引弹窗 | P1 | 点击拍照 | 1. 点击「拍照/上传」 | 显示「请拍摄材料主体+型号标识」指引弹窗 | 指引正常显示 |
| TC-MATERIAL-05 | FR-020 | 照片预览删除 | P1 | 已上传照片 | 1. 点击照片缩略图<br>2. 点击删除 | 支持放大预览（双指缩放）、删除重传 | 预览删除正常 |
| TC-MATERIAL-06 | FR-020 | 照片模糊提示 | P2 | 上传模糊照片 | 1. 上传模糊/无型号照片 | Toast提示「照片未清晰显示材料型号，建议重拍」 | 提示正常 |
| TC-MATERIAL-07 | FR-021 | 资料核查上传 | P1 | 关键材料（钢筋/水泥） | 1. 上传「出厂合格证」「质保书」「CCC认证」<br>2. POST /api/v1/acceptance/upload-photo | 上传成功，勾选框变为#007AFF对勾 | 资料上传成功 |
| TC-MATERIAL-08 | FR-021 | 关键材料强制补充 | P0 | 关键材料未上传资料 | 1. 尝试提交「核对通过」 | 弹出「关键材料需上传质保文件，否则无法通过核对」提示，强制补充 | 强制校验正常 |
| TC-MATERIAL-09 | FR-021 | 资料格式校验 | P1 | 上传资料 | 1. 上传非PDF/JPG格式 | Toast提示「仅支持PDF/JPG格式，文件≤10MB」 | 格式校验正常 |
| TC-MATERIAL-10 | FR-022 | 问题标注输入 | P2 | 有材料不符 | 1. 在问题标注输入框输入（≤100字） | 输入成功，实时显示字数，输入框高度80rpx，文字24rpx#999999 | 输入正常 |
| TC-MATERIAL-11 | FR-022 | 问题标注超限 | P2 | 输入>100字 | 1. 输入超过100字 | 实时提示「已超出100字」，禁止继续输入 | 超限校验正常 |
| TC-MATERIAL-12 | FR-023 | 核对通过提交 | P0 | 所有材料已上传照片+关键资料齐全 | 1. 点击「核对通过」<br>2. POST /api/v1/material-checks/submit<br>3. PUT /api/v1/constructions/stage-status | 弹出确认弹窗，确认后跳转P09，S00状态更新为「已核对」，解锁S01，照片写入construction_photos表 | 提交成功 |
| TC-MATERIAL-13 | FR-023 | 核对通过校验 | P0 | 有材料未上传照片 | 1. 点击「核对通过」 | Toast提示「还有XX项材料未上传照片/资料不全」，「核对通过」按钮置灰 | 校验正常 |
| TC-MATERIAL-14 | FR-023 | 核对未通过提交 | P0 | 有材料不符 | 1. 点击「核对未通过」<br>2. 输入原因（≥10字）<br>3. POST /api/v1/material-checks/submit | S00状态为「待整改」，跳转P09 | 提交成功 |
| TC-MATERIAL-15 | FR-023 | 核对未通过原因校验 | P0 | 点击「核对未通过」 | 1. 输入原因<10字 | Toast提示「请填写问题原因，至少10字」 | 校验正常 |
| TC-MATERIAL-16 | FR-023 | 提交失败处理 | P1 | 网络异常 | 1. 提交时断网 | 保留已输入内容，Toast提示「网络异常，请稍后重试」 | 失败处理正常 |
| TC-MATERIAL-17 | - | 最近一次核对记录 | P1 | 已提交核对 | 1. GET /api/v1/material-checks/latest | 返回200，data包含最近一次核对记录（result、items、submitted_at） | 记录正常返回 |

---

### 2.7 阶段验收模块（P30）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-ACCEPTANCE-01 | FR-024 | 验收结果展示 | P0 | 有验收记录 | 1. GET /api/v1/acceptance/{analysis_id}<br>2. 进入P30验收页 | 显示验收概览（状态标签已通过#00CC66/待整改#FF9900/未通过#FF3333、验收时间、核心数据），验收详情列表按严重程度排序 | 结果正常显示 |
| TC-ACCEPTANCE-02 | FR-024 | 验收详情查看 | P1 | 在验收页 | 1. 点击「查看详情」 | 弹出弹窗（问题照片+标准+整改建议） | 详情正常显示 |
| TC-ACCEPTANCE-03 | FR-024 | 数据加载失败 | P1 | 网络异常 | 1. 进入验收页 | 显示骨架屏（0.8s渐变动效），加载失败提示「点击重试」 | 失败处理正常 |
| TC-ACCEPTANCE-04 | FR-025 | 标记整改 | P1 | 验收未通过 | 1. POST /api/v1/acceptance/{id}/mark-rectify<br>2. 上传整改后照片（最多5张） | 阶段状态更新为「待整改」，需上传整改后照片 | 整改标记成功 |
| TC-ACCEPTANCE-05 | FR-025 | 完成整改 | P1 | 已标记整改，已上传照片 | 1. 点击「完成整改」 | 状态转为「待复检」 | 整改完成 |
| TC-ACCEPTANCE-06 | FR-025 | 申请复检 | P1 | 整改完成 | 1. POST /api/v1/acceptance/{id}/request-recheck<br>2. 上传整改后照片 | 自动触发AI复检，状态转为「待复检」 | 复检已申请 |
| TC-ACCEPTANCE-07 | FR-025 | 复检通过 | P0 | 复检完成 | 1. 检查复检结果 | 复检通过→验收列表更新，状态「已通过」，解锁下一阶段 | 复检通过 |
| TC-ACCEPTANCE-08 | FR-025 | 复检未通过 | P1 | 复检完成，未通过 | 1. 检查复检结果 | 前2次→提示整改建议，第3次→引导转人工监理 | 复检未通过处理正常 |
| TC-ACCEPTANCE-09 | FR-025 | 复检上传失败 | P1 | 上传整改照片 | 1. 上传失败 | Toast提示「照片上传失败，请重新选择」 | 失败处理正常 |
| TC-ACCEPTANCE-10 | FR-026 | 申诉功能 | P2 | 验收未通过/待整改 | 1. 点击「申诉」按钮（28rpx#FF3333）<br>2. POST /api/v1/appeals/acceptance/{analysis_id} | 弹出申诉弹窗（异议原因输入框+凭证上传区），提交后Toast提示「申诉已提交，1-2个工作日审核」，P09对应阶段卡片显示「申诉中」红色小标签 | 申诉提交成功 |
| TC-ACCEPTANCE-11 | FR-026 | 申诉中状态 | P2 | 申诉已提交 | 1. 检查申诉按钮 | 置灰显示「申诉中」#999999 | 状态正常 |
| TC-ACCEPTANCE-12 | FR-026 | 申诉提交失败 | P2 | 网络异常 | 1. 提交申诉时断网 | 保留输入内容/凭证，Toast提示「网络异常，请重试」 | 失败处理正常 |
| TC-ACCEPTANCE-13 | FR-027 | AI监理咨询入口 | P1 | 在验收页 | 1. 点击「咨询AI监理」按钮（88rpx高，#007AFF背景）<br>2. GET /api/v1/consultation/quota | 携带当前报告ID、阶段、问题列表跳转P36，按钮旁显示小字提示（免费用户「本月剩余X次」，会员「会员无限次」） | 跳转成功 |
| TC-ACCEPTANCE-14 | FR-027 | AI监理咨询未登录 | P1 | 用户未登录 | 1. 点击「咨询AI监理」 | 弹出登录引导弹窗→微信快捷登录 | 登录引导正常 |
| TC-ACCEPTANCE-15 | FR-028 | PDF导出（会员） | P1 | 会员用户，报告已解锁 | 1. GET /api/v1/reports/export-pdf?report_type=acceptance&id=xxx | 生成PDF（命名「[阶段名]验收报告-[用户名]-[日期].pdf」），弹出「保存至相册」「发送至微信文件助手」选项 | PDF导出成功 |
| TC-ACCEPTANCE-16 | FR-028 | PDF导出（普通用户） | P1 | 普通用户 | 1. 点击PDF导出图标 | 跳转P27报告解锁确认页 | 跳转解锁页 |
| TC-ACCEPTANCE-17 | FR-028 | PDF生成失败 | P2 | 生成PDF | 1. 生成失败 | Toast提示「生成失败，请稍后重试」 | 失败处理正常 |
| TC-ACCEPTANCE-18 | - | 验收列表查询 | P1 | 已登录 | 1. GET /api/v1/acceptance | 返回200，data包含用户的所有验收记录，按时间倒序 | 列表正常返回 |
| TC-ACCEPTANCE-19 | - | 验收照片上传 | P0 | 在P15拍照页 | 1. POST /api/v1/acceptance/upload-photo<br>2. 上传验收照片 | 返回200，data包含file_url，照片上传到OSS zhuangxiu-images-dev-photo | 上传成功 |

---

### 2.8 施工照片管理模块（P15/P29）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-PHOTO-01 | - | 施工照片上传 | P0 | 在P15拍照页 | 1. POST /api/v1/construction-photos/upload?stage=material<br>2. 上传照片 | 返回200，data包含id、file_url、stage，照片上传到OSS zhuangxiu-images-dev-photo | 上传成功 |
| TC-PHOTO-02 | - | 施工照片列表 | P0 | 已登录 | 1. GET /api/v1/construction-photos?stage=material | 返回200，data包含photos（按阶段分组）、list（全部列表），照片URL可访问OSS | 列表正常返回 |
| TC-PHOTO-03 | - | 施工照片按阶段筛选 | P1 | 在P29施工照片管理页 | 1. 点击阶段标签（S00-S05）<br>2. GET /api/v1/construction-photos?stage=xxx | 返回对应阶段的照片列表 | 筛选正常 |
| TC-PHOTO-04 | - | 施工照片删除 | P1 | 在P29施工照片管理页 | 1. DELETE /api/v1/construction-photos/{photo_id} | 返回200，照片软删除（deleted_at标记） | 删除成功 |
| TC-PHOTO-05 | - | 施工照片移动阶段 | P2 | 在P29施工照片管理页 | 1. PUT /api/v1/construction-photos/{photo_id}/move<br>2. body: {"stage":"plumbing"} | 返回200，照片移动到新阶段 | 移动成功 |
| TC-PHOTO-06 | - | OSS直传注册 | P1 | 前端直传OSS后 | 1. POST /api/v1/construction-photos/register<br>2. body: {"stage":"material","key":"construction/material/xxx.jpg"} | 返回200，照片记录写入DB，file_url使用ALIYUN_OSS_BUCKET1 | 注册成功 |
| TC-PHOTO-07 | - | 照片URL访问 | P0 | 照片已上传 | 1. 访问file_url | 照片可从OSS zhuangxiu-images-dev-photo正常访问 | 访问正常 |

---

### 2.9 消息中心模块（P14）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-MESSAGE-01 | FR-031 | 消息列表查询 | P0 | 已登录 | 1. GET /api/v1/messages | 返回200，data包含消息列表，按时间倒序，未读消息右上角8rpx红色红点 | 列表正常返回 |
| TC-MESSAGE-02 | FR-031 | 消息分类筛选 | P1 | 在消息中心页 | 1. 点击分类标签（施工提醒/报告通知/系统消息/客服回复）<br>2. GET /api/v1/messages?category=xxx | 返回对应分类的消息列表 | 筛选正常 |
| TC-MESSAGE-03 | FR-031 | 未读消息数量 | P1 | 有未读消息 | 1. GET /api/v1/messages/unread-count | 返回200，data包含未读数量，同步P02消息图标红点 | 数量正常返回 |
| TC-MESSAGE-04 | - | 单条消息已读 | P1 | 有未读消息 | 1. PUT /api/v1/messages/{msg_id}/read | 返回200，消息标记为已读，红点消除 | 已读成功 |
| TC-MESSAGE-05 | - | 一键已读 | P1 | 有未读消息 | 1. PUT /api/v1/messages/read-all | 返回200，所有消息标记为已读 | 一键已读成功 |
| TC-MESSAGE-06 | FR-031 | 消息点击跳转 | P1 | 施工提醒消息 | 1. 点击消息 | 直达P09对应阶段卡片，自动消除未读红点 | 跳转成功 |
| TC-MESSAGE-07 | - | 消息批量操作 | P2 | 在消息中心页 | 1. 进入批量模式<br>2. 选择消息<br>3. 批量删除/标为已读 | 支持批量操作，施工提醒不可删除 | 批量操作成功 |
| TC-MESSAGE-08 | - | 消息加载失败 | P1 | 网络异常 | 1. 进入消息中心页 | Toast提示「消息加载失败，点击重试」 | 失败处理正常 |

---

### 2.10 城市选择模块（P38）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-CITY-01 | FR-032 | 自动定位功能 | P1 | 在城市选择页 | 1. 进入页面自动触发定位 | 定位中显示「定位中...」，成功显示「当前定位城市：[城市名]」（城市名高亮#007AFF），失败显示「定位失败，请手动选择城市」 | 定位正常 |
| TC-CITY-02 | FR-032 | 定位权限拒绝 | P2 | 定位权限拒绝 | 1. 拒绝定位权限 | 隐藏定位城市，仅展示手动选择列表 | 权限拒绝处理正常 |
| TC-CITY-03 | FR-032 | 定位超时 | P2 | 定位超时 | 1. 等待超时 | 默认显示热门城市列表 | 超时处理正常 |
| TC-CITY-04 | FR-033 | 热门城市选择 | P1 | 在城市选择页 | 1. GET /api/v1/cities/hot<br>2. 点击热门城市标签 | 返回热门城市列表（北京/上海/广州/深圳/杭州），点击后标签变为#007AFF边框+背景，底部确认按钮高亮 | 选择正常 |
| TC-CITY-05 | FR-034 | 省份-城市联动 | P1 | 在城市选择页 | 1. GET /api/v1/cities/list<br>2. 点击左侧省份<br>3. 点击右侧城市 | 左侧省份列表（30%宽），右侧城市列表（70%宽），点击省份→右侧刷新对应城市，点击城市→文字变为#007AFF+背景#EEF7FF | 联动正常 |
| TC-CITY-06 | FR-034 | 城市加载失败 | P1 | 网络异常 | 1. 加载城市列表 | Toast提示「城市列表加载失败，点击重试」 | 失败处理正常 |
| TC-CITY-07 | FR-035 | 城市搜索功能 | P1 | 在城市选择页 | 1. 输入城市名/拼音<br>2. 实时筛选 | 实时筛选匹配结果，无结果显示「未找到相关城市」，点击结果可直接选中 | 搜索正常 |
| TC-CITY-08 | FR-035 | 搜索无结果 | P2 | 搜索无匹配 | 1. 输入不存在的城市名 | Toast提示「未找到相关城市，请重新输入」 | 提示正常 |
| TC-CITY-09 | FR-036 | 确认选择逻辑 | P0 | 已选中城市 | 1. 点击「确认选择」<br>2. POST /api/v1/cities/select | 保存城市至本地缓存+后端，返回上一页，Toast提示「已切换至[城市名]，后续AI分析基于该城市规范」 | 选择成功 |
| TC-CITY-10 | FR-036 | 未选中城市 | P1 | 未选中城市 | 1. 点击「确认选择」 | 按钮置灰#CCCCCC，不可点击 | 按钮置灰正常 |
| TC-CITY-11 | FR-036 | 城市保存失败 | P1 | 网络异常 | 1. 保存城市时断网 | Toast提示「城市保存失败，请检查网络」 | 失败处理正常 |
| TC-CITY-12 | - | 当前城市查询 | P1 | 已选择城市 | 1. GET /api/v1/cities/current | 返回200，data包含当前选中城市 | 查询正常 |

---

### 2.11 个人中心模块（P10/P20/P21）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-PROFILE-01 | - | 个人中心页展示 | P0 | 已登录 | 1. 进入P10个人中心页 | 显示用户头像、昵称、会员状态、报告/照片/订单管理入口、装修日历入口、数据管理、专属客服 | 页面正常显示 |
| TC-PROFILE-02 | - | 我的数据入口 | P0 | 在个人中心页 | 1. 点击「我的数据」 | 跳转P20数据管理页 | 跳转成功 |
| TC-PROFILE-03 | - | 我的订单入口 | P0 | 在个人中心页 | 1. 点击「我的订单」 | 跳转P24我的订单页 | 跳转成功 |
| TC-PROFILE-04 | - | 装修日历入口 | P1 | 在个人中心页 | 1. 点击「装修日历」 | 跳转装修日历页 | 跳转成功 |
| TC-PROFILE-05 | - | 专属客服入口 | P1 | 在个人中心页 | 1. 点击「专属客服」 | 跳转P23在线客服页 | 跳转成功 |
| TC-PROFILE-06 | - | 数据管理页展示 | P0 | 在P20数据管理页 | 1. 检查页面 | 显示分类标签（施工照片/分析报告/台账报告/验收报告），数据列表，批量操作入口 | 页面正常显示 |
| TC-PROFILE-07 | - | 数据管理分类切换 | P1 | 在P20数据管理页 | 1. 点击分类标签 | 显示对应分类的数据列表 | 切换正常 |
| TC-PROFILE-08 | - | 数据批量删除 | P1 | 在P20数据管理页，会员用户 | 1. 进入批量模式<br>2. 选择数据<br>3. POST /api/v1/users/data/delete | 数据软删除，移入回收站，Toast提示「已删除，7天内可恢复」 | 删除成功 |
| TC-PROFILE-09 | - | 回收站页展示 | P1 | 在P21回收站页 | 1. GET /api/v1/users/data/recycle | 返回200，data包含已删除数据列表（照片/报告等），含恢复/永久删除按钮 | 列表正常返回 |
| TC-PROFILE-10 | - | 数据恢复 | P1 | 在P21回收站页，会员用户 | 1. POST /api/v1/users/data/restore | 数据恢复，移出回收站，Toast提示「已恢复」 | 恢复成功 |
| TC-PROFILE-11 | - | 永久删除 | P2 | 在P21回收站页，会员用户 | 1. 点击「永久删除」 | 数据永久删除，不可恢复，Toast提示「已永久删除」 | 删除成功 |
| TC-PROFILE-12 | - | 普通用户回收站 | P2 | 普通用户 | 1. 进入回收站 | 显示「回收站功能为会员专属」提示 | 提示正常 |

---

### 2.12 账户与通知设置模块（P19）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-SETTINGS-01 | FR-014 | 提醒设置查询 | P0 | 已登录 | 1. GET /api/v1/users/settings | 返回200，data包含reminder_enabled、reminder_days_before（1/2/3/5/7） | 设置正常返回 |
| TC-SETTINGS-02 | FR-014 | 提醒设置更新 | P1 | 在P19设置页 | 1. 修改「智能提醒总开关」「提醒提前天数」<br>2. PUT /api/v1/users/settings | 设置实时同步后端+P09，双向同步，Toast提示「提醒设置成功」 | 更新成功 |
| TC-SETTINGS-03 | FR-014 | 提醒设置失败 | P1 | 网络异常 | 1. 保存设置时断网 | 保留原设置，Toast提示「设置未生效，请重试」 | 失败处理正常 |
| TC-SETTINGS-04 | FR-016 | 特殊申请入口 | P2 | 在P19设置页 | 1. 点击「特殊申请」 | 弹出「自主装修豁免/核对验收争议申诉」下拉菜单 | 菜单正常显示 |
| TC-SETTINGS-05 | FR-016 | 自主装修豁免申请 | P2 | 在特殊申请菜单 | 1. 选择「自主装修豁免」<br>2. 提交申请（装修类型+原因≥10字）<br>3. POST /api/v1/appeals/special | 提交成功，1-2个工作日审核，通过后阶段卡片标注「自主装修豁免」绿色标识 | 申请提交成功 |
| TC-SETTINGS-06 | FR-016 | 争议申诉申请 | P2 | 在特殊申请菜单 | 1. 选择「核对验收争议申诉」<br>2. 提交异议阶段+原因+凭证≤3张照片<br>3. POST /api/v1/appeals/special | 提交成功，审核通过后重新生成台账/报告 | 申请提交成功 |
| TC-SETTINGS-07 | FR-016 | 申请提交失败 | P2 | 网络异常 | 1. 提交申请时断网 | 保留输入内容，Toast提示「网络异常，请稍后重试」 | 失败处理正常 |

---

### 2.13 支付与订单模块（P24/P25/P27/P28/P34）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-PAYMENT-01 | - | 创建订单 | P0 | 需要解锁报告/会员 | 1. POST /api/v1/payments/create<br>2. body: {"type":"report_unlock","item_id":xxx} | 返回200，data包含order_id、amount、pay_url | 订单创建成功 |
| TC-PAYMENT-02 | - | 调起支付 | P0 | 订单已创建 | 1. POST /api/v1/payments/pay<br>2. body: {"order_id":xxx} | 调起微信支付，返回支付参数 | 支付调起成功 |
| TC-PAYMENT-03 | - | 支付成功回调 | P0 | 支付完成 | 1. 微信支付回调<br>2. POST /api/v1/payments/notify | 订单状态更新为paid，解锁对应权益 | 回调处理成功 |
| TC-PAYMENT-04 | - | 订单列表查询 | P0 | 已登录 | 1. GET /api/v1/payments/orders | 返回200，data包含用户的所有订单，按时间倒序 | 列表正常返回 |
| TC-PAYMENT-05 | - | 订单详情查看 | P0 | 有订单记录 | 1. GET /api/v1/payments/order/{order_id} | 返回200，data包含订单信息（订单号、金额、状态、创建时间、支付时间） | 详情正常返回 |
| TC-PAYMENT-06 | - | 退款申请 | P1 | 订单已支付 | 1. POST /api/v1/payments/refund/apply<br>2. body: {"order_id":xxx,"reason":"xxx"} | 退款申请提交成功，状态为refunding | 申请成功 |
| TC-PAYMENT-07 | - | 退款状态查询 | P1 | 已申请退款 | 1. GET /api/v1/payments/refund/status?order_id=xxx | 返回200，data包含退款状态（refunding/refunded/failed） | 状态正常返回 |
| TC-PAYMENT-08 | - | 报告解锁确认页 | P1 | 需要解锁报告 | 1. 进入P27报告解锁确认页 | 显示单份解锁/会员开通选择、权益对比 | 页面正常显示 |
| TC-PAYMENT-09 | - | 支付页展示 | P0 | 订单已创建 | 1. 进入P28支付页 | 显示订单信息、支付金额、微信支付按钮 | 页面正常显示 |

---

### 2.14 AI监理咨询模块（P36）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-CONSULTATION-01 | FR-027 | 咨询额度查询 | P1 | 已登录 | 1. GET /api/v1/consultation/quota | 返回200，data包含免费额度/会员次数（免费用户每月3次，会员无限次） | 额度正常返回 |
| TC-CONSULTATION-02 | - | 创建咨询会话 | P0 | 在P36咨询页 | 1. POST /api/v1/consultation/session<br>2. body: {"stage":"S01","analysis_id":xxx} | 返回200，data包含session_id，携带验收上下文 | 会话创建成功 |
| TC-CONSULTATION-03 | - | 获取验收上下文 | P1 | 会话已创建 | 1. GET /api/v1/consultation/session/{id}/context | 返回200，data包含当前验收阶段、问题列表、本地规范 | 上下文正常返回 |
| TC-CONSULTATION-04 | - | 发送消息 | P0 | 会话已创建 | 1. POST /api/v1/consultation/message<br>2. body: {"session_id":xxx,"content":"xxx"} | 返回200，data包含AI回复，响应时间≤3秒 | 消息发送成功 |
| TC-CONSULTATION-05 | - | 消息历史查询 | P1 | 会话已创建 | 1. GET /api/v1/consultation/session/{id}/messages | 返回200，data包含消息历史（≥10轮记忆窗口） | 历史正常返回 |
| TC-CONSULTATION-06 | - | 转人工监理 | P2 | 会话已创建 | 1. POST /api/v1/consultation/session/{id}/transfer-human | 转接人工监理，Toast提示「已转接人工监理，请稍候」 | 转接成功 |
| TC-CONSULTATION-07 | - | 会话列表查询 | P1 | 已登录 | 1. GET /api/v1/consultation/sessions | 返回200，data包含用户的所有咨询会话，按时间倒序 | 列表正常返回 |
| TC-CONSULTATION-08 | - | 额度不足提示 | P1 | 免费用户，额度已用完 | 1. 发送消息 | Toast提示「本月免费额度已用完，开通会员可无限次咨询」 | 提示正常 |

---

### 2.15 报告导出模块（P11/P12/P13/P30）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-REPORT-01 | FR-028 | 公司风险报告PDF导出 | P1 | 报告已解锁，会员用户 | 1. GET /api/v1/reports/export-pdf?report_type=company&id=xxx | 生成PDF（命名「公司风险报告-[用户名]-[日期].pdf」），弹出保存选项 | PDF导出成功 |
| TC-REPORT-02 | FR-028 | 报价单分析报告PDF导出 | P1 | 报告已解锁，会员用户 | 1. GET /api/v1/reports/export-pdf?report_type=quote&id=xxx | 生成PDF（命名「报价单分析报告-[用户名]-[日期].pdf」） | PDF导出成功 |
| TC-REPORT-03 | FR-028 | 合同审核报告PDF导出 | P1 | 报告已解锁，会员用户 | 1. GET /api/v1/reports/export-pdf?report_type=contract&id=xxx | 生成PDF（命名「合同审核报告-[用户名]-[日期].pdf」） | PDF导出成功 |
| TC-REPORT-04 | FR-028 | 验收报告PDF导出 | P1 | 报告已解锁，会员用户 | 1. GET /api/v1/reports/export-pdf?report_type=acceptance&id=xxx | 生成PDF（命名「[阶段名]验收报告-[用户名]-[日期].pdf」） | PDF导出成功 |
| TC-REPORT-05 | FR-028 | PDF导出（普通用户） | P1 | 普通用户 | 1. 点击PDF导出图标 | 跳转P27报告解锁确认页 | 跳转解锁页 |
| TC-REPORT-06 | FR-028 | PDF生成失败 | P2 | 生成PDF | 1. 生成失败 | Toast提示「生成失败，请稍后重试」 | 失败处理正常 |

---

### 2.16 其他功能模块

#### 2.16.1 意见反馈（P22）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-FEEDBACK-01 | - | 提交意见反馈 | P2 | 在P22意见反馈页 | 1. POST /api/v1/feedback<br>2. body: {"type":"bug","content":"xxx","images":[]} | 返回200，Toast提示「反馈已提交，感谢您的反馈」 | 提交成功 |

#### 2.16.2 在线客服（P23）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-SERVICE-01 | - | 智能客服对话 | P1 | 在P23在线客服页 | 1. 发送消息 | 智能客服自动回复 | 对话正常 |
| TC-SERVICE-02 | - | 转人工客服 | P2 | 在P23在线客服页 | 1. 点击「转人工」 | 转接人工客服，显示「客服接入中」 | 转接成功 |

#### 2.16.3 分享功能（P32）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 | 后置条件 |
|----------|--------|----------|--------|----------|----------|----------|----------|
| TC-SHARE-01 | FR-017 | 进度分享 | P2 | 在P32分享页 | 1. 点击「分享到微信好友/朋友圈」 | 调起微信分享，携带进度数据 | 分享成功 |
| TC-SHARE-02 | FR-017 | 图片保存 | P2 | 在P32分享页 | 1. 点击「保存图片」 | 保存进度图片至相册 | 保存成功 |

---

## 三、端到端测试场景（E2E）

### 3.1 新用户完整流程（P0）

**场景描述**：新用户首次使用，完成从引导到首次验收的完整流程

| 步骤 | 操作 | 预期结果 | 验证点 |
|------|------|----------|--------|
| 1 | 打开小程序 | 展示P01引导页（3张） | 引导页正常展示 |
| 2 | 滑动引导页，点击「开始使用」 | 跳转P02首页，缓存onboarding_completed=true | 跳转成功，缓存写入 |
| 3 | 权限请求弹窗，点击「允许」 | 授权成功，可接收微信服务通知 | 权限已授权 |
| 4 | 点击水滴状城市定位入口 | 跳转P38城市选择页 | 跳转成功 |
| 5 | 选择城市（如「深圳」），点击「确认选择」 | 城市保存成功，返回首页，入口显示「深」 | 城市保存成功 |
| 6 | 点击「装修公司检测」 | 跳转P03公司名称输入页 | 跳转成功 |
| 7 | 输入公司名称，点击「开始检测」 | 跳转P04检测中页，显示进度 | 检测已提交 |
| 8 | 等待检测完成 | 自动跳转P11公司风险报告详情页 | 跳转成功 |
| 9 | 返回首页，点击「AI施工验收」 | 跳转P09施工陪伴页 | 跳转成功 |
| 10 | 设置开工日期（如2026-02-15） | 6大阶段进度计划自动生成，Toast提示「进度计划更新成功」 | 开工日期已设置 |
| 11 | 点击S00「人工核对」 | 跳转P37材料进场人工核对页 | 跳转成功 |
| 12 | 上传材料照片（至少1张），点击「核对通过」 | S00状态更新为「已核对」，解锁S01，返回P09 | 核对成功，S01解锁 |
| 13 | 点击S01「AI验收」 | 跳转P15拍照页（标注「隐蔽工程验收」） | 跳转成功 |
| 14 | 上传验收照片（至少1张），提交 | 跳转P04检测中页，AI分析中 | 分析已提交 |
| 15 | 等待分析完成 | 自动跳转P30隐蔽工程验收页，显示验收结果 | 验收结果正常显示 |
| 16 | 返回P09施工陪伴页 | S01状态显示「已通过」，S02解锁 | 状态更新正常 |

**验证点总结**：
- ✅ 引导页→首页→功能页跳转正常
- ✅ 城市选择保存成功
- ✅ 公司检测流程完整
- ✅ 开工日期设置成功
- ✅ S00材料核对流程完整
- ✅ S01验收流程完整
- ✅ 流程互锁规则生效（S00通过→S01解锁）
- ✅ 状态更新正常（S00已核对，S01已通过）

---

### 3.2 施工陪伴完整流程（P0）

**场景描述**：已设置开工日期的用户，完成6大阶段完整验收流程

| 步骤 | 操作 | 预期结果 | 验证点 |
|------|------|----------|--------|
| 1 | 登录，进入P09施工陪伴页 | 显示6大阶段卡片，S00-S05按顺序展示 | 页面正常显示 |
| 2 | 检查S00状态 | S00显示「待人工核对」，S01-S05按钮置灰 | 互锁规则生效 |
| 3 | 完成S00材料核对（上传照片，核对通过） | S00状态「已核对」，S01解锁 | S00完成，S01解锁 |
| 4 | 完成S01隐蔽工程验收（上传照片，AI分析通过） | S01状态「已通过」，S02解锁 | S01完成，S02解锁 |
| 5 | 完成S02泥瓦工验收 | S02状态「已通过」，S03解锁 | S02完成，S03解锁 |
| 6 | 完成S03木工验收 | S03状态「已通过」，S04解锁 | S03完成，S04解锁 |
| 7 | 完成S04油漆验收 | S04状态「已通过」，S05解锁 | S04完成，S05解锁 |
| 8 | 完成S05安装收尾验收 | S05状态「已通过」，流程结束 | S05完成，流程结束 |
| 9 | 进入P20数据管理页，查看「施工照片」 | 显示所有阶段上传的照片，按阶段分类 | 照片正常显示 |
| 10 | 查看「验收报告」 | 显示S01-S05所有验收报告 | 报告正常显示 |
| 11 | 查看「台账报告」 | 显示施工进度台账，所有阶段状态正确 | 台账正常显示 |

**验证点总结**：
- ✅ 6大阶段顺序执行
- ✅ 流程互锁规则全程生效
- ✅ 每个阶段状态正确更新
- ✅ 我的数据中照片/报告/台账正常显示

---

### 3.3 验收整改复检流程（P1）

**场景描述**：验收未通过，完成整改和复检流程

| 步骤 | 操作 | 预期结果 | 验证点 |
|------|------|----------|--------|
| 1 | 完成S01隐蔽工程验收，AI分析未通过 | S01状态「待整改」，S02仍锁定 | 验收未通过 |
| 2 | 在P30验收页，点击「标记整改」 | 状态更新为「待整改」，需上传整改后照片 | 整改已标记 |
| 3 | 上传整改后照片（最多5张），点击「完成整改」 | 状态转为「待复检」 | 整改完成 |
| 4 | 点击「申请复检」 | 自动触发AI复检，状态「待复检」 | 复检已申请 |
| 5 | 等待复检完成 | 复检通过→状态「已通过」，解锁S02；复检未通过→提示整改建议 | 复检结果正常 |
| 6 | 复检未通过（第1次） | 提示整改建议，可再次申请复检 | 提示正常 |
| 7 | 复检未通过（第3次） | 引导转人工监理 | 引导正常 |

**验证点总结**：
- ✅ 验收未通过处理正常
- ✅ 整改流程完整
- ✅ 复检流程完整
- ✅ 复检通过解锁下一阶段
- ✅ 多次复检未通过引导转人工

---

### 3.4 报告解锁与支付流程（P1）

**场景描述**：普通用户解锁报告，完成支付流程

| 步骤 | 操作 | 预期结果 | 验证点 |
|------|------|----------|--------|
| 1 | 完成报价单分析，进入P06预览页 | 显示30%核心内容，解锁完整报告入口 | 预览正常显示 |
| 2 | 点击「解锁完整报告」 | 跳转P27报告解锁确认页，显示单份解锁/会员开通选择 | 跳转成功 |
| 3 | 选择「单份解锁9.9元」，点击「确认支付」 | 跳转P28支付页，显示订单信息 | 跳转成功 |
| 4 | 点击「微信支付」，完成支付 | 调起微信支付，支付成功 | 支付成功 |
| 5 | 支付成功后返回 | 报告已解锁，可查看完整内容 | 解锁成功 |
| 6 | 进入P24我的订单页 | 显示订单记录，状态为「已支付」 | 订单正常显示 |
| 7 | 点击订单详情 | 显示订单详细信息，含电子发票入口 | 详情正常显示 |

**验证点总结**：
- ✅ 报告预览正常
- ✅ 解锁确认页正常
- ✅ 支付流程完整
- ✅ 支付成功后解锁成功
- ✅ 订单记录正常

---

### 3.5 智能提醒流程（P1）

**场景描述**：设置提醒，验证提醒触发和联动规则

| 步骤 | 操作 | 预期结果 | 验证点 |
|------|------|----------|--------|
| 1 | 进入P09施工陪伴页，设置开工日期 | 6大阶段进度计划生成 | 计划生成成功 |
| 2 | 点击「提醒设置」，设置「提醒提前3天」 | 提醒设置保存成功，Toast提示「提醒设置成功」 | 设置成功 |
| 3 | 前置阶段未通过（S00未核对） | S01-S05提醒自动暂停，P09对应阶段卡片标注「提醒暂停」 | 暂停规则生效 |
| 4 | 完成S00核对 | S01提醒自动恢复，S01卡片「提醒暂停」标签消失 | 恢复规则生效 |
| 5 | 手动校准S01时间 | 提醒时间同步刷新 | 时间同步正常 |
| 6 | S01验收通过 | S01提醒永久失效，不再触发 | 失效规则生效 |
| 7 | 进入P14消息中心 | 显示施工提醒消息，未读标红 | 消息正常显示 |
| 8 | 点击消息 | 直达P09对应阶段卡片，未读红点消除 | 跳转正常 |

**验证点总结**：
- ✅ 提醒设置保存成功
- ✅ 前置未通过→后续提醒暂停
- ✅ 前置通过→后续提醒恢复
- ✅ 阶段完成→提醒永久失效
- ✅ 时间校准→提醒同步刷新
- ✅ 消息中心提醒正常

---

### 3.6 数据管理完整流程（P1）

**场景描述**：会员用户管理施工照片和报告数据

| 步骤 | 操作 | 预期结果 | 验证点 |
|------|------|----------|--------|
| 1 | 进入P20数据管理页 | 显示分类标签（施工照片/分析报告/台账报告/验收报告），数据列表 | 页面正常显示 |
| 2 | 点击「施工照片」标签 | 显示所有施工照片，按阶段分类 | 照片正常显示 |
| 3 | 进入批量模式，选择照片，点击「删除已选」 | 照片软删除，移入回收站，Toast提示「已删除，7天内可恢复」 | 删除成功 |
| 4 | 进入P21回收站页 | 显示已删除的照片，含「恢复」「永久删除」按钮 | 回收站正常显示 |
| 5 | 点击「恢复」 | 照片恢复，移出回收站 | 恢复成功 |
| 6 | 点击「永久删除」 | 照片永久删除，不可恢复 | 永久删除成功 |
| 7 | 返回P20，点击「分析报告」标签 | 显示所有分析报告（报价单/合同/公司检测） | 报告正常显示 |
| 8 | 点击报告「查看」 | 跳转对应报告详情页 | 跳转成功 |

**验证点总结**：
- ✅ 数据管理页正常显示
- ✅ 分类切换正常
- ✅ 批量删除正常
- ✅ 回收站恢复正常
- ✅ 永久删除正常
- ✅ 报告查看正常

---

### 3.7 城市选择与AI分析联动（P1）

**场景描述**：选择不同城市，验证AI分析结果基于城市规范

| 步骤 | 操作 | 预期结果 | 验证点 |
|------|------|----------|--------|
| 1 | 进入P38城市选择页，选择「深圳」 | 城市保存成功，返回首页，入口显示「深」 | 城市选择成功 |
| 2 | 上传报价单，完成分析 | 分析结果基于深圳本地市场价和规范 | 分析结果正确 |
| 3 | 返回首页，重新选择城市「北京」 | 城市保存成功，入口显示「北」 | 城市切换成功 |
| 4 | 上传新报价单，完成分析 | 分析结果基于北京本地市场价和规范 | 分析结果正确 |
| 5 | 进入P09，完成S01验收 | 验收结果基于北京本地验收规范 | 验收结果正确 |

**验证点总结**：
- ✅ 城市选择保存成功
- ✅ 城市切换成功
- ✅ AI分析结果基于城市规范
- ✅ 报价分析基于城市市场价
- ✅ 验收分析基于城市规范

---

### 3.8 异常场景处理（P1）

**场景描述**：验证各种异常场景的处理

| 步骤 | 操作 | 预期结果 | 验证点 |
|------|------|----------|--------|
| 1 | 网络断开，访问需认证接口 | 返回401或网络错误，前端跳转P33网络异常页 | 网络异常处理正常 |
| 2 | Token过期，访问需认证接口 | 返回401，前端清除token并跳转登录 | Token过期处理正常 |
| 3 | 上传文件>10MB | 返回400错误，Toast提示「文件不能超过10MB」 | 文件大小校验正常 |
| 4 | 上传非PDF/JPG/PNG格式 | 返回400错误，Toast提示「仅支持PDF/JPG/PNG格式」 | 文件格式校验正常 |
| 5 | 前置阶段未通过，尝试操作后续阶段 | 返回409错误，Toast提示「请先完成XX阶段验收/核对」 | 流程互锁校验正常 |
| 6 | 检测/分析超时 | 显示「分析超时，点击重试」，可重新触发 | 超时处理正常 |
| 7 | 数据加载失败 | 显示骨架屏或错误提示「点击重试」 | 加载失败处理正常 |

**验证点总结**：
- ✅ 网络异常处理正常
- ✅ Token过期处理正常
- ✅ 文件校验正常
- ✅ 流程互锁校验正常
- ✅ 超时处理正常
- ✅ 加载失败处理正常

---

## 四、集成测试用例

### 4.1 API接口集成测试

| 用例编号 | 测试场景 | 优先级 | 测试步骤 | 预期结果 |
|----------|----------|--------|----------|----------|
| TC-INTEGRATION-01 | 用户登录→获取信息→设置开工日期 | P0 | 1. POST /users/login<br>2. GET /users/profile<br>3. POST /constructions/start-date | 所有接口调用成功，数据正确 |
| TC-INTEGRATION-02 | 报价单上传→分析→报告查看 | P0 | 1. POST /quotes/upload<br>2. GET /quotes/quote/{id}<br>3. GET /reports/export-pdf | 流程完整，数据一致 |
| TC-INTEGRATION-03 | 材料核对→状态更新→施工照片写入 | P0 | 1. POST /material-checks/submit<br>2. PUT /constructions/stage-status<br>3. GET /construction-photos | 状态更新成功，照片写入成功 |
| TC-INTEGRATION-04 | 验收上传→AI分析→状态更新→解锁下一阶段 | P0 | 1. POST /acceptance/upload-photo<br>2. POST /acceptance/analyze<br>3. PUT /constructions/stage-status<br>4. GET /constructions/schedule | 流程完整，互锁规则生效 |

---

### 4.2 数据一致性测试

| 用例编号 | 测试场景 | 优先级 | 测试步骤 | 预期结果 |
|----------|----------|--------|----------|----------|
| TC-DATA-01 | 施工进度状态一致性 | P0 | 1. 更新阶段状态<br>2. 查询进度计划<br>3. 查询阶段状态 | 状态一致，无冲突 |
| TC-DATA-02 | 施工照片与验收记录一致性 | P1 | 1. 上传验收照片<br>2. 查询施工照片列表<br>3. 查询验收记录 | 照片URL一致，记录正确 |
| TC-DATA-03 | 提醒设置双向同步 | P1 | 1. 在P09设置提醒<br>2. 在P19查询提醒<br>3. 在P19修改提醒<br>4. 在P09查询提醒 | 双向同步成功 |

---

## 五、性能测试用例

| 用例编号 | 测试场景 | 优先级 | 测试步骤 | 预期结果 |
|----------|----------|--------|----------|----------|
| TC-PERF-01 | 页面加载时间 | P1 | 1. 打开各页面，记录加载时间 | 页面加载≤1.5秒 |
| TC-PERF-02 | API响应时间 | P1 | 1. 调用各API，记录响应时间 | API响应≤1秒（除AI分析） |
| TC-PERF-03 | AI分析时间 | P1 | 1. 提交AI分析，记录分析时间 | AI验收分析≤10秒，AI监理响应≤3秒 |
| TC-PERF-04 | 并发支持 | P2 | 1. 模拟50个并发请求 | 所有请求成功，无超时 |

---

## 六、安全测试用例

| 用例编号 | 测试场景 | 优先级 | 测试步骤 | 预期结果 |
|----------|----------|--------|----------|----------|
| TC-SECURITY-01 | Token认证校验 | P0 | 1. 无Token访问需认证接口 | 返回401错误 |
| TC-SECURITY-02 | 数据隔离校验 | P0 | 1. 用户A访问用户B的数据ID | 返回403或404错误 |
| TC-SECURITY-03 | 参数注入防护 | P1 | 1. 输入SQL注入/XSS攻击字符串 | 参数被过滤，无安全漏洞 |
| TC-SECURITY-04 | 文件上传安全 | P1 | 1. 上传恶意文件 | 文件类型校验，拒绝恶意文件 |

---

## 七、兼容性测试用例

| 用例编号 | 测试场景 | 优先级 | 测试步骤 | 预期结果 |
|----------|----------|--------|----------|----------|
| TC-COMPAT-01 | 微信小程序基础库版本 | P0 | 1. 在不同基础库版本（2.10.0+）测试 | 功能正常，无报错 |
| TC-COMPAT-02 | iOS/Android系统 | P0 | 1. 在iOS 14+/Android 10+测试 | 功能正常，UI适配正常 |
| TC-COMPAT-03 | 平板横向布局 | P2 | 1. 在平板设备横向布局测试 | UI适配正常，无错位 |

---

## 八、测试执行计划

### 8.1 测试优先级

1. **P0用例（阻塞）**：必须全部通过，否则无法发布
   - 用户登录认证
   - 核心业务流程（公司检测、报价分析、合同审核、施工进度）
   - 流程互锁规则
   - 数据一致性

2. **P1用例（高）**：重要功能，建议全部通过
   - 智能提醒功能
   - 验收整改复检
   - 支付订单流程
   - 数据管理功能

3. **P2用例（中）**：次要功能，可部分通过
   - 申诉功能
   - 分享功能
   - 特殊申请

4. **P3用例（低）**：可选功能，可延后测试

### 8.2 测试环境

- **开发环境**：120.26.201.61:8001
- **测试账号**：dev_weapp_mock（开发环境自动登录）
- **测试数据**：使用测试fixtures目录下的图片和文档

### 8.3 测试工具

- **API测试**：Python requests库（如test_construction_e2e_full.py）
- **E2E测试**：Python脚本 + 真实API调用
- **UI测试**：微信开发者工具 + 真机预览

---

## 九、测试报告模板

### 9.1 测试执行记录

| 用例编号 | 执行日期 | 执行人 | 结果 | 备注 |
|----------|----------|--------|------|------|
| TC-AUTH-01 | 2026-02-13 | 自动化测试 | ✅通过 | |
| TC-AUTH-02 | 2026-02-13 | 自动化测试 | ✅通过 | |
| ... | ... | ... | ... | |

### 9.2 缺陷记录

| 缺陷ID | 用例编号 | 缺陷描述 | 优先级 | 状态 | 修复日期 |
|--------|----------|----------|--------|------|----------|
| BUG-001 | TC-CONSTRUCTION-04 | 流程互锁规则未生效 | P0 | 已修复 | 2026-02-13 |
| ... | ... | ... | ... | ... | ... |

---

## 十、附录

### 10.1 测试数据准备

- **测试图片**：`tests/fixtures/` 目录下的验收照片
- **测试文档**：报价单、合同PDF/图片
- **测试账号**：dev_weapp_mock（开发环境）

### 10.2 参考文档

- PRD文档：`V2.6.1最新产品需求文档.md`
- 原型文档：`V2.6.1最新原型文档.md`
- API文档：`docs/API实现清单-PRD-V2.6.1.md`
- 现有测试：`tests/test_construction_e2e_full.py`

---

**说明**：本测试用例文档基于PRD V2.6.2设计，覆盖38个核心页面的主要功能点和端到端测试场景。建议优先执行P0用例，再覆盖P1用例，最后执行P2/P3用例。
