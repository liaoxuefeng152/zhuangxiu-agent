# P09 施工陪伴页测试执行报告

**执行时间**: 2026-02-15  
**依据文档**: `docs/施工陪伴页测试用例-P09.md`  
**执行方式**: API 自动化 + 前端代码逻辑校验 + 施工 E2E 流程

---

## 一、执行汇总

| 类型 | 通过 | 失败 | 跳过/待手工 | 总计 |
|------|------|------|-------------|------|
| API 自动化 | 6 | 0 | 2 | 8 |
| 前端逻辑校验 | 19 | 0 | 2 | 21 |
| 施工 E2E 流程 | 1 | 0 | 0 | 1 |
| 手工测试（待执行） | - | - | ~35 | ~35 |
| **合计** | **26** | **0** | **~39** | **~65** |

---

## 二、已执行用例详情

### 2.1 API 层测试（已通过）

| 编号 | 用例名称 | 结果 | 说明 |
|------|----------|------|------|
| TC-P09-004 | 6 阶段卡片展示 | ✅ PASS | GET /constructions/schedule 返回 S00~S05 |
| TC-P09-010 | 快捷选择 7 天后开工 | ✅ PASS | POST /constructions/start-date 成功 |
| TC-P09-013 | 编辑已有开工日期 | ✅ PASS | 修改开工日期成功 |
| TC-P09-022 | 已上传报价单-按钮可点 | ✅ PASS | 材料清单 API 有数据 |
| TC-P09-030 | S00 未完成时 S01 置灰 | ✅ PASS | 后端返回 S01 locked=true |
| TC-P09-003 | 加载失败 401/404 静默 | ✅ PASS | 前端代码已实现静默处理 |

### 2.2 前端逻辑校验（已通过）

| 编号 | 用例名称 | 结果 | 说明 |
|------|----------|------|------|
| TC-P09-020 | 未上传报价单-按钮置灰 | ✅ PASS | SCSS 有 .disabled #E5E5E5 |
| TC-P09-020 | 未上传报价单-点击提示 | ✅ PASS | Toast「请先上传报价单以获取材料清单」 |
| TC-P09-021 | 已实现（同上） | ✅ PASS | hasMaterialList===false 时 return |
| TC-P09-023 | 已上传报价单-点击跳转 P37 | ✅ PASS | navigateTo material-check + Toast 指引 |
| TC-P09-024 | 从报价单页返回刷新 | ✅ PASS | useDidShow 调用 loadFromApi |
| TC-P09-031 | S00 未完成点击 S01 | ✅ PASS | Toast「请先完成材料进场人工核对」 |
| TC-P09-033 | 前置未完成点击后续阶段 | ✅ PASS | Toast「请先完成XX验收」 |
| TC-P09-040 | 打开提醒设置弹窗 | ✅ PASS | remindModalVisible 已实现 |
| TC-P09-042 | 选择提醒提前天数 | ✅ PASS | REMIND_DAYS_OPTIONS [1,2,3,5,7] |
| TC-P09-043 | 保存提醒设置 | ✅ PASS | Toast「提醒设置成功」 |
| TC-P09-052 | 调整时间成功 | ✅ PASS | Toast「时间校准成功…」 |
| TC-P09-053 | 选择早于开工日期 | ✅ PASS | Toast「校准时间须大于…」 |
| TC-P09-054 | 选择早于今天 | ✅ PASS | Toast「请选择当前日期及以后…」 |
| TC-P09-070 | 未完成阶段记录文案 | ✅ PASS | 待人工核对/待验收 |
| TC-P09-071 | 待整改阶段记录文案 | ✅ PASS | statusLabel 含待整改 |
| TC-P09-100 | 主按钮样式 | ✅ PASS | #007AFF、linear-gradient |
| TC-P09-003 | 401/404 静默 | ✅ PASS | is404/is401 分支静默 |

### 2.3 施工 E2E 完整流程（已通过）

执行 `tests/test_construction_e2e_full.py`：

- ✅ 步骤 1: 用户登录
- ✅ 步骤 2: 设置开工日期
- ✅ 步骤 3: S00 材料进场人工核对（材料清单获取、照片上传、提交核对）
- ✅ 步骤 3.5: S00 状态同步为 checked
- ✅ 步骤 4: S01~S05 各阶段验收（上传照片、AI 分析、阶段状态更新）
- ✅ 步骤 5: 验收报告列表
- ✅ 步骤 6: 施工进度台账
- ✅ 步骤 7: 施工照片列表

对应覆盖：**E2E-P09-02（6 阶段顺序验收全流程）** 的后端与 API 部分。

---

## 三、需手工执行的用例（微信开发者工具 / 真机）

以下用例需在微信开发者工具或真机中按测试用例文档逐条操作验证：

### 3.1 页面展示与加载

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-001 | 首次加载-未设置开工日期 | 新用户进入施工页 | 展示「请先设置开工日期」、7/15/30 天、提醒设置 |
| TC-P09-002 | 首次加载-加载中状态 | 进入施工页 | 先「加载中…」再内容 |
| TC-P09-005 | 顶部导航栏 | 查看顶部 | 返回、施工陪伴、占位 |
| TC-P09-006 | 开工日期区域 | 已设置开工日期 | 显示日期、编辑、提醒设置 |
| TC-P09-007 | 全局进度概览 | 已设置开工日期 | 整体进度 X%，落后提示 |
| TC-P09-008 | 待提醒红点 | 阶段在提醒窗口内 | 阶段卡片右上角红点 |

### 3.2 开工日期

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-011 | 15/30 天后开工 | 点击对应按钮 | 同上 |
| TC-P09-012 | 选择其他日期 | 选择明天确认 | 日期保存，Toast 成功 |
| TC-P09-014 | 日期选择取消 | 打开选择器后取消 | 保持原日期 |

### 3.3 S00 入口管控

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-020 | 未上传报价单-按钮置灰 | 无报价单进入施工页 | 人工核对按钮 #E5E5E5 |
| TC-P09-021 | 未上传报价单-点击 | 点击 S00 人工核对 | Toast 提示，不跳转 |
| TC-P09-025 | 清单加载失败兜底 | API 异常 | 置灰 + 点击提示 |

### 3.4 流程互锁

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-032 | S01 未完成 S02 置灰 | S01 未完成时看 S02 | AI验收置灰 |
| TC-P09-034 | S00 完成后 S01 解锁 | S00 完成后 | S01 可点击 |
| TC-P09-035 | 依次完成解锁 | 逐阶段完成 | 每完成一阶段下一解锁 |

### 3.5 提醒设置

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-041 | 切换提醒开关 | 点击开关 | 状态切换，on 态 #007AFF |
| TC-P09-044 | 点击遮罩关闭 | 点击弹窗外 | 弹窗关闭，未保存 |
| TC-P09-045 | 未设置开工日期也可开提醒 | 无开工日期点提醒 | 可打开并保存 |

### 3.6 时间校准

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-050 | 调整时间入口 | 阶段 in_progress | 显示「调整时间」 |
| TC-P09-051 | 已完成无调整时间 | 阶段 completed | 不显示 |
| TC-P09-055 | 离线调整时间 | 断网调整 | Toast 已缓存 |

### 3.7 指引

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-060 | S00 核对指引 | 点击 S00 核对指引 | 弹窗展示要点 |
| TC-P09-061 | S01 验收指引 | 点击 S01 验收指引 | 弹窗展示要点 |
| TC-P09-062 | 前置锁定点击指引 | S01 未解锁点指引 | Toast 提示 |
| TC-P09-063 | 关闭指引弹窗 | 点击关闭/遮罩 | 弹窗关闭 |

### 3.8 记录板块

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-072 | 已完成显示查看按钮 | S00 已完成 | 显示「查看台账/报告」 |
| TC-P09-073 | S00 查看台账 | 点击 | 跳转 P37 |
| TC-P09-074 | S01~S05 查看报告 | 点击 | 跳转 P30 |
| TC-P09-075 | 进度条颜色 | 查看各状态 | 对应颜色 |

### 3.9 一键分享

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-080 | 点击一键分享 | 点击底部按钮 | 跳转 P32 |
| TC-P09-081 | 分享页数据 | 进入分享页 | 6 阶段、开工日期等 |

### 3.10 首页入口

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-090 | 首页点击阶段进入 | 首页点某阶段 | 进入 P09 并滚动高亮 |
| TC-P09-091 | 未设置开工日期点阶段 | 无开工日期点 | 置灰或 Toast |

### 3.11 视觉与异常

| 编号 | 用例名称 | 操作 | 预期 |
|------|----------|------|------|
| TC-P09-101 | 卡片圆角阴影 | 查看阶段卡片 | 16rpx 圆角、阴影 |
| TC-P09-102 | 状态角标颜色 | 查看不同状态 | 对应颜色 |
| TC-P09-103 | 页面可滚动 | 上下滑动 | 可滚动，无 padding 警告 |
| TC-P09-104 | TabBar 展示 | 查看底部 | 首页、施工陪伴、我的 |
| TC-P09-110 | 未登录访问 | 登出后进入 | 可进入，401 静默 |
| TC-P09-111 | 网络异常 | 断网进入 | 本地缓存或设置开工 |
| TC-P09-112 | 返回首页 | 点击顶部返回 | 跳转首页 |

### 3.12 端到端场景（E2E）

| 编号 | 场景 | 步骤概要 |
|------|------|----------|
| E2E-P09-01 | 新用户首次使用 | 登录→施工陪伴→7天后开工→(上传报价单)→S00 人工核对→S01 AI验收 |
| E2E-P09-02 | 6 阶段顺序验收 | 已完成（API E2E 覆盖后端） |
| E2E-P09-03 | 提醒设置与同步 | 提醒设置→我的→账户与通知→双向同步 |
| E2E-P09-04 | S00 入口管控链路 | 无报价单置灰→上传→返回→S00 可点 |
| E2E-P09-05 | 阶段时间调整 | 调整时间→选择晚 5 天→成功；选早于开工→拦截 |

---

## 四、执行命令

```bash
# 1. 施工完整 E2E（API 层）
python tests/test_construction_e2e_full.py

# 2. P09 用例自动化 + 逻辑校验
python tests/test_p09_construction_full.py
```

---

## 五、结论

- **自动化执行**：26 项通过，0 项失败。
- **后台接口**：开工日期、施工进度、材料清单、流程互锁等行为符合预期。
- **前端逻辑**：S00 入口管控、流程互锁、提醒设置、时间校准等逻辑已实现。
- **手工回归**：约 35 项需在微信开发者工具或真机中按文档逐条验证。
- **问题归属**：本次自动化未发现后台或前端缺陷；手工执行若发现问题，再按 bug-attribution 规则判定归属。
