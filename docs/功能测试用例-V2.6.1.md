# 装修避坑管家 - 功能测试用例（PRD V2.6.1）

**版本**：V2.6.1  
**依据文档**：V2.6.1最新产品需求文档.md（对齐V15.3原型）  
**适用范围**：微信小程序功能测试  
**更新日期**：2026-02-08

---

## 一、测试用例说明

| 字段 | 说明 |
|------|------|
| 用例编号 | TC-模块-序号 |
| 优先级 | P0=阻塞、P1=高、P2=中、P3=低 |
| 功能ID | 对应 PRD 中的 FR-xxx |
| 测试类型 | 功能测试、接口测试、UI测试、集成测试 |

---

## 二、核心功能模块测试用例

### 2.1 用户认证模块（P01/P02/P10）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|----------|--------|----------|--------|----------|----------|----------|
| TC-AUTH-01 | FR-001 | 引导页首次展示 | P0 | 首次打开小程序 | 1. 打开小程序 | 展示3张引导页，品牌图标、主副标题、核心能力展示 |
| TC-AUTH-02 | FR-002 | 引导页滑动切换 | P1 | 在引导页 | 1. 左右滑动 | 可切换3张，页码指示器更新，倒计时重置 |
| TC-AUTH-03 | FR-003 | 开始使用跳转 | P0 | 在引导页 | 1. 点击「开始使用」 | 跳转至首页，缓存onboarding_completed=true |
| TC-AUTH-04 | FR-003 | 权限请求弹窗 | P1 | 首次进入首页 | 1. 跳转后 | 弹出「进度+消息提醒权限请求」弹窗 |
| TC-AUTH-05 | FR-003 | 权限拒绝处理 | P2 | 权限请求弹窗 | 1. 点击「拒绝」 | 不影响首页使用，仅关闭微信服务通知 |
| TC-AUTH-06 | - | 开发环境模拟登录 | P0 | 开发环境 | 1. POST /api/v1/users/login<br>2. body: {"code":"dev_h5_mock"} | 返回JWT token和用户信息 |
| TC-AUTH-07 | - | 用户信息获取 | P0 | 已登录 | 1. GET /api/v1/users/profile<br>2. Header: Authorization Bearer token | 返回用户信息（头像、昵称、会员状态） |

### 2.2 公司风险检测模块（P03/P04/P11）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|----------|--------|----------|--------|----------|----------|----------|
| TC-COMPANY-01 | FR-011 | 公司名称输入 | P0 | 在公司输入页 | 1. 输入公司名称（≥3字符） | 支持输入，自动去空格，最大50字符 |
| TC-COMPANY-02 | FR-012 | 公司名称模糊搜索 | P1 | 在公司输入页 | 1. 输入≥3字符<br>2. GET /api/v1/companies/search?q=xxx | 返回匹配结果列表，最多5条 |
| TC-COMPANY-03 | FR-013 | 提交公司检测 | P0 | 已输入有效公司名 | 1. POST /api/v1/companies/scan<br>2. body: {"company_name":"xxx"} | 返回scan_id，状态为analyzing |
| TC-COMPANY-04 | FR-014 | 检测进度展示 | P0 | 从公司输入页跳转 | 1. 进入检测中页 | 显示加载动画+进度条+实时剩余时间 |
| TC-COMPANY-05 | FR-014 | 检测结果查询 | P0 | 检测进行中/完成 | 1. GET /api/v1/companies/scan/{scan_id} | 返回检测状态和结果（如完成） |
| TC-COMPANY-06 | - | 检测记录列表 | P1 | 已登录 | 1. GET /api/v1/companies/scans | 返回用户的所有检测记录 |
| TC-COMPANY-07 | - | 公司风险报告详情 | P0 | 检测完成 | 1. GET /api/v1/companies/scan/{scan_id} | 返回风险等级、详情、风险原因等 |

### 2.3 报价单分析模块（P05/P06/P12）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|----------|--------|----------|--------|----------|----------|----------|
| TC-QUOTE-01 | FR-016 | 未检测公司提示 | P1 | 未检测公司 | 1. 进入报价单上传页 | 顶部显示红色提示条，含「立即检测」按钮 |
| TC-QUOTE-02 | FR-017 | 报价单文件上传 | P0 | 在报价单页 | 1. POST /api/v1/quotes/upload<br>2. 上传PDF/JPG/PNG文件（≤10MB） | 返回quote_id，状态为analyzing |
| TC-QUOTE-03 | FR-017 | 文件格式校验 | P1 | 选择文件 | 1. 上传非PDF/JPG/PNG格式 | 返回400错误，提示「仅支持PDF/JPG/PNG」 |
| TC-QUOTE-04 | FR-017 | 文件大小校验 | P1 | 选择文件 | 1. 上传>10MB文件 | 返回400错误，提示「文件不能超过10MB」 |
| TC-QUOTE-05 | FR-018 | 报价单分析结果 | P0 | 分析完成 | 1. GET /api/v1/quotes/quote/{quote_id} | 返回风险等级、漏项/虚高分析、预估省钱金额 |
| TC-QUOTE-06 | FR-034 | 报价单报告预览 | P1 | 有分析结果 | 1. 进入报价单报告页 | 显示核心风险展示、前3项漏项/虚高项（30%核心内容） |
| TC-QUOTE-07 | - | 报价单列表 | P1 | 已登录 | 1. GET /api/v1/quotes/list | 返回用户的所有报价单记录 |

### 2.4 合同审核模块（P07/P08/P13）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|----------|--------|----------|--------|----------|----------|----------|
| TC-CONTRACT-01 | FR-016 | 合同文件上传 | P0 | 在合同页 | 1. POST /api/v1/contracts/upload<br>2. 上传PDF/JPG/PNG文件（≤10MB） | 返回contract_id，状态为analyzing |
| TC-CONTRACT-02 | FR-017 | 合同分析结果 | P0 | 分析完成 | 1. GET /api/v1/contracts/contract/{contract_id} | 返回风险等级、风险条款、修正建议 |
| TC-CONTRACT-03 | FR-033 | 合同报告预览 | P1 | 有分析结果 | 1. 进入合同报告页 | 显示核心风险条款展示、前3项霸王条款（30%核心内容） |
| TC-CONTRACT-04 | - | 合同列表 | P0 | 已登录 | 1. GET /api/v1/contracts/list | 返回用户的所有合同记录 |
| TC-CONTRACT-05 | - | 合同详情（含summary） | P0 | 有合同记录 | 1. GET /api/v1/contracts/contract/{contract_id} | 返回完整合同分析结果，包含summary字段 |

### 2.5 施工进度管理模块（P09）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|----------|--------|----------|--------|----------|----------|----------|
| TC-CONSTRUCTION-01 | FR-011 | 设置开工日期 | P0 | 无开工日期 | 1. POST /api/v1/constructions/start-date<br>2. body: {"start_date":"2026-02-15"} | 返回成功，自动计算6大阶段预计时间 |
| TC-CONSTRUCTION-02 | FR-011 | 编辑开工日期 | P1 | 已设置开工日期 | 1. PUT /api/v1/constructions/start-date<br>2. body: {"start_date":"2026-02-20"} | 阶段时间自动重新推算 |
| TC-CONSTRUCTION-03 | FR-012 | 进度计划查询 | P0 | 已设置开工日期 | 1. GET /api/v1/constructions/schedule | 返回6大阶段（S00-S05）进度计划，含locked状态 |
| TC-CONSTRUCTION-04 | FR-013 | 流程互锁规则 | P0 | 前置阶段未通过 | 1. PUT /api/v1/constructions/stage-status<br>2. 尝试操作未解锁阶段 | 返回409错误，提示「请先完成XX阶段验收/核对」 |
| TC-CONSTRUCTION-05 | FR-012 | 更新阶段状态 | P0 | 阶段已解锁 | 1. PUT /api/v1/constructions/stage-status<br>2. body: {"stage":"S01","status":"completed"} | 状态更新成功，后续阶段时间自动推算 |
| TC-CONSTRUCTION-06 | FR-015 | 阶段时间校准 | P1 | 在施工陪伴页 | 1. PUT /api/v1/constructions/stage-calibrate<br>2. body: {"stage":"S01","start_date":"2026-02-25"} | 校准成功，提醒时间同步刷新 |
| TC-CONSTRUCTION-07 | FR-014 | 智能提醒设置 | P1 | 在施工陪伴页 | 1. PUT /api/v1/users/settings<br>2. body: {"reminder_days":3} | 提醒设置保存成功 |

### 2.6 材料进场人工核对模块（P37）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|----------|--------|----------|--------|----------|----------|----------|
| TC-MATERIAL-01 | FR-019 | 材料清单加载 | P0 | 已上传报价单 | 1. 进入材料核对页 | 自动同步报价单材料清单，按关键材料→辅助材料排序 |
| TC-MATERIAL-02 | FR-020 | 材料拍照上传 | P0 | 在材料核对页 | 1. 点击「拍照/上传」<br>2. POST /api/v1/construction-photos/upload | 上传成功，显示缩略图 |
| TC-MATERIAL-03 | FR-021 | 资料核查上传 | P1 | 关键材料 | 1. 上传出厂合格证/质保书/CCC认证 | 上传成功，勾选框变为#007AFF对勾 |
| TC-MATERIAL-04 | FR-022 | 问题标注输入 | P2 | 有材料不符 | 1. 输入问题描述（≤100字） | 输入成功，实时显示字数 |
| TC-MATERIAL-05 | FR-023 | 核对通过提交 | P0 | 所有材料已上传 | 1. 点击「核对通过」 | S00状态更新为「已核对」，解锁S01 |
| TC-MATERIAL-06 | FR-023 | 核对未通过提交 | P0 | 有材料不符 | 1. 点击「核对未通过」<br>2. 输入原因（≥10字） | S00状态为「待整改」 |

### 2.7 阶段验收模块（P30）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|----------|--------|----------|--------|----------|----------|----------|
| TC-ACCEPTANCE-01 | FR-024 | 验收结果展示 | P0 | 有验收记录 | 1. GET /api/v1/acceptance/{analysis_id} | 返回验收状态、验收项数、合格数、不合格数 |
| TC-ACCEPTANCE-02 | FR-025 | 标记整改 | P1 | 验收未通过 | 1. POST /api/v1/acceptance/{id}/mark-rectify<br>2. 上传整改后照片 | 阶段状态更新为「待整改」 |
| TC-ACCEPTANCE-03 | FR-025 | 申请复检 | P1 | 整改完成 | 1. POST /api/v1/acceptance/{id}/request-recheck<br>2. 上传整改后照片 | 自动触发AI复检，状态转为「待复检」 |
| TC-ACCEPTANCE-04 | FR-026 | 申诉功能 | P2 | 验收未通过 | 1. POST /api/v1/appeals<br>2. body: {"stage":"S01","reason":"xxx","photos":[]} | 申诉提交成功，状态显示「申诉中」 |
| TC-ACCEPTANCE-05 | FR-027 | AI监理咨询入口 | P1 | 在验收页 | 1. GET /api/v1/consultation/quota | 返回免费额度/会员次数 |
| TC-ACCEPTANCE-06 | FR-028 | PDF导出 | P1 | 报告已解锁 | 1. GET /api/v1/reports/export-pdf?report_type=acceptance&id=xxx | 返回PDF文件 |

### 2.8 报告中心模块（P18）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|----------|--------|----------|--------|----------|----------|----------|
| TC-REPORT-01 | - | 报告列表查询 | P0 | 已登录 | 1. GET /api/v1/contracts/list | 返回合同报告列表 |
| TC-REPORT-02 | - | 报告列表分页 | P1 | 有多条报告 | 1. GET /api/v1/contracts/list?page=1&page_size=10 | 返回分页数据，包含total、page、page_size |
| TC-REPORT-03 | - | 报告详情查看 | P0 | 有报告记录 | 1. GET /api/v1/contracts/contract/{contract_id} | 返回完整报告详情 |
| TC-REPORT-04 | - | 报告数据隔离 | P1 | 用户A登录 | 1. 尝试访问用户B的报告ID | 返回403或404错误 |

### 2.9 消息中心模块（P14）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|----------|--------|----------|--------|----------|----------|----------|
| TC-MESSAGE-01 | FR-031 | 消息列表查询 | P0 | 已登录 | 1. GET /api/v1/messages | 返回消息列表，未读标红 |
| TC-MESSAGE-02 | FR-031 | 未读消息数量 | P1 | 有未读消息 | 1. GET /api/v1/messages/unread-count | 返回未读数量 |
| TC-MESSAGE-03 | - | 单条消息已读 | P1 | 有未读消息 | 1. PUT /api/v1/messages/{msg_id}/read | 消息标记为已读 |
| TC-MESSAGE-04 | - | 一键已读 | P1 | 有未读消息 | 1. PUT /api/v1/messages/read-all | 所有消息标记为已读 |

### 2.10 城市选择模块（P38）

| 用例编号 | 功能ID | 用例名称 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|----------|--------|----------|--------|----------|----------|----------|
| TC-CITY-01 | FR-033 | 热门城市查询 | P1 | 在城市选择页 | 1. GET /api/v1/cities/hot | 返回热门城市列表 |
| TC-CITY-02 | FR-034 | 城市列表查询 | P1 | 在城市选择页 | 1. GET /api/v1/cities/list | 返回省份-城市列表 |
| TC-CITY-03 | FR-036 | 选择城市保存 | P0 | 选择城市后 | 1. POST /api/v1/cities/select<br>2. body: {"city_name":"深圳"} | 城市保存成功 |
| TC-CITY-04 | - | 当前城市查询 | P1 | 已选择城市 | 1. GET /api/v1/cities/current | 返回当前选中城市 |

---

## 三、非功能测试用例

| 用例编号 | 类别 | 用例名称 | 优先级 | 测试步骤 | 预期结果 |
|----------|------|----------|--------|----------|----------|
| TC-NF-01 | 性能 | 健康检查响应时间 | P1 | GET /health | 响应时间≤500ms |
| TC-NF-02 | 性能 | 登录接口响应时间 | P1 | POST /api/v1/users/login | 响应时间≤1s |
| TC-NF-03 | 性能 | 报告列表加载时间 | P1 | GET /api/v1/contracts/list | 响应时间≤1.5s |
| TC-NF-04 | 安全 | Token认证校验 | P0 | 无Token访问需认证接口 | 返回401错误 |
| TC-NF-05 | 安全 | 数据隔离校验 | P1 | 用户A访问用户B数据 | 返回403或404错误 |
| TC-NF-06 | 兼容 | CORS跨域配置 | P1 | 前端跨域请求 | 允许前端域名访问 |
| TC-NF-07 | 异常 | 网络异常处理 | P1 | 模拟网络超时 | 返回友好错误提示 |
| TC-NF-08 | 异常 | 参数校验 | P1 | 传入无效参数 | 返回400错误，提示具体原因 |

---

## 四、测试执行记录

| 用例编号 | 执行日期 | 执行人 | 结果 | 备注 |
|----------|----------|--------|------|------|
| TC-AUTH-06 | 2026-02-08 | 自动化测试 | 待执行 | |
| TC-AUTH-07 | 2026-02-08 | 自动化测试 | 待执行 | |
| TC-COMPANY-03 | 2026-02-08 | 自动化测试 | 待执行 | |
| TC-CONTRACT-04 | 2026-02-08 | 自动化测试 | 待执行 | |
| TC-CONSTRUCTION-01 | 2026-02-08 | 自动化测试 | 待执行 | |
| ... | ... | ... | ... | |

---

**说明**：本测试用例基于PRD V2.6.1设计，覆盖38个核心页面的主要功能点。建议优先执行P0用例，再覆盖P1用例。
