---
description: 开发部署流程 - 本地修改 → Git 提交 → 阿里云更新
alwaysApply: true
---

# 部署流程规范

本项目使用**阿里云开发环境**（120.26.201.61），每次改动必须按以下顺序执行：

## 1. 在本地项目修改

- 所有代码改动先在本地项目 `/Users/mac/zhuangxiu-agent-backup-dev` 完成
- 修改后本地测试验证

## 2. 提交到 Git

```bash
git add .
git commit -m "描述本次修改"
git push
```

## 3. 更新阿里云开发环境

- **服务器项目目录**：`/root/project/dev/zhuangxiu-agent`
- **开发后端容器**：`zhuangxiu-backend-dev`
- **SSH 连接命令（固定使用密钥）**：`ssh -i ~/zhuangxiu-agent1.pem root@120.26.201.61`
- **更新步骤**：SSH 登录后拉取最新代码，重新构建并重启容器

```bash
# SSH 登录（必须使用指定密钥）
ssh -i ~/zhuangxiu-agent1.pem root@120.26.201.61

# 进入项目目录
cd /root/project/dev/zhuangxiu-agent

# 拉取最新代码
git pull

# 若有后端代码改动，需重新构建并重启
docker compose -f docker-compose.dev.yml build backend --no-cache
docker compose -f docker-compose.dev.yml up -d backend

# 或仅重启（未改 Dockerfile 时）
docker compose -f docker-compose.dev.yml restart backend
# 或：docker restart zhuangxiu-backend-dev
```

### 后台改动必须更新阿里云并重启

**约定**：只要是**后台 bug 修复**或**修改了后台代码**（`backend/` 下任何文件），都必须：

1. 本地 `git add` / `commit` / `push`
2. 在阿里云开发环境执行更新并重启：
   - 使用 `ssh -i ~/zhuangxiu-agent1.pem root@120.26.201.61` 登录
   - `cd /root/project/dev/zhuangxiu-agent` → `git pull`
   - 重启后端服务（见上方命令）

未在阿里云执行上述步骤前，后台修改不会在 120.26.201.61 上生效。

**重要提醒**：
- ✅ 每次更新代码后，必须先 `git push` 到远程仓库
- ✅ 后台有改动时，必须 SSH 到服务器执行 `git pull` 并重启后端服务
- ✅ SSH 固定使用：`ssh -i ~/zhuangxiu-agent1.pem root@120.26.201.61`
- ❌ **禁止**：直接修改阿里云服务器上的代码，或跳过 Git 推送直接部署
