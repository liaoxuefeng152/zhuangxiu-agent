---
description: 开发部署流程 - 本地修改 → Git 提交 → 阿里云更新
alwaysApply: true
---

# 部署流程规范

本项目使用**阿里云开发环境**（120.26.201.61），每次改动必须按以下顺序执行：

## 1. 在本地项目修改

- 所有代码改动先在本地项目 `/Users/mac/zhuangxiu-agent-backup-dev` 完成
- 修改后本地测试验证

## 2. 提交到 Git

```bash
git add .
git commit -m "描述本次修改"
git push
```

## 3. 更新阿里云开发环境

- **服务器项目目录**：`/root/project/dev/zhuangxiu-agent`
- **开发后端容器**：`zhuangxiu-backend-dev`
- **SSH 连接命令（固定使用密钥）**：`ssh -i ~/zhuangxiu-agent1.pem root@120.26.201.61`
- **更新步骤**：SSH 登录后拉取最新代码，重新构建并重启容器

```bash
# SSH 登录（必须使用指定密钥）
ssh -i ~/zhuangxiu-agent1.pem root@120.26.201.61

# 进入项目目录
cd /root/project/dev/zhuangxiu-agent

# 拉取最新代码
git pull

# 若有后端代码改动，需重新构建并重启
docker compose -f docker-compose.dev.yml build backend --no-cache
docker compose -f docker-compose.dev.yml up -d backend

# 或仅重启（未改 Dockerfile 时）
docker compose -f docker-compose.dev.yml restart backend
# 或：docker restart zhuangxiu-backend-dev
```

### 改后端代码后必须：提交 git → 更新阿里云 → 重启服务

**记住**：只要改了**后端代码**（`backend/` 下任何文件），必须完整做三步，否则线上不生效：

1. **提交到 Git**：`git add` 相关文件 → `git commit -m "..."` → `git push`
2. **更新到阿里云**：SSH 登录服务器后 `cd /root/project/dev/zhuangxiu-agent` → `git pull`（若有冲突可先 `git stash` 再 pull）
3. **重启后端服务**：`docker compose -f docker-compose.dev.yml build backend --no-cache && docker compose -f docker-compose.dev.yml up -d backend`（或仅 `restart backend`）

操作顺序不可省略：先 push，再在服务器上 pull 并重启。禁止直接在服务器改代码或跳过 Git 部署。

**重要提醒**：
- ✅ 每次更新代码后，必须先 `git push` 到远程仓库
- ✅ 后台有改动时，必须 SSH 到服务器执行 `git pull` 并重启后端服务
- ✅ SSH 固定使用：`ssh -i ~/zhuangxiu-agent1.pem root@120.26.201.61`
- ❌ **禁止**：直接修改阿里云服务器上的代码，或跳过 Git 推送直接部署
