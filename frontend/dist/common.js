"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[2076],{8179:function(e,t,n){n(6540);var r=n(118),o=n(1281),a=n(4848),i={report:{text:"\u6682\u65e0\u62a5\u544a\u6570\u636e",action:"\u53bb\u68c0\u6d4b",url:"/pages/company-scan/index"},photo:{text:"\u6682\u65e0\u65bd\u5de5\u7167\u7247",action:"\u53bb\u62cd\u6444",url:"/pages/photo/index"},order:{text:"\u6682\u65e0\u8ba2\u5355",action:"\u53bb\u4e0b\u5355",url:"/pages/index/index"},message:{text:"\u6682\u65e0\u6d88\u606f",action:"",url:""}},s=function(e){var t=e.type,n=void 0===t?"report":t,s=e.text,c=e.actionText,u=e.actionUrl,d=i[n]||i.report,l=null!==s&&void 0!==s?s:d.text,f=null!==c&&void 0!==c?c:d.action,p=null!==u&&void 0!==u?u:d.url,g=function(){p&&(0,o.EH)(p)};return(0,a.jsxs)(r.Ss,{className:"empty-state",children:[(0,a.jsx)(r.EY,{className:"empty-icon",children:"\ud83d\udccb"}),(0,a.jsx)(r.EY,{className:"empty-text",children:l}),f&&(0,a.jsx)(r.Ss,{className:"empty-btn",onClick:g,children:(0,a.jsx)(r.EY,{children:f})})]})};t.A=s},2719:function(e,t,n){n(6540);var r=n(118),o=n(4848),a=function(e){var t=e.visible,n=e.title,a=e.content,i=e.imageUrl,s=e.onClose;return t?(0,o.jsx)(r.Ss,{className:"example-modal-mask",onClick:s,children:(0,o.jsxs)(r.Ss,{className:"example-modal",onClick:function(e){return e.stopPropagation()},children:[(0,o.jsx)(r.EY,{className:"example-modal-title",children:n}),i?(0,o.jsx)(r._V,{src:i,className:"example-img",mode:"widthFix",showMenuByLongpress:!0}):null,(0,o.jsx)(r.EY,{className:"example-modal-content",children:a}),(0,o.jsx)(r.EY,{className:"example-modal-close",onClick:s,children:"\u6211\u77e5\u9053\u4e86"})]})}):null};t.A=a},3247:function(e,t,n){n.d(t,{ih:function(){return i},uK:function(){return c},wC:function(){return a}});var r="https://zhuangxiu-images.oss-cn-hangzhou.aliyuncs.com",o=["assets/banners/banner1.png","assets/banners/banner2.png","assets/banners/banner3.png"],a=r?["".concat(r.replace(/\/$/,""),"/banners/banner1.png"),"".concat(r.replace(/\/$/,""),"/banners/banner2.png"),"".concat(r.replace(/\/$/,""),"/banners/banner3.png")]:o,i=a.some(function(e){return!!e}),s="https://zhuangxiu-images.oss-cn-hangzhou.aliyuncs.com",c={company:s?"".concat(s.replace(/\/$/,""),"/examples/company_sample.png"):"",quote:s?"".concat(s.replace(/\/$/,""),"/examples/quote_sample.png"):"",contract:s?"".concat(s.replace(/\/$/,""),"/examples/contract_sample.png"):"",acceptance:s?"".concat(s.replace(/\/$/,""),"/examples/acceptance_sample.png"):""}},3:function(e,t,n){n.r(t),n.d(t,{env:function(){return a}});var r=n(9379),o=function(){var e="http://120.26.201.61:8001/api/v1",t={apiBaseUrl:e,apiTimeout:parseInt("30000"),enableCache:!0,debugMode:!1};return(0,r.A)((0,r.A)({},t),{},{apiTimeout:parseInt("30000")})},a=o();t["default"]=a},4746:function(e,t,n){n.r(t),n.d(t,{acceptanceApi:function(){return X},clearAuthToken:function(){return S},companyApi:function(){return O},constructionApi:function(){return q},constructionPhotoApi:function(){return J},consultationApi:function(){return B},contractApi:function(){return N},deleteWithAuth:function(){return x},designerApi:function(){return Z},feedbackApi:function(){return D},getAuthHeaders:function(){return A},getWithAuth:function(){return _},invitationsApi:function(){return Q},materialChecksApi:function(){return L},materialLibraryApi:function(){return M},materialsApi:function(){return z},messageApi:function(){return R},paymentApi:function(){return F},pointsApi:function(){return W},postWithAuth:function(){return k},putWithAuth:function(){return b},quoteApi:function(){return U},reportApi:function(){return $},setAuthToken:function(){return y},userApi:function(){return H}});var r=n(1212),o=n(467),a=n(2284),i=n(5544),s=n(758),c=n.n(s),u=n(1083),d=n(7273),l=n(7022),f=n(6327),p=n(4532),g=n(3),v=n(7842)["URLSearchParams"],m=g.env.apiBaseUrl,h=function(){return c().getStorageSync("token")||c().getStorageSync("access_token")||""};function y(e,t){c().setStorageSync("token",e),c().setStorageSync("access_token",e),c().setStorageSync("user_id",t),c().setStorageSync("login_fresh_at",Date.now()),w(e,t)}function S(){c().removeStorageSync("token"),c().removeStorageSync("access_token"),c().removeStorageSync("user_id"),w(null,null)}function w(e,t){var n;if("undefined"!==typeof I){var r=null===(n=I.defaults)||void 0===n?void 0:n.headers;r&&(r.common=r.common||{},e?(r.common["Authorization"]="Bearer ".concat(e),r.common["X-User-Id"]=null!=t?String(t):""):(delete r.common["Authorization"],delete r.common["X-User-Id"]))}}var A=function(){var e={"Content-Type":"application/json"},t=h(),n=c().getStorageSync("user_id");return t&&(e["Authorization"]="Bearer ".concat(t)),null!=n&&""!==n&&""!==String(n).trim()&&(e["X-User-Id"]=String(n).trim()),e};function C(){S();try{l.A.dispatch((0,p.ri)())}catch(e){}var e=c().getStorageSync("onboarding_completed")||c().getStorageSync("has_onboarded");e?(c().reLaunch({url:"/pages/index/index"}),setTimeout(function(){c().showModal({title:"\u767b\u5f55\u5df2\u8fc7\u671f",content:"\u60a8\u7684\u767b\u5f55\u5df2\u8fc7\u671f\u6216\u9700\u8981\u91cd\u65b0\u9a8c\u8bc1\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u540e\u7ee7\u7eed\u4f7f\u7528",showCancel:!0,cancelText:"\u77e5\u9053\u4e86",confirmText:"\u53bb\u767b\u5f55",success:function(e){e.confirm&&c().switchTab({url:"/pages/profile/index"})}})},500)):c().reLaunch({url:"/pages/onboarding/index"})}function _(e,t){var n=e.startsWith("http")?e:"".concat(m).concat(e);if(t&&Object.keys(t).length>0){var r=new v;Object.entries(t).forEach(function(e){var t=(0,i.A)(e,2),n=t[0],o=t[1];void 0!==o&&""!==o&&r.set(n,String(o))});var o=r.toString();o&&(n+=(n.includes("?")?"&":"?")+o)}return c().request({url:n,method:"GET",header:A()}).then(function(e){var t,n;if(401===e.statusCode)return C(),Promise.reject(new Error("\u672a\u6388\u6743"));if(e.statusCode>=400){var r,o,a=new Error((null===(r=e.data)||void 0===r?void 0:r.detail)||(null===(o=e.data)||void 0===o?void 0:o.msg)||"\u8bf7\u6c42\u5931\u8d25 ".concat(e.statusCode));return a.statusCode=e.statusCode,a.response={status:e.statusCode},Promise.reject(a)}return null!==(t=null===(n=e.data)||void 0===n?void 0:n.data)&&void 0!==t?t:e.data})}function k(e,t){var n=e.startsWith("http")?e:"".concat(m).concat(e);return c().request({url:n,method:"POST",header:A(),data:null!==t&&void 0!==t?t:{}}).then(function(e){var t,n;if(401===e.statusCode)return C(),Promise.reject(new Error("\u672a\u6388\u6743"));if(e.statusCode>=400){var r,o,i=new Error((null===(r=e.data)||void 0===r?void 0:r.detail)||(null===(o=e.data)||void 0===o?void 0:o.msg)||"\u8bf7\u6c42\u5931\u8d25 ".concat(e.statusCode));return i.statusCode=e.statusCode,i.response={status:e.statusCode,data:e.data},403===e.statusCode&&e.data&&"object"===(0,a.A)(e.data)?e.data:Promise.reject(i)}return null!==(t=null===(n=e.data)||void 0===n?void 0:n.data)&&void 0!==t?t:e.data})}function b(e,t){var n=e.startsWith("http")?e:"".concat(m).concat(e);return c().request({url:n,method:"PUT",header:A(),data:null!==t&&void 0!==t?t:{}}).then(function(e){var t,n;if(401===e.statusCode)return C(),Promise.reject(new Error("\u672a\u6388\u6743"));if(e.statusCode>=400){var r,o,a=new Error((null===(r=e.data)||void 0===r?void 0:r.detail)||(null===(o=e.data)||void 0===o?void 0:o.msg)||"\u8bf7\u6c42\u5931\u8d25 ".concat(e.statusCode));return a.statusCode=e.statusCode,a.response={status:e.statusCode},Promise.reject(a)}return null!==(t=null===(n=e.data)||void 0===n?void 0:n.data)&&void 0!==t?t:e.data})}function x(e){var t=e.startsWith("http")?e:"".concat(m).concat(e);return c().request({url:t,method:"DELETE",header:A()}).then(function(e){var t,n;if(401===e.statusCode)return C(),Promise.reject(new Error("\u672a\u6388\u6743"));if(e.statusCode>=400){var r,o,a=new Error((null===(r=e.data)||void 0===r?void 0:r.detail)||(null===(o=e.data)||void 0===o?void 0:o.msg)||"\u8bf7\u6c42\u5931\u8d25 ".concat(e.statusCode));return a.statusCode=e.statusCode,a.response={status:e.statusCode},Promise.reject(a)}return null!==(t=null===(n=e.data)||void 0===n?void 0:n.data)&&void 0!==t?t:e.data})}var j=function(e){var t=c().getStorageSync("access_token"),n=c().getStorageSync("user_id");return E(e,t,n)},E=function(e,t,n){var r=new v;t&&r.set("access_token",t),null!=n&&""!==n&&""!==String(n).trim()&&r.set("user_id",String(n).trim());var o=r.toString();return o?"".concat(e).concat(e.includes("?")?"&":"?").concat(o):e},P=function(e,t){var n={};return e&&(n["Authorization"]="Bearer ".concat(e)),null!=t&&""!==t&&""!==String(t).trim()&&(n["X-User-Id"]=String(t).trim()),n},T={baseURL:m,timeout:3e4,headers:{"Content-Type":"application/json"}};T.adapter=d.A,T.headers&&"object"===(0,a.A)(T.headers)||(T.headers={"Content-Type":"application/json"});var I=u.A.create(T);console.log("[API\u521d\u59cb\u5316] \u5f00\u59cb\u6ce8\u518c\u8bf7\u6c42\u62e6\u622a\u5668"),I.interceptors.request.use(function(e){if(console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] \u88ab\u8c03\u7528",e.url,"method:",e.method),e.headers&&"object"===(0,a.A)(e.headers)&&!Array.isArray(e.headers)||(console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] headers\u4e0d\u662f\u5bf9\u8c61\uff0c\u91cd\u65b0\u521b\u5efa",(0,a.A)(e.headers)),e.headers={}),e.headers&&(e.headers.constructor!==Object||"AxiosHeaders"===e.headers.constructor.name)){var t;console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] headers\u4e0d\u662f\u666e\u901a\u5bf9\u8c61\uff0c\u8f6c\u6362",(null===(t=e.headers.constructor)||void 0===t?void 0:t.name)||"unknown");for(var n={},r=Object.keys(e.headers),o=0,i=r;o<i.length;o++){var s=i[o],u=e.headers[s];null!=u&&(n[s]=String(u))}e.headers=n}e.headers["Content-Type"]||e.headers["content-type"]||(e.headers["Content-Type"]="application/json");var d=h(),l=c().getStorageSync("user_id");if(console.log("[\u8bf7\u6c42\u62e6\u622a\u5668]",e.url,"token:",d?"\u5b58\u5728(".concat(d.substring(0,20),"...)"):"\u4e0d\u5b58\u5728","userId:",l||"\u65e0"),d?(e.headers.Authorization="Bearer ".concat(d),console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] \u5df2\u6dfb\u52a0Authorization header")):(delete e.headers.Authorization,console.warn("[\u8bf7\u6c42\u62e6\u622a\u5668] \u26a0\ufe0f token\u4e0d\u5b58\u5728\uff0c\u65e0\u6cd5\u6dfb\u52a0Authorization header")),null!=l&&""!==l&&""!==String(l).trim()?(e.headers["X-User-Id"]=String(l).trim(),console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] \u5df2\u6dfb\u52a0X-User-Id header:",l)):delete e.headers["X-User-Id"],!e.headers||"object"!==(0,a.A)(e.headers)||Array.isArray(e.headers)||e.headers.constructor!==Object){var f,p;console.error("[\u8bf7\u6c42\u62e6\u622a\u5668] \u26a0\ufe0f headers\u4ecd\u7136\u4e0d\u662f\u666e\u901a\u5bf9\u8c61\uff0c\u5f3a\u5236\u91cd\u5efa");var g={"Content-Type":(null===(f=e.headers)||void 0===f?void 0:f["Content-Type"])||(null===(p=e.headers)||void 0===p?void 0:p["content-type"])||"application/json"};d&&(g.Authorization="Bearer ".concat(d)),null!=l&&""!==l&&""!==String(l).trim()&&(g["X-User-Id"]=String(l).trim()),e.headers=g}else d&&!e.headers.Authorization&&(e.headers.Authorization="Bearer ".concat(d),console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] \u8865\u5145\u6dfb\u52a0Authorization header")),null==l||""===l||""===String(l).trim()||e.headers["X-User-Id"]||(e.headers["X-User-Id"]=String(l).trim());if(e.headers&&"object"===(0,a.A)(e.headers)&&!Array.isArray(e.headers)||(e.headers={}),e.headers.constructor!==Object){var v={};for(var m in e.headers)e.headers.hasOwnProperty(m)&&(v[m]=String(e.headers[m]));e.headers=v}return e},function(e){return console.error("[\u8bf7\u6c42\u62e6\u622a\u5668\u9519\u8bef]",e),Promise.reject(e)}),I.interceptors.response.use(function(e){var t=e.data,n=null===t||void 0===t?void 0:t.code,r=null===t||void 0===t?void 0:t.msg,o=null===t||void 0===t?void 0:t.data;return 0===n?o:void 0===n&&t&&"object"===(0,a.A)(t)&&!t.error_id?t:(c().showToast({title:r||(null===t||void 0===t?void 0:t.detail)||"\u8bf7\u6c42\u5931\u8d25",icon:"none",duration:2e3}),Promise.reject(new Error(r||"\u8bf7\u6c42\u5931\u8d25")))},function(e){var t,n,r,o,a=null!==(t=null===(n=e.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail)&&void 0!==t?t:null===(r=e.response)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.msg,s="string"===typeof a?a:Array.isArray(a)&&null!==(o=a[0])&&void 0!==o&&o.msg?a[0].msg:null,u=s||"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25";if(e.response){var d=e.response.status;switch(d){case 401:u="\u767b\u5f55\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55";var g=e.config,v=!0===(null===g||void 0===g?void 0:g.skip401Handler),m=(null===g||void 0===g?void 0:g.url)||"",h=m.includes("/users/profile"),y=c().getStorageSync("login_fresh_at"),w=Date.now(),A=y&&w-Number(y)<3e4;if(v||A||h){A&&c().removeStorageSync("login_fresh_at");var C=new Error("\u8bf7\u7a0d\u540e\u91cd\u8bd5");return C.isSilent=!0,C.isProfileApi=h,Promise.reject(C)}S();try{l.A.dispatch((0,p.ri)())}catch(e){}var _=c().getStorageSync("onboarding_completed")||c().getStorageSync("has_onboarded");_?(c().reLaunch({url:"/pages/index/index"}),setTimeout(function(){c().showModal({title:"\u767b\u5f55\u5df2\u8fc7\u671f",content:"\u60a8\u7684\u767b\u5f55\u5df2\u8fc7\u671f\u6216\u9700\u8981\u91cd\u65b0\u9a8c\u8bc1\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u540e\u7ee7\u7eed\u4f7f\u7528",showCancel:!0,cancelText:"\u77e5\u9053\u4e86",confirmText:"\u53bb\u767b\u5f55",success:function(e){e.confirm&&c().switchTab({url:"/pages/profile/index"})}})},500)):c().reLaunch({url:"/pages/onboarding/index"});break;case 403:u=s||"\u65e0\u6743\u9650\u8bbf\u95ee";break;case 404:u=s||"\u8bf7\u6c42\u7684\u8d44\u6e90\u4e0d\u5b58\u5728";break;case 500:u=s||"\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef";break;default:u=s||"\u8bf7\u6c42\u9519\u8bef: ".concat(d)}}else if(e.request){u="\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc",l.A.dispatch((0,f.t)(!0));try{var k,b=c().getCurrentInstance(),x=null!==(k=b.router)&&void 0!==k&&k.path?"".concat(b.router.path).concat(b.router.params&&Object.keys(b.router.params).length?"?"+Object.entries(b.router.params).map(function(e){var t=(0,i.A)(e,2),n=t[0],r=t[1];return"".concat(n,"=").concat(r)}).join("&"):""):"";c().redirectTo({url:"/pages/network-error/index"+(x?"?from="+encodeURIComponent(x):"")})}catch(e){c().showToast({title:u,icon:"none",duration:2e3})}return Promise.reject(e)}return c().showToast({title:u,icon:"none",duration:2e3}),Promise.reject(e)});var H={login:function(e){return I.post("/users/login",{code:e})},getProfile:function(){return I.get("/users/profile")},updateProfile:function(e){return I.put("/users/profile",e)}},O={scan:function(e){return I.post("/companies/scan",{company_name:e})},getResult:function(e){return I.get("/companies/scan/".concat(e))},getList:function(e){return I.get("/companies/scans",{params:e})},search:function(e,t){return I.get("/companies/search",{params:{q:e,limit:t||5}})}},U={upload:function(e,t){return new Promise(function(t,n){c().uploadFile({url:j("".concat(m,"/quotes/upload")),filePath:e,name:"file",header:A(),success:function(e){try{var r=JSON.parse(e.data);t(r)}catch(e){n(e)}},fail:n})})},getAnalysis:function(e){return I.get("/quotes/quote/".concat(e))},getList:function(e){return I.get("/quotes/list",{params:e})}},N={upload:function(e,t){return new Promise(function(t,n){c().uploadFile({url:j("".concat(m,"/contracts/upload")),filePath:e,name:"file",header:A(),success:function(e){try{var r=JSON.parse(e.data);t(r)}catch(e){n(e)}},fail:n})})},getAnalysis:function(e){return I.get("/contracts/contract/".concat(e))},getList:function(e){return I.get("/contracts/list",{params:e})}},q={getSchedule:function(){return I.get("/constructions/schedule",{skip401Handler:!0})},setStartDate:function(e){return I.post("/constructions/start-date",{start_date:e})},updateStageStatus:function(e,t){return I.put("/constructions/stage-status",{stage:e,status:t})},calibrateStageEnd:function(e,t){return I.post("/constructions/calibrate",{stage:e,end_date:t})},resetSchedule:function(){return I.delete("/constructions/schedule")}},z={verify:function(){return console.warn("materialsApi.verify \u5df2\u5e9f\u5f03\uff0c\u8bf7\u4f7f\u7528 constructionApi.updateStageStatus"),I.put("/constructions/stage-status",{stage:"S00",status:"checked"})}},L={getMaterialList:function(){return _("/material-checks/material-list")},submit:function(e){var t=h();return t?k("/material-checks/submit",e):Promise.reject(new Error("\u767b\u5f55\u5df2\u5931\u6548\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55"))}},M={search:function(e,t,n){return I.get("/material-library/search",{params:{keyword:e,category:t,city_code:n}})},getCommon:function(e){return I.get("/material-library/common",{params:{category:e}})},match:function(e,t){return I.post("/material-library/match",{material_names:e,city_code:t})}},F={createOrder:function(e){var t=h();return t?k("/payments/create",e):Promise.reject(new Error("\u8bf7\u5148\u767b\u5f55"))},pay:function(e){var t=h();return t?k("/payments/pay",{order_id:e}):Promise.reject(new Error("\u8bf7\u5148\u767b\u5f55"))},confirmPaid:function(e){var t=h();return t?k("/payments/confirm-paid",{order_id:e}):Promise.reject(new Error("\u8bf7\u5148\u767b\u5f55"))},getOrders:function(e){var t=h();return t?_("/payments/orders",e):Promise.reject(new Error("\u8bf7\u5148\u767b\u5f55"))},getOrder:function(e){var t=h();return t?_("/payments/order/".concat(e)):Promise.reject(new Error("\u8bf7\u5148\u767b\u5f55"))}},R={getList:function(e){return _("/messages",e)},getUnreadCount:function(){return _("/messages/unread-count")},markRead:function(e){return b("/messages/".concat(e,"/read"),{})},markAllRead:function(){return b("/messages/read-all",{})},delete:function(e){return x("/messages/".concat(e))}},D={submit:function(e,t){return I.post("/feedback",{content:e,images:t})}},J={getUploadPolicy:function(e){return I.get("/oss/upload-policy",{params:{stage:e}})},register:function(e,t){return I.post("/construction-photos/register",{stage:e,key:t})},uploadDirect:function(){var e=(0,o.A)((0,r.A)().m(function e(t,n){var a,i,s,u,d,l,f,p;return(0,r.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,I.get("/oss/upload-policy",{params:{stage:n}});case 1:return a=e.v,i=a.host,s=a.policy,u=a.OSSAccessKeyId,d=a.signature,l=a.dir,f=(t.split(".").pop()||"jpg").toLowerCase().replace("jpeg","jpg")||"jpg",p="".concat(l).concat(Date.now(),"_").concat(Math.floor(1e4*Math.random()),".").concat(f),e.a(2,new Promise(function(e,a){c().uploadFile({url:i,filePath:t,name:"file",formData:{key:p,policy:s,OSSAccessKeyId:u,Signature:d,success_action_status:"200"},success:function(){var t=(0,o.A)((0,r.A)().m(function t(o){var s,c;return(0,r.A)().w(function(t){while(1)switch(t.p=t.n){case 0:if(!(o.statusCode>=200&&o.statusCode<300)){t.n=5;break}return t.p=1,t.n=2,I.post("/construction-photos/register",{stage:n,key:p});case 2:s=t.v,e(null!==s&&void 0!==s&&s.file_url?s:{file_url:"".concat(i,"/").concat(p)}),t.n=4;break;case 3:t.p=3,c=t.v,a(c);case 4:t.n=6;break;case 5:a(new Error("string"===typeof o.data?o.data:"\u4e0a\u4f20\u5931\u8d25 ".concat(o.statusCode)));case 6:return t.a(2)}},t,null,[[1,3]])}));function s(e){return t.apply(this,arguments)}return s}(),fail:a})}));case 2:return e.p=2,e.v,e.a(2,J.upload(t,n))}},e,null,[[0,2]])}));function t(t,n){return e.apply(this,arguments)}return t}(),upload:function(e,t){return new Promise(function(n,r){var o=(m||"").replace(/\/$/,""),a=j("".concat(o,"/construction-photos/upload?stage=").concat(encodeURIComponent(t))),i=c().getStorageSync("access_token"),s=c().getStorageSync("user_id"),u={};i&&(u["access_token"]=i),null!=s&&""!==String(s).trim()&&(u["user_id"]=String(s).trim()),c().uploadFile({url:a,filePath:e,name:"file",formData:u,header:A(),success:function(e){if(e.statusCode<200||e.statusCode>=300){var t="\u4e0a\u4f20\u5931\u8d25 ".concat(e.statusCode);try{var o,a,i="string"===typeof e.data?JSON.parse(e.data):e.data,s=null!==(o=null===i||void 0===i?void 0:i.detail)&&void 0!==o?o:null===i||void 0===i?void 0:i.msg;"string"===typeof s&&s?t=s:Array.isArray(s)&&null!==(a=s[0])&&void 0!==a&&a.msg&&(t=s[0].msg),401===e.statusCode&&(t="\u8bf7\u5148\u767b\u5f55")}catch(e){}r(new Error(t))}else try{var c,u="string"===typeof e.data?JSON.parse(e.data):e.data,d=null!==(c=null===u||void 0===u?void 0:u.data)&&void 0!==c?c:u;n(null!==d&&void 0!==d&&d.file_url?d:{file_url:d})}catch(e){r(new Error("\u89e3\u6790\u5931\u8d25"))}},fail:function(e){return r(e instanceof Error?e:new Error((null===e||void 0===e?void 0:e.errMsg)||"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25"))}})})},getList:function(e){var t=e?{stage:e}:{};return I.get("/construction-photos",{params:t})},delete:function(e){return x("/construction-photos/".concat(e))},move:function(e,t){return I.put("/construction-photos/".concat(e,"/move"),{stage:t})}},X={uploadPhoto:function(e,t){var n,r,o=null!==(n=null===t||void 0===t?void 0:t.token)&&void 0!==n?n:h(),a=null!==(r=null===t||void 0===t?void 0:t.userId)&&void 0!==r?r:c().getStorageSync("user_id"),i=E("".concat(m,"/acceptance/upload-photo"),o,a),s=t?P(o,a):A(),u={};return o&&(u["access_token"]=o),null!=a&&""!==a&&""!==String(a).trim()&&(u["user_id"]=String(a).trim()),new Promise(function(t,n){c().uploadFile({url:i,filePath:e,name:"file",formData:u,header:s,success:function(e){if(e.statusCode<200||e.statusCode>=300)try{var r,o,a="string"===typeof e.data?JSON.parse(e.data):e.data,i=null!==(r=null===a||void 0===a?void 0:a.detail)&&void 0!==r?r:null===a||void 0===a?void 0:a.msg,s="string"===typeof i?i:Array.isArray(i)&&null!==(o=i[0])&&void 0!==o&&o.msg?i[0].msg:"\u4e0a\u4f20\u5931\u8d25 ".concat(e.statusCode);n(new Error(401===e.statusCode?"\u8bf7\u5148\u767b\u5f55":s))}catch(t){n(new Error("\u4e0a\u4f20\u5931\u8d25 ".concat(e.statusCode)))}else try{var c,u="string"===typeof e.data?JSON.parse(e.data):e.data,d=null!==(c=null===u||void 0===u?void 0:u.data)&&void 0!==c?c:u;t(d&&(d.file_url||d.object_key)?d:{})}catch(e){n(new Error("\u89e3\u6790\u5931\u8d25"))}},fail:function(e){return n(e instanceof Error?e:new Error((null===e||void 0===e?void 0:e.errMsg)||"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25"))}})})},analyze:function(e,t){return k("/acceptance/analyze",{stage:e,file_urls:t})},getResult:function(e){return _("/acceptance/".concat(e))},getList:function(e){var t=e||{},n={};return null!=t.stage&&(n.stage=t.stage),null!=t.page&&(n.page=t.page),null!=t.page_size&&(n.page_size=t.page_size),_("/acceptance",n)},requestRecheck:function(e,t){return k("/acceptance/".concat(e,"/request-recheck"),{rectified_photo_urls:t})},markPassed:function(e,t,n){return k("/acceptance/".concat(e,"/mark-passed"),{confirm_photo_urls:t,confirm_note:n})}},B={createSession:function(e){return k("/consultation/session",e)},sendMessage:function(e,t,n){return k("/consultation/message",{session_id:e,content:t||void 0,images:null!==n&&void 0!==n&&n.length?n:void 0})}},W={shareReward:function(e,t,n){return k("/points/share-reward",{share_type:e,resource_type:t,resource_id:n})},getRecords:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return _("/points/records",{page:e,page_size:t})},getSummary:function(){return _("/points/summary")}},$={getExportPdfUrl:function(e,t){return"".concat(m,"/reports/export-pdf?report_type=").concat(e,"&resource_id=").concat(t)},downloadPdf:function(e,t,n){return new Promise(function(n,r){var o="".concat(m,"/reports/export-pdf?report_type=").concat(e,"&resource_id=").concat(t),a=j(o);c().downloadFile({url:a,header:A(),success:function(e){if(200===e.statusCode){var t=e.tempFilePath;c().openDocument({filePath:t,fileType:"pdf"}).then(function(){return n(t)}).catch(function(e){c().saveFile({tempFilePath:t}).then(function(e){return n(e.savedFilePath)}).catch(function(){return n(t)})})}else 403===e.statusCode?r(new Error("\u8bf7\u5148\u89e3\u9501\u62a5\u544a")):401===e.statusCode?r(new Error("\u8bf7\u5148\u767b\u5f55")):404===e.statusCode?r(new Error("\u62a5\u544a\u4e0d\u5b58\u5728")):r(new Error("\u5bfc\u51fa\u5931\u8d25(".concat(e.statusCode,")")))},fail:function(e){return r(null!==e&&void 0!==e&&e.errMsg?new Error(e.errMsg):e)}})})}},Q={createInvitation:function(e){return k("/invitations/create",e||{})},checkInvitationStatus:function(){return _("/invitations/status")},getFreeUnlockEntitlements:function(){return _("/invitations/entitlements")},useFreeUnlock:function(e,t){return k("/invitations/use-free-unlock",{report_type:e,report_id:t})},checkInvitationCode:function(e){return k("/invitations/check-invitation-code?invitation_code="+encodeURIComponent(e),{})}},Z={consult:function(e,t){return k("/designer/consult",{question:e,context:t})},healthCheck:function(){return _("/designer/health")},createChatSession:function(e){return k("/designer/sessions",{initial_question:e})},sendChatMessage:function(e,t,n){return k("/designer/chat",{session_id:e,message:t,image_urls:n})},uploadImage:function(e,t){return new Promise(function(t,n){var r=h(),o=c().getStorageSync("user_id"),a=E("".concat(m,"/designer/upload-image"),r,o),i=P(r,o),s={};r&&(s["access_token"]=r),null!=o&&""!==o&&""!==String(o).trim()&&(s["user_id"]=String(o).trim()),c().uploadFile({url:a,filePath:e,name:"file",formData:s,header:i,success:function(e){if(e.statusCode<200||e.statusCode>=300){var r="\u4e0a\u4f20\u5931\u8d25 ".concat(e.statusCode);try{var o,a,i="string"===typeof e.data?JSON.parse(e.data):e.data,s=null!==(o=null===i||void 0===i?void 0:i.detail)&&void 0!==o?o:null===i||void 0===i?void 0:i.msg;"string"===typeof s&&s?r=s:Array.isArray(s)&&null!==(a=s[0])&&void 0!==a&&a.msg&&(r=s[0].msg),401===e.statusCode&&(r="\u8bf7\u5148\u767b\u5f55")}catch(e){}n(new Error(r))}else try{var c,u="string"===typeof e.data?JSON.parse(e.data):e.data,d=null!==(c=null===u||void 0===u?void 0:u.data)&&void 0!==c?c:u;t(null!==d&&void 0!==d&&d.image_url?d:{image_url:d})}catch(e){n(new Error("\u89e3\u6790\u5931\u8d25"))}},fail:function(e){return n(e instanceof Error?e:new Error((null===e||void 0===e?void 0:e.errMsg)||"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25"))}})})},getChatSession:function(e){return _("/designer/sessions/".concat(e))},listChatSessions:function(){return _("/designer/sessions")},clearChatHistory:function(e){return k("/designer/clear",{session_id:e})},deleteChatSession:function(e){return x("/designer/sessions/".concat(e))}}},215:function(e,t,n){n.d(t,{G:function(){return a},j:function(){return o}});var r=n(1468),o=r.wA,a=r.d4},7022:function(e,t,n){n.d(t,{A:function(){return E}});var r=n(3816),o=n(4532),a={currentScan:null,scanHistory:[]},i=(0,r.Z0)({name:"company",initialState:a,reducers:{setCurrentScan:function(e,t){e.currentScan=t.payload},setScanHistory:function(e,t){e.scanHistory=t.payload},addScanToHistory:function(e,t){e.scanHistory.unshift(t.payload)}}}),s=i.actions,c=(s.setCurrentScan,s.setScanHistory,s.addScanToHistory,i.reducer),u={currentQuote:null,quoteHistory:[]},d=(0,r.Z0)({name:"quote",initialState:u,reducers:{setCurrentQuote:function(e,t){e.currentQuote=t.payload},setQuoteHistory:function(e,t){e.quoteHistory=t.payload},addQuoteToHistory:function(e,t){e.quoteHistory.unshift(t.payload)}}}),l=d.actions,f=(l.setCurrentQuote,l.setQuoteHistory,l.addQuoteToHistory,d.reducer),p={currentContract:null,contractHistory:[]},g=(0,r.Z0)({name:"contract",initialState:p,reducers:{setCurrentContract:function(e,t){e.currentContract=t.payload},setContractHistory:function(e,t){e.contractHistory=t.payload},addContractToHistory:function(e,t){e.contractHistory.unshift(t.payload)}}}),v=g.actions,m=(v.setCurrentContract,v.setContractHistory,v.addContractToHistory,g.reducer),h=n(9379),y={schedule:null},S=(0,r.Z0)({name:"construction",initialState:y,reducers:{setSchedule:function(e,t){e.schedule=t.payload},updateSchedule:function(e,t){e.schedule&&(e.schedule=(0,h.A)((0,h.A)({},e.schedule),t.payload))}}}),w=S.actions,A=(w.setSchedule,w.updateSchedule,S.reducer),C={currentOrder:null,orderHistory:[]},_=(0,r.Z0)({name:"order",initialState:C,reducers:{setCurrentOrder:function(e,t){e.currentOrder=t.payload},setOrderHistory:function(e,t){e.orderHistory=t.payload},addOrderToHistory:function(e,t){e.orderHistory.unshift(t.payload)}}}),k=_.actions,b=(k.setCurrentOrder,k.setOrderHistory,k.addOrderToHistory,_.reducer),x=n(6327),j=(0,r.U1)({reducer:{user:o.Ay,network:x.A,company:c,quote:f,contract:m,construction:A,order:b},middleware:function(e){return e({serializableCheck:!1})}}),E=j},6327:function(e,t,n){n.d(t,{t:function(){return a}});var r=n(3816),o=(0,r.Z0)({name:"network",initialState:{error:!1},reducers:{setNetworkError:function(e,t){e.error=t.payload}}}),a=o.actions.setNetworkError;t.A=o.reducer},4532:function(e,t,n){n.d(t,{bu:function(){return d},iA:function(){return c},ri:function(){return u}});var r=n(9379),o=n(3816),a={userInfo:null,isLoggedIn:!1},i=(0,o.Z0)({name:"user",initialState:a,reducers:{setUserInfo:function(e,t){e.userInfo=t.payload,e.isLoggedIn=!0},logout:function(e){e.userInfo=null,e.isLoggedIn=!1},updateUserInfo:function(e,t){e.userInfo&&(e.userInfo=(0,r.A)((0,r.A)({},e.userInfo),t.payload))}}}),s=i.actions,c=s.setUserInfo,u=s.logout,d=s.updateUserInfo;t.Ay=i.reducer},1578:function(e,t,n){function r(e){var t,n,r,o;if(!e)return!0;var a=(null!==(t=e.summary)&&void 0!==t?t:"").toString(),i=null===(n=e.suggestions)||void 0===n?void 0:n[0];return!!(/\u6682\u4e0d\u53ef\u7528|\u8bf7\u7a0d\u540e\u91cd\u8bd5|\u5206\u6790\u670d\u52a1/.test(a)||i&&/AI\u5206\u6790\u6682\u4e0d\u53ef\u7528|\u8bf7\u7a0d\u540e\u91cd\u8bd5/.test((null!==(r=i.item)&&void 0!==r?r:"")+(null!==(o=i.action)&&void 0!==o?o:"")))}function o(e){var t,n,r,o,a,i=null!==(t=null===e||void 0===e?void 0:e.issues)&&void 0!==t?t:[],s=null!==(n=null===e||void 0===e?void 0:e.suggestions)&&void 0!==n?n:[],c=null!==(r=null===e||void 0===e?void 0:e.summary)&&void 0!==r?r:"",u=null!==(o=null===(a=s[0])||void 0===a?void 0:a.action)&&void 0!==o?o:"\u8bf7\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6574\u6539",d=i.map(function(e,t){var n,r,o,a,i,c,d,l,f=(e.severity||"low").toLowerCase(),p="high"===f?"high":"warning"===f?"mid":"low",g=null!==(n=null!==(r=null===(o=s[t])||void 0===o?void 0:o.action)&&void 0!==r?r:null===(a=s[0])||void 0===a?void 0:a.action)&&void 0!==n?n:u;return{level:p,title:null!==(i=null!==(c=e.category)&&void 0!==c?c:e.description)&&void 0!==i?i:"\u9a8c\u6536\u9879",desc:null!==(d=null!==(l=e.description)&&void 0!==l?l:e.category)&&void 0!==d?d:"",suggest:g}});return 0!==d.length||"pass"!==(null===e||void 0===e?void 0:e.severity)&&null!==e&&void 0!==e&&e.severity||d.push({level:"low",title:"\u9a8c\u6536\u901a\u8fc7",desc:c||"\u8be5\u9636\u6bb5\u9a8c\u6536\u57fa\u672c\u5408\u683c",suggest:"\u4fdd\u6301"}),{items:d}}n.d(t,{B:function(){return r},a:function(){return o}})},5649:function(e,t,n){n.d(t,{wD:function(){return i}});var r=n(758),o=n.n(r);function a(){var e=o().getStorageSync("access_token");return!!e}function i(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"profile";return!!a()||(e&&o().showModal({title:"\u9700\u8981\u767b\u5f55",content:"\u6b64\u529f\u80fd\u9700\u8981\u767b\u5f55\uff0c\u662f\u5426\u524d\u5f80\u767b\u5f55\uff1f",confirmText:"\u53bb\u767b\u5f55",cancelText:"\u53d6\u6d88",success:function(e){e.confirm&&("profile"===t?o().switchTab({url:"/pages/profile/index"}):o().switchTab({url:"/pages/index/index"}))}}),!1)}},5898:function(e,t,n){n.d(t,{$f:function(){return d},Ax:function(){return c},PR:function(){return u},Wj:function(){return i},li:function(){return l}});var r=n(5544),o=n(758),a=n.n(o),i="construction_stage_status",s={material:"S00",plumbing:"S01",carpentry:"S02",woodwork:"S03",painting:"S04",installation:"S05"},c=(Object.fromEntries(Object.entries(s).map(function(e){var t=(0,r.A)(e,2),n=t[0],o=t[1];return[o,n]})),function(e){return s[e]||e}),u=function(e){return"material"===e?"checked":"passed"},d=function(e,t){if(!e)return"material"===t?"in_progress":"pending";var n=String(null!==e&&void 0!==e?e:"").toLowerCase();return["checked","passed","completed"].includes(n)?"completed":"rectify_exhausted"===n?"rectify_done":["rectify","need_rectify","pending_recheck"].includes(n)?"rectify":["in_progress","checking"].includes(n)||"material"===t?"in_progress":"pending"},l=function(e,t){try{var n=a().getStorageSync(i),r=n?JSON.parse(n):{};r[e]=d(t,e),a().setStorageSync(i,JSON.stringify(r))}catch(e){}}},1281:function(e,t,n){n.d(t,{EH:function(){return d},EN:function(){return i},XS:function(){return p},w8:function(){return a}});var r=n(758),o=n.n(r),a="/pages/index/index",i="/pages/construction/index",s="/pages/profile/index",c=[a,i,s];function u(e){var t=(e||"").split("?")[0].trim();return c.some(function(e){return t===e||t.endsWith(e)})}function d(e){if(e)if(u(e)){var t=e.split("?")[0].trim();o().switchTab({url:t})}else o().navigateTo({url:e})}var l=120,f=300;function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.defer,r=void 0===n?l:n,a=t.retry,i=void 0===a||a,s=function(){o().switchTab({url:e,fail:function(t){var n;i&&null!==t&&void 0!==t&&null!==(n=t.errMsg)&&void 0!==n&&n.includes("timeout")&&setTimeout(function(){o().switchTab({url:e})},f)}})};r>0?setTimeout(s,r):s()}}}]);