"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[2076],{8179:function(e,t,n){n(6540);var r=n(118),o=n(1281),a=n(4848),i={report:{text:"\u6682\u65e0\u62a5\u544a\u6570\u636e",action:"\u53bb\u68c0\u6d4b",url:"/pages/company-scan/index"},photo:{text:"\u6682\u65e0\u65bd\u5de5\u7167\u7247",action:"\u53bb\u62cd\u6444",url:"/pages/photo/index"},order:{text:"\u6682\u65e0\u8ba2\u5355",action:"\u53bb\u4e0b\u5355",url:"/pages/index/index"},message:{text:"\u6682\u65e0\u6d88\u606f",action:"",url:""}},c=function(e){var t=e.type,n=void 0===t?"report":t,c=e.text,s=e.actionText,u=e.actionUrl,l=i[n]||i.report,d=null!==c&&void 0!==c?c:l.text,p=null!==s&&void 0!==s?s:l.action,f=null!==u&&void 0!==u?u:l.url,g=function(){f&&(0,o.EH)(f)};return(0,a.jsxs)(r.Ss,{className:"empty-state",children:[(0,a.jsx)(r.EY,{className:"empty-icon",children:"\ud83d\udccb"}),(0,a.jsx)(r.EY,{className:"empty-text",children:d}),p&&(0,a.jsx)(r.Ss,{className:"empty-btn",onClick:g,children:(0,a.jsx)(r.EY,{children:p})})]})};t.A=c},2719:function(e,t,n){n(6540);var r=n(118),o=n(4848),a=function(e){var t=e.visible,n=e.title,a=e.content,i=e.imageUrl,c=e.onClose;return t?(0,o.jsx)(r.Ss,{className:"example-modal-mask",onClick:c,children:(0,o.jsxs)(r.Ss,{className:"example-modal",onClick:function(e){return e.stopPropagation()},children:[(0,o.jsx)(r.EY,{className:"example-modal-title",children:n}),i?(0,o.jsx)(r._V,{src:i,className:"example-img",mode:"widthFix",showMenuByLongpress:!0}):null,(0,o.jsx)(r.EY,{className:"example-modal-content",children:a}),(0,o.jsx)(r.EY,{className:"example-modal-close",onClick:c,children:"\u6211\u77e5\u9053\u4e86"})]})}):null};t.A=a},3247:function(e,t,n){n.d(t,{ih:function(){return i},uK:function(){return s},wC:function(){return a}});var r="https://zhuangxiu-images.oss-cn-hangzhou.aliyuncs.com",o=["assets/banners/banner1.png","assets/banners/banner2.png","assets/banners/banner3.png"],a=r?["".concat(r.replace(/\/$/,""),"/banners/banner1.png"),"".concat(r.replace(/\/$/,""),"/banners/banner2.png"),"".concat(r.replace(/\/$/,""),"/banners/banner3.png")]:o,i=a.some(function(e){return!!e}),c="https://zhuangxiu-images.oss-cn-hangzhou.aliyuncs.com",s={company:c?"".concat(c.replace(/\/$/,""),"/examples/company_sample.png"):"",quote:c?"".concat(c.replace(/\/$/,""),"/examples/quote_sample.png"):"",contract:c?"".concat(c.replace(/\/$/,""),"/examples/contract_sample.png"):"",acceptance:c?"".concat(c.replace(/\/$/,""),"/examples/acceptance_sample.png"):""}},3:function(e,t,n){n.r(t),n.d(t,{env:function(){return a}});var r=n(9379),o=function(){var e="http://120.26.201.61:8001/api/v1",t={apiBaseUrl:e,apiTimeout:parseInt("30000"),enableCache:!0,debugMode:!1};return(0,r.A)((0,r.A)({},t),{},{apiTimeout:parseInt("30000")})},a=o();t["default"]=a},4746:function(e,t,n){n.r(t),n.d(t,{acceptanceApi:function(){return J},clearAuthToken:function(){return S},companyApi:function(){return O},constructionApi:function(){return L},constructionPhotoApi:function(){return B},consultationApi:function(){return R},contractApi:function(){return z},deleteWithAuth:function(){return k},feedbackApi:function(){return X},getAuthHeaders:function(){return w},getWithAuth:function(){return b},materialChecksApi:function(){return q},materialLibraryApi:function(){return M},materialsApi:function(){return N},messageApi:function(){return F},paymentApi:function(){return D},postWithAuth:function(){return C},putWithAuth:function(){return x},quoteApi:function(){return U},reportApi:function(){return W},setAuthToken:function(){return y},userApi:function(){return I}});var r=n(1212),o=n(467),a=n(2284),i=n(5544),c=n(758),s=n.n(c),u=n(1083),l=n(7273),d=n(7022),p=n(6327),f=n(4532),g=n(3),h=n(7842)["URLSearchParams"],m=g.env.apiBaseUrl,v=function(){return s().getStorageSync("token")||s().getStorageSync("access_token")||""};function y(e,t){s().setStorageSync("token",e),s().setStorageSync("access_token",e),s().setStorageSync("user_id",t),s().setStorageSync("login_fresh_at",Date.now()),A(e,t)}function S(){s().removeStorageSync("token"),s().removeStorageSync("access_token"),s().removeStorageSync("user_id"),A(null,null)}function A(e,t){var n;if("undefined"!==typeof H){var r=null===(n=H.defaults)||void 0===n?void 0:n.headers;r&&(r.common=r.common||{},e?(r.common["Authorization"]="Bearer ".concat(e),r.common["X-User-Id"]=null!=t?String(t):""):(delete r.common["Authorization"],delete r.common["X-User-Id"]))}}var w=function(){var e={"Content-Type":"application/json"},t=v(),n=s().getStorageSync("user_id");return t&&(e["Authorization"]="Bearer ".concat(t)),null!=n&&""!==n&&""!==String(n).trim()&&(e["X-User-Id"]=String(n).trim()),e};function _(){S();try{d.A.dispatch((0,f.ri)())}catch(e){}var e=s().getStorageSync("onboarding_completed")||s().getStorageSync("has_onboarded");e?(s().reLaunch({url:"/pages/index/index"}),setTimeout(function(){s().showModal({title:"\u767b\u5f55\u5df2\u8fc7\u671f",content:"\u60a8\u7684\u767b\u5f55\u5df2\u8fc7\u671f\u6216\u9700\u8981\u91cd\u65b0\u9a8c\u8bc1\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u540e\u7ee7\u7eed\u4f7f\u7528",showCancel:!0,cancelText:"\u77e5\u9053\u4e86",confirmText:"\u53bb\u767b\u5f55",success:function(e){e.confirm&&s().switchTab({url:"/pages/profile/index"})}})},500)):s().reLaunch({url:"/pages/onboarding/index"})}function b(e,t){var n=e.startsWith("http")?e:"".concat(m).concat(e);if(t&&Object.keys(t).length>0){var r=new h;Object.entries(t).forEach(function(e){var t=(0,i.A)(e,2),n=t[0],o=t[1];void 0!==o&&""!==o&&r.set(n,String(o))});var o=r.toString();o&&(n+=(n.includes("?")?"&":"?")+o)}return s().request({url:n,method:"GET",header:w()}).then(function(e){var t,n;if(401===e.statusCode)return _(),Promise.reject(new Error("\u672a\u6388\u6743"));if(e.statusCode>=400){var r,o,a=new Error((null===(r=e.data)||void 0===r?void 0:r.detail)||(null===(o=e.data)||void 0===o?void 0:o.msg)||"\u8bf7\u6c42\u5931\u8d25 ".concat(e.statusCode));return a.statusCode=e.statusCode,a.response={status:e.statusCode},Promise.reject(a)}return null!==(t=null===(n=e.data)||void 0===n?void 0:n.data)&&void 0!==t?t:e.data})}function C(e,t){var n=e.startsWith("http")?e:"".concat(m).concat(e);return s().request({url:n,method:"POST",header:w(),data:null!==t&&void 0!==t?t:{}}).then(function(e){var t,n;return 401===e.statusCode?(_(),Promise.reject(new Error("\u672a\u6388\u6743"))):null!==(t=null===(n=e.data)||void 0===n?void 0:n.data)&&void 0!==t?t:e.data})}function x(e,t){var n=e.startsWith("http")?e:"".concat(m).concat(e);return s().request({url:n,method:"PUT",header:w(),data:null!==t&&void 0!==t?t:{}}).then(function(e){var t,n;return 401===e.statusCode?(_(),Promise.reject(new Error("\u672a\u6388\u6743"))):null!==(t=null===(n=e.data)||void 0===n?void 0:n.data)&&void 0!==t?t:e.data})}function k(e){var t=e.startsWith("http")?e:"".concat(m).concat(e);return s().request({url:t,method:"DELETE",header:w()}).then(function(e){var t,n;return 401===e.statusCode?(_(),Promise.reject(new Error("\u672a\u6388\u6743"))):null!==(t=null===(n=e.data)||void 0===n?void 0:n.data)&&void 0!==t?t:e.data})}var j=function(e){var t=s().getStorageSync("access_token"),n=s().getStorageSync("user_id");return E(e,t,n)},E=function(e,t,n){var r=new h;t&&r.set("access_token",t),null!=n&&""!==n&&""!==String(n).trim()&&r.set("user_id",String(n).trim());var o=r.toString();return o?"".concat(e).concat(e.includes("?")?"&":"?").concat(o):e},T=function(e,t){var n={};return e&&(n["Authorization"]="Bearer ".concat(e)),null!=t&&""!==t&&""!==String(t).trim()&&(n["X-User-Id"]=String(t).trim()),n},P={baseURL:m,timeout:3e4,headers:{"Content-Type":"application/json"}};P.adapter=l.A,P.headers&&"object"===(0,a.A)(P.headers)||(P.headers={"Content-Type":"application/json"});var H=u.A.create(P);console.log("[API\u521d\u59cb\u5316] \u5f00\u59cb\u6ce8\u518c\u8bf7\u6c42\u62e6\u622a\u5668"),H.interceptors.request.use(function(e){if(console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] \u88ab\u8c03\u7528",e.url,"method:",e.method),e.headers&&"object"===(0,a.A)(e.headers)&&!Array.isArray(e.headers)||(console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] headers\u4e0d\u662f\u5bf9\u8c61\uff0c\u91cd\u65b0\u521b\u5efa",(0,a.A)(e.headers)),e.headers={}),e.headers&&(e.headers.constructor!==Object||"AxiosHeaders"===e.headers.constructor.name)){var t;console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] headers\u4e0d\u662f\u666e\u901a\u5bf9\u8c61\uff0c\u8f6c\u6362",(null===(t=e.headers.constructor)||void 0===t?void 0:t.name)||"unknown");for(var n={},r=Object.keys(e.headers),o=0,i=r;o<i.length;o++){var c=i[o],u=e.headers[c];null!=u&&(n[c]=String(u))}e.headers=n}e.headers["Content-Type"]||e.headers["content-type"]||(e.headers["Content-Type"]="application/json");var l=v(),d=s().getStorageSync("user_id");if(console.log("[\u8bf7\u6c42\u62e6\u622a\u5668]",e.url,"token:",l?"\u5b58\u5728(".concat(l.substring(0,20),"...)"):"\u4e0d\u5b58\u5728","userId:",d||"\u65e0"),l?(e.headers.Authorization="Bearer ".concat(l),console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] \u5df2\u6dfb\u52a0Authorization header")):(delete e.headers.Authorization,console.warn("[\u8bf7\u6c42\u62e6\u622a\u5668] \u26a0\ufe0f token\u4e0d\u5b58\u5728\uff0c\u65e0\u6cd5\u6dfb\u52a0Authorization header")),null!=d&&""!==d&&""!==String(d).trim()?(e.headers["X-User-Id"]=String(d).trim(),console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] \u5df2\u6dfb\u52a0X-User-Id header:",d)):delete e.headers["X-User-Id"],!e.headers||"object"!==(0,a.A)(e.headers)||Array.isArray(e.headers)||e.headers.constructor!==Object){var p,f;console.error("[\u8bf7\u6c42\u62e6\u622a\u5668] \u26a0\ufe0f headers\u4ecd\u7136\u4e0d\u662f\u666e\u901a\u5bf9\u8c61\uff0c\u5f3a\u5236\u91cd\u5efa");var g={"Content-Type":(null===(p=e.headers)||void 0===p?void 0:p["Content-Type"])||(null===(f=e.headers)||void 0===f?void 0:f["content-type"])||"application/json"};l&&(g.Authorization="Bearer ".concat(l)),null!=d&&""!==d&&""!==String(d).trim()&&(g["X-User-Id"]=String(d).trim()),e.headers=g}else l&&!e.headers.Authorization&&(e.headers.Authorization="Bearer ".concat(l),console.log("[\u8bf7\u6c42\u62e6\u622a\u5668] \u8865\u5145\u6dfb\u52a0Authorization header")),null==d||""===d||""===String(d).trim()||e.headers["X-User-Id"]||(e.headers["X-User-Id"]=String(d).trim());if(e.headers&&"object"===(0,a.A)(e.headers)&&!Array.isArray(e.headers)||(e.headers={}),e.headers.constructor!==Object){var h={};for(var m in e.headers)e.headers.hasOwnProperty(m)&&(h[m]=String(e.headers[m]));e.headers=h}return e},function(e){return console.error("[\u8bf7\u6c42\u62e6\u622a\u5668\u9519\u8bef]",e),Promise.reject(e)}),H.interceptors.response.use(function(e){var t=e.data,n=null===t||void 0===t?void 0:t.code,r=null===t||void 0===t?void 0:t.msg,o=null===t||void 0===t?void 0:t.data;return 0===n?o:void 0===n&&t&&"object"===(0,a.A)(t)&&!t.error_id?t:(s().showToast({title:r||(null===t||void 0===t?void 0:t.detail)||"\u8bf7\u6c42\u5931\u8d25",icon:"none",duration:2e3}),Promise.reject(new Error(r||"\u8bf7\u6c42\u5931\u8d25")))},function(e){var t,n,r,o,a=null!==(t=null===(n=e.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail)&&void 0!==t?t:null===(r=e.response)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.msg,c="string"===typeof a?a:Array.isArray(a)&&null!==(o=a[0])&&void 0!==o&&o.msg?a[0].msg:null,u=c||"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25";if(e.response){var l=e.response.status;switch(l){case 401:u="\u767b\u5f55\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55";var g=e.config,h=!0===(null===g||void 0===g?void 0:g.skip401Handler),m=s().getStorageSync("login_fresh_at"),v=Date.now(),y=m&&v-Number(m)<3e4;if(h||y){y&&s().removeStorageSync("login_fresh_at");var A=new Error("\u8bf7\u7a0d\u540e\u91cd\u8bd5");return A.isSilent=!0,Promise.reject(A)}S();try{d.A.dispatch((0,f.ri)())}catch(e){}var w=s().getStorageSync("onboarding_completed")||s().getStorageSync("has_onboarded");w?(s().reLaunch({url:"/pages/index/index"}),setTimeout(function(){s().showModal({title:"\u767b\u5f55\u5df2\u8fc7\u671f",content:"\u60a8\u7684\u767b\u5f55\u5df2\u8fc7\u671f\u6216\u9700\u8981\u91cd\u65b0\u9a8c\u8bc1\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u540e\u7ee7\u7eed\u4f7f\u7528",showCancel:!0,cancelText:"\u77e5\u9053\u4e86",confirmText:"\u53bb\u767b\u5f55",success:function(e){e.confirm&&s().switchTab({url:"/pages/profile/index"})}})},500)):s().reLaunch({url:"/pages/onboarding/index"});break;case 403:u=c||"\u65e0\u6743\u9650\u8bbf\u95ee";break;case 404:u=c||"\u8bf7\u6c42\u7684\u8d44\u6e90\u4e0d\u5b58\u5728";break;case 500:u=c||"\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef";break;default:u=c||"\u8bf7\u6c42\u9519\u8bef: ".concat(l)}}else if(e.request){u="\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc",d.A.dispatch((0,p.t)(!0));try{var _,b=s().getCurrentInstance(),C=null!==(_=b.router)&&void 0!==_&&_.path?"".concat(b.router.path).concat(b.router.params&&Object.keys(b.router.params).length?"?"+Object.entries(b.router.params).map(function(e){var t=(0,i.A)(e,2),n=t[0],r=t[1];return"".concat(n,"=").concat(r)}).join("&"):""):"";s().redirectTo({url:"/pages/network-error/index"+(C?"?from="+encodeURIComponent(C):"")})}catch(e){s().showToast({title:u,icon:"none",duration:2e3})}return Promise.reject(e)}return s().showToast({title:u,icon:"none",duration:2e3}),Promise.reject(e)});var I={login:function(e){return H.post("/users/login",{code:e})},getProfile:function(){return H.get("/users/profile")},updateProfile:function(e){return H.put("/users/profile",e)}},O={scan:function(e){return H.post("/companies/scan",{company_name:e})},getResult:function(e){return H.get("/companies/scan/".concat(e))},getList:function(e){return H.get("/companies/scans",{params:e})},search:function(e,t){return H.get("/companies/search",{params:{q:e,limit:t||5}})}},U={upload:function(e,t){return new Promise(function(t,n){s().uploadFile({url:j("".concat(m,"/quotes/upload")),filePath:e,name:"file",header:w(),success:function(e){try{var r=JSON.parse(e.data);t(r)}catch(e){n(e)}},fail:n})})},getAnalysis:function(e){return H.get("/quotes/quote/".concat(e))},getList:function(e){return H.get("/quotes/list",{params:e})}},z={upload:function(e,t){return new Promise(function(t,n){s().uploadFile({url:j("".concat(m,"/contracts/upload")),filePath:e,name:"file",header:w(),success:function(e){try{var r=JSON.parse(e.data);t(r)}catch(e){n(e)}},fail:n})})},getAnalysis:function(e){return H.get("/contracts/contract/".concat(e))},getList:function(e){return H.get("/contracts/list",{params:e})}},L={getSchedule:function(){return H.get("/constructions/schedule",{skip401Handler:!0})},setStartDate:function(e){return H.post("/constructions/start-date",{start_date:e})},updateStageStatus:function(e,t){return H.put("/constructions/stage-status",{stage:e,status:t})},calibrateStageEnd:function(e,t){return H.post("/constructions/calibrate",{stage:e,end_date:t})},resetSchedule:function(){return H.delete("/constructions/schedule")}},N={verify:function(){return console.warn("materialsApi.verify \u5df2\u5e9f\u5f03\uff0c\u8bf7\u4f7f\u7528 constructionApi.updateStageStatus"),H.put("/constructions/stage-status",{stage:"S00",status:"checked"})}},q={getMaterialList:function(){return b("/material-checks/material-list")},submit:function(e){var t=v();return t?C("/material-checks/submit",e):Promise.reject(new Error("\u767b\u5f55\u5df2\u5931\u6548\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55"))}},M={search:function(e,t,n){return H.get("/material-library/search",{params:{keyword:e,category:t,city_code:n}})},getCommon:function(e){return H.get("/material-library/common",{params:{category:e}})},match:function(e,t){return H.post("/material-library/match",{material_names:e,city_code:t})}},D={createOrder:function(e){var t=v();return t?C("/payments/create",e):Promise.reject(new Error("\u8bf7\u5148\u767b\u5f55"))},pay:function(e){var t=v();return t?C("/payments/pay",{order_id:e}):Promise.reject(new Error("\u8bf7\u5148\u767b\u5f55"))},confirmPaid:function(e){var t=v();return t?C("/payments/confirm-paid",{order_id:e}):Promise.reject(new Error("\u8bf7\u5148\u767b\u5f55"))},getOrders:function(e){var t=v();return t?b("/payments/orders",e):Promise.reject(new Error("\u8bf7\u5148\u767b\u5f55"))},getOrder:function(e){var t=v();return t?b("/payments/order/".concat(e)):Promise.reject(new Error("\u8bf7\u5148\u767b\u5f55"))}},F={getList:function(e){return b("/messages",e)},getUnreadCount:function(){return b("/messages/unread-count")},markRead:function(e){return x("/messages/".concat(e,"/read"),{})},markAllRead:function(){return x("/messages/read-all",{})}},X={submit:function(e,t){return H.post("/feedback",{content:e,images:t})}},B={getUploadPolicy:function(e){return H.get("/oss/upload-policy",{params:{stage:e}})},register:function(e,t){return H.post("/construction-photos/register",{stage:e,key:t})},uploadDirect:function(){var e=(0,o.A)((0,r.A)().m(function e(t,n){var a,i,c,u,l,d,p,f;return(0,r.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,H.get("/oss/upload-policy",{params:{stage:n}});case 1:return a=e.v,i=a.host,c=a.policy,u=a.OSSAccessKeyId,l=a.signature,d=a.dir,p=(t.split(".").pop()||"jpg").toLowerCase().replace("jpeg","jpg")||"jpg",f="".concat(d).concat(Date.now(),"_").concat(Math.floor(1e4*Math.random()),".").concat(p),e.a(2,new Promise(function(e,a){s().uploadFile({url:i,filePath:t,name:"file",formData:{key:f,policy:c,OSSAccessKeyId:u,Signature:l,success_action_status:"200"},success:function(){var t=(0,o.A)((0,r.A)().m(function t(o){var c,s;return(0,r.A)().w(function(t){while(1)switch(t.p=t.n){case 0:if(!(o.statusCode>=200&&o.statusCode<300)){t.n=5;break}return t.p=1,t.n=2,H.post("/construction-photos/register",{stage:n,key:f});case 2:c=t.v,e(null!==c&&void 0!==c&&c.file_url?c:{file_url:"".concat(i,"/").concat(f)}),t.n=4;break;case 3:t.p=3,s=t.v,a(s);case 4:t.n=6;break;case 5:a(new Error("string"===typeof o.data?o.data:"\u4e0a\u4f20\u5931\u8d25 ".concat(o.statusCode)));case 6:return t.a(2)}},t,null,[[1,3]])}));function c(e){return t.apply(this,arguments)}return c}(),fail:a})}));case 2:return e.p=2,e.v,e.a(2,B.upload(t,n))}},e,null,[[0,2]])}));function t(t,n){return e.apply(this,arguments)}return t}(),upload:function(e,t){return new Promise(function(n,r){var o=(m||"").replace(/\/$/,""),a=j("".concat(o,"/construction-photos/upload?stage=").concat(encodeURIComponent(t))),i=s().getStorageSync("access_token"),c=s().getStorageSync("user_id"),u={};i&&(u["access_token"]=i),null!=c&&""!==String(c).trim()&&(u["user_id"]=String(c).trim()),s().uploadFile({url:a,filePath:e,name:"file",formData:u,header:w(),success:function(e){if(e.statusCode<200||e.statusCode>=300){var t="\u4e0a\u4f20\u5931\u8d25 ".concat(e.statusCode);try{var o,a,i="string"===typeof e.data?JSON.parse(e.data):e.data,c=null!==(o=null===i||void 0===i?void 0:i.detail)&&void 0!==o?o:null===i||void 0===i?void 0:i.msg;"string"===typeof c&&c?t=c:Array.isArray(c)&&null!==(a=c[0])&&void 0!==a&&a.msg&&(t=c[0].msg),401===e.statusCode&&(t="\u8bf7\u5148\u767b\u5f55")}catch(e){}r(new Error(t))}else try{var s,u="string"===typeof e.data?JSON.parse(e.data):e.data,l=null!==(s=null===u||void 0===u?void 0:u.data)&&void 0!==s?s:u;n(null!==l&&void 0!==l&&l.file_url?l:{file_url:l})}catch(e){r(new Error("\u89e3\u6790\u5931\u8d25"))}},fail:function(e){return r(e instanceof Error?e:new Error((null===e||void 0===e?void 0:e.errMsg)||(null===e||void 0===e?void 0:e.message)||"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25"))}})})},getList:function(e){var t=e?{stage:e}:{};return H.get("/construction-photos",{params:t})},delete:function(e){return H.delete("/construction-photos/".concat(e))},move:function(e,t){return H.put("/construction-photos/".concat(e,"/move"),{stage:t})}},J={uploadPhoto:function(e,t){var n,r,o=null!==(n=null===t||void 0===t?void 0:t.token)&&void 0!==n?n:v(),a=null!==(r=null===t||void 0===t?void 0:t.userId)&&void 0!==r?r:s().getStorageSync("user_id"),i=E("".concat(m,"/acceptance/upload-photo"),o,a),c=t?T(o,a):w(),u={};return o&&(u["access_token"]=o),null!=a&&""!==a&&""!==String(a).trim()&&(u["user_id"]=String(a).trim()),new Promise(function(t,n){s().uploadFile({url:i,filePath:e,name:"file",formData:u,header:c,success:function(e){if(e.statusCode<200||e.statusCode>=300)try{var r,o,a="string"===typeof e.data?JSON.parse(e.data):e.data,i=null!==(r=null===a||void 0===a?void 0:a.detail)&&void 0!==r?r:null===a||void 0===a?void 0:a.msg,c="string"===typeof i?i:Array.isArray(i)&&null!==(o=i[0])&&void 0!==o&&o.msg?i[0].msg:"\u4e0a\u4f20\u5931\u8d25 ".concat(e.statusCode);n(new Error(401===e.statusCode?"\u8bf7\u5148\u767b\u5f55":c))}catch(t){n(new Error("\u4e0a\u4f20\u5931\u8d25 ".concat(e.statusCode)))}else try{var s,u="string"===typeof e.data?JSON.parse(e.data):e.data,l=null!==(s=null===u||void 0===u?void 0:u.data)&&void 0!==s?s:u;t(l&&(l.file_url||l.object_key)?l:{})}catch(e){n(new Error("\u89e3\u6790\u5931\u8d25"))}},fail:function(e){return n(e instanceof Error?e:new Error((null===e||void 0===e?void 0:e.errMsg)||(null===e||void 0===e?void 0:e.message)||"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25"))}})})},analyze:function(e,t){return C("/acceptance/analyze",{stage:e,file_urls:t})},getResult:function(e){return b("/acceptance/".concat(e))},getList:function(e){var t=e||{},n={};return null!=t.stage&&(n.stage=t.stage),null!=t.page&&(n.page=t.page),null!=t.page_size&&(n.page_size=t.page_size),b("/acceptance",n)},requestRecheck:function(e,t){return C("/acceptance/".concat(e,"/request-recheck"),{rectified_photo_urls:t})}},R={createSession:function(e){return C("/consultation/session",e)},sendMessage:function(e,t,n){return C("/consultation/message",{session_id:e,content:t||void 0,images:null!==n&&void 0!==n&&n.length?n:void 0})}},W={getExportPdfUrl:function(e,t){return"".concat(m,"/reports/export-pdf?report_type=").concat(e,"&resource_id=").concat(t)},downloadPdf:function(e,t,n){return new Promise(function(n,r){var o="".concat(m,"/reports/export-pdf?report_type=").concat(e,"&resource_id=").concat(t),a=j(o);s().downloadFile({url:a,header:w(),success:function(e){if(200===e.statusCode){var t=e.tempFilePath;s().openDocument({filePath:t,fileType:"pdf"}).then(function(){return n(t)}).catch(function(e){s().saveFile({tempFilePath:t}).then(function(e){return n(e.savedFilePath)}).catch(function(){return n(t)})})}else 403===e.statusCode?r(new Error("\u8bf7\u5148\u89e3\u9501\u62a5\u544a")):401===e.statusCode?r(new Error("\u8bf7\u5148\u767b\u5f55")):404===e.statusCode?r(new Error("\u62a5\u544a\u4e0d\u5b58\u5728")):r(new Error("\u5bfc\u51fa\u5931\u8d25(".concat(e.statusCode,")")))},fail:function(e){return r(null!==e&&void 0!==e&&e.errMsg?new Error(e.errMsg):e)}})})}}},215:function(e,t,n){n.d(t,{G:function(){return a},j:function(){return o}});var r=n(1468),o=r.wA,a=r.d4},7022:function(e,t,n){n.d(t,{A:function(){return E}});var r=n(3816),o=n(4532),a={currentScan:null,scanHistory:[]},i=(0,r.Z0)({name:"company",initialState:a,reducers:{setCurrentScan:function(e,t){e.currentScan=t.payload},setScanHistory:function(e,t){e.scanHistory=t.payload},addScanToHistory:function(e,t){e.scanHistory.unshift(t.payload)}}}),c=i.actions,s=(c.setCurrentScan,c.setScanHistory,c.addScanToHistory,i.reducer),u={currentQuote:null,quoteHistory:[]},l=(0,r.Z0)({name:"quote",initialState:u,reducers:{setCurrentQuote:function(e,t){e.currentQuote=t.payload},setQuoteHistory:function(e,t){e.quoteHistory=t.payload},addQuoteToHistory:function(e,t){e.quoteHistory.unshift(t.payload)}}}),d=l.actions,p=(d.setCurrentQuote,d.setQuoteHistory,d.addQuoteToHistory,l.reducer),f={currentContract:null,contractHistory:[]},g=(0,r.Z0)({name:"contract",initialState:f,reducers:{setCurrentContract:function(e,t){e.currentContract=t.payload},setContractHistory:function(e,t){e.contractHistory=t.payload},addContractToHistory:function(e,t){e.contractHistory.unshift(t.payload)}}}),h=g.actions,m=(h.setCurrentContract,h.setContractHistory,h.addContractToHistory,g.reducer),v=n(9379),y={schedule:null},S=(0,r.Z0)({name:"construction",initialState:y,reducers:{setSchedule:function(e,t){e.schedule=t.payload},updateSchedule:function(e,t){e.schedule&&(e.schedule=(0,v.A)((0,v.A)({},e.schedule),t.payload))}}}),A=S.actions,w=(A.setSchedule,A.updateSchedule,S.reducer),_={currentOrder:null,orderHistory:[]},b=(0,r.Z0)({name:"order",initialState:_,reducers:{setCurrentOrder:function(e,t){e.currentOrder=t.payload},setOrderHistory:function(e,t){e.orderHistory=t.payload},addOrderToHistory:function(e,t){e.orderHistory.unshift(t.payload)}}}),C=b.actions,x=(C.setCurrentOrder,C.setOrderHistory,C.addOrderToHistory,b.reducer),k=n(6327),j=(0,r.U1)({reducer:{user:o.Ay,network:k.A,company:s,quote:p,contract:m,construction:w,order:x},middleware:function(e){return e({serializableCheck:!1})}}),E=j},6327:function(e,t,n){n.d(t,{t:function(){return a}});var r=n(3816),o=(0,r.Z0)({name:"network",initialState:{error:!1},reducers:{setNetworkError:function(e,t){e.error=t.payload}}}),a=o.actions.setNetworkError;t.A=o.reducer},4532:function(e,t,n){n.d(t,{iA:function(){return s},ri:function(){return u}});var r=n(9379),o=n(3816),a={userInfo:null,isLoggedIn:!1},i=(0,o.Z0)({name:"user",initialState:a,reducers:{setUserInfo:function(e,t){e.userInfo=t.payload,e.isLoggedIn=!0},logout:function(e){e.userInfo=null,e.isLoggedIn=!1},updateUserInfo:function(e,t){e.userInfo&&(e.userInfo=(0,r.A)((0,r.A)({},e.userInfo),t.payload))}}}),c=i.actions,s=c.setUserInfo,u=c.logout;c.updateUserInfo;t.Ay=i.reducer},1578:function(e,t,n){function r(e){var t,n,r,o;if(!e)return!0;var a=(null!==(t=e.summary)&&void 0!==t?t:"").toString(),i=null===(n=e.suggestions)||void 0===n?void 0:n[0];return!!(/\u6682\u4e0d\u53ef\u7528|\u8bf7\u7a0d\u540e\u91cd\u8bd5|\u5206\u6790\u670d\u52a1/.test(a)||i&&/AI\u5206\u6790\u6682\u4e0d\u53ef\u7528|\u8bf7\u7a0d\u540e\u91cd\u8bd5/.test((null!==(r=i.item)&&void 0!==r?r:"")+(null!==(o=i.action)&&void 0!==o?o:"")))}function o(e){var t,n,r,o,a,i=null!==(t=null===e||void 0===e?void 0:e.issues)&&void 0!==t?t:[],c=null!==(n=null===e||void 0===e?void 0:e.suggestions)&&void 0!==n?n:[],s=null!==(r=null===e||void 0===e?void 0:e.summary)&&void 0!==r?r:"",u=null!==(o=null===(a=c[0])||void 0===a?void 0:a.action)&&void 0!==o?o:"\u8bf7\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6574\u6539",l=i.map(function(e,t){var n,r,o,a,i,s,l,d,p=(e.severity||"low").toLowerCase(),f="high"===p?"high":"warning"===p?"mid":"low",g=null!==(n=null!==(r=null===(o=c[t])||void 0===o?void 0:o.action)&&void 0!==r?r:null===(a=c[0])||void 0===a?void 0:a.action)&&void 0!==n?n:u;return{level:f,title:null!==(i=null!==(s=e.category)&&void 0!==s?s:e.description)&&void 0!==i?i:"\u9a8c\u6536\u9879",desc:null!==(l=null!==(d=e.description)&&void 0!==d?d:e.category)&&void 0!==l?l:"",suggest:g}});return 0!==l.length||"pass"!==(null===e||void 0===e?void 0:e.severity)&&null!==e&&void 0!==e&&e.severity||l.push({level:"low",title:"\u9a8c\u6536\u901a\u8fc7",desc:s||"\u8be5\u9636\u6bb5\u9a8c\u6536\u57fa\u672c\u5408\u683c",suggest:"\u4fdd\u6301"}),{items:l}}n.d(t,{B:function(){return r},a:function(){return o}})},5649:function(e,t,n){n.d(t,{wD:function(){return i}});var r=n(758),o=n.n(r);function a(){var e=o().getStorageSync("access_token");return!!e}function i(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"profile";return!!a()||(e&&o().showModal({title:"\u9700\u8981\u767b\u5f55",content:"\u6b64\u529f\u80fd\u9700\u8981\u767b\u5f55\uff0c\u662f\u5426\u524d\u5f80\u767b\u5f55\uff1f",confirmText:"\u53bb\u767b\u5f55",cancelText:"\u53d6\u6d88",success:function(e){e.confirm&&("profile"===t?o().switchTab({url:"/pages/profile/index"}):o().switchTab({url:"/pages/index/index"}))}}),!1)}},5898:function(e,t,n){n.d(t,{$f:function(){return l},Ax:function(){return s},PR:function(){return u},Wj:function(){return i},li:function(){return d}});var r=n(5544),o=n(758),a=n.n(o),i="construction_stage_status",c={material:"S00",plumbing:"S01",carpentry:"S02",woodwork:"S03",painting:"S04",installation:"S05"},s=(Object.fromEntries(Object.entries(c).map(function(e){var t=(0,r.A)(e,2),n=t[0],o=t[1];return[o,n]})),function(e){return c[e]||e}),u=function(e){return"material"===e?"checked":"passed"},l=function(e,t){if(!e)return"material"===t?"in_progress":"pending";var n=String(null!==e&&void 0!==e?e:"").toLowerCase();return["checked","passed","completed"].includes(n)?"completed":"rectify_exhausted"===n?"rectify_done":["rectify","need_rectify","pending_recheck"].includes(n)?"rectify":["in_progress","checking"].includes(n)||"material"===t?"in_progress":"pending"},d=function(e,t){try{var n=a().getStorageSync(i),r=n?JSON.parse(n):{};r[e]=l(t,e),a().setStorageSync(i,JSON.stringify(r))}catch(e){}}},1281:function(e,t,n){n.d(t,{EH:function(){return l},EN:function(){return i},XS:function(){return f},w8:function(){return a}});var r=n(758),o=n.n(r),a="/pages/index/index",i="/pages/construction/index",c="/pages/profile/index",s=[a,i,c];function u(e){var t=(e||"").split("?")[0].trim();return s.some(function(e){return t===e||t.endsWith(e)})}function l(e){if(e)if(u(e)){var t=e.split("?")[0].trim();o().switchTab({url:t})}else o().navigateTo({url:e})}var d=120,p=300;function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.defer,r=void 0===n?d:n,a=t.retry,i=void 0===a||a,c=function(){o().switchTab({url:e,fail:function(t){var n;i&&null!==t&&void 0!==t&&null!==(n=t.errMsg)&&void 0!==n&&n.includes("timeout")&&setTimeout(function(){o().switchTab({url:e})},p)}})};r>0?setTimeout(c,r):c()}}}]);