"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[7787],{1109:function(n,e,o){var t=o(7842),i=o(5544),c=o(6540),a=o(118),r=o(758),l=o.n(r),s=o(4746),d=o(215),u=o(4532),v=o(4848),m={member_month:29.9,member_season:69.9,member_year:268},p={member_month:"\u6708\u5361",member_season:"\u5b63\u5361",member_year:"\u5e74\u5361"},h=function(){var n,e,o=(null===(n=l().getCurrentInstance().router)||void 0===n?void 0:n.params)||{},t=o.type,r=o.scanId,h=o.name,f=o.stage,_=o.pkg,g=o.order_id,x=(o.amount,!(!t||void 0===r||""===r)),y=!(!_||!String(_).startsWith("member_")),S=!!(g&&Number(g)>0),b=(0,d.j)(),T=(0,c.useState)(!1),w=(0,i.A)(T,2),j=w[0],E=w[1],A=(0,c.useState)(0),Y=(0,i.A)(A,2),N=Y[0],P=Y[1],k=(0,c.useState)(!1),I=(0,i.A)(k,2),F=I[0],C=I[1],D=9.9,O=y?String(_).toLowerCase():"",M=null!==(e=m[O])&&void 0!==e?e:0,U=x?D:y?M:N;(0,c.useEffect)(function(){S&&g?s.paymentApi.getOrder(Number(g)).then(function(n){var e,o,t=null!==(e=null===n||void 0===n?void 0:n.data)&&void 0!==e?e:n;P(Number(null!==(o=null===t||void 0===t?void 0:t.amount)&&void 0!==o?o:0)),C(!0)}).catch(function(){return C(!0)}):C(!0)},[S,g]);var J=function(n,e,o,t){o&&t?l().redirectTo({url:"/pages/acceptance/index?stage=".concat(t)}):l().redirectTo({url:"/pages/report-detail/index?type=".concat(n,"&scanId=").concat(e,"&name=").concat(encodeURIComponent(h||""))})},L=function(){var n=t||"company",e=String(r||"0"),o=Number(e);o||"company"===n?(E(!0),s.paymentApi.createOrder({order_type:"report_single",resource_type:n,resource_id:o}).then(function(o){var t,i,c,a=null!==(t=null===o||void 0===o?void 0:o.data)&&void 0!==t?t:o,r=null===a||void 0===a?void 0:a.status,d=null!==(i=null===a||void 0===a?void 0:a.order_id)&&void 0!==i?i:0;if("completed"===r&&0===d)return l().setStorageSync("report_unlocked_".concat(n,"_").concat(e),!0),"acceptance"===n&&f&&l().setStorageSync("report_unlocked_acceptance_".concat(f),!0),l().showToast({title:"\u5df2\u514d\u8d39\u89e3\u9501\uff08\u4f1a\u5458\uff09",icon:"success"}),void setTimeout(function(){return J(n,e,"acceptance"===n,f)},1200);E(!1),l().showModal({title:"\u652f\u4ed8\u786e\u8ba4",content:"\u89e3\u9501\u6743\u76ca\uff1a\u8be6\u7ec6\u98ce\u9669\u5206\u6790\u3001PDF\u5bfc\u51fa\u3001\u5f8b\u5e08\u89e3\u8bfb\u30011\u5bf91\u5ba2\u670d\u7b54\u7591\uff1b\n\u4ef7\u683c\uff1a\xa5".concat(null!==(c=null===a||void 0===a?void 0:a.amount)&&void 0!==c?c:D,"\uff1b\n\u4e00\u7ecf\u89e3\u9501\u4e0d\u652f\u6301\u9000\u6b3e\uff0cPDF\u5bfc\u51fa\u6c38\u4e45\u6709\u6548"),success:function(o){o.confirm&&d>0&&(E(!0),s.paymentApi.confirmPaid(d).then(function(){l().setStorageSync("report_unlocked_".concat(n,"_").concat(e),!0),"acceptance"===n&&f&&l().setStorageSync("report_unlocked_acceptance_".concat(f),!0),l().showToast({title:"\u89e3\u9501\u6210\u529f",icon:"success",duration:2e3}),setTimeout(function(){return J(n,e,"acceptance"===n,f)},1500)}).catch(function(n){var e;E(!1),l().showToast({title:(null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.detail)||(null===n||void 0===n?void 0:n.message)||"\u652f\u4ed8\u786e\u8ba4\u5931\u8d25",icon:"none"})}))}})}).catch(function(n){var e,o,t;E(!1);var i=null!==(e=null!==(o=null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.detail)&&void 0!==o?o:null===n||void 0===n?void 0:n.message)&&void 0!==e?e:"\u521b\u5efa\u8ba2\u5355\u5931\u8d25";l().showToast({title:String(i),icon:"none"})})):l().showToast({title:"\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u4ece\u62a5\u544a\u5217\u8868\u91cd\u65b0\u8fdb\u5165",icon:"none"})},R=function(){var n=O||"member_year";m[n]&&(E(!0),s.paymentApi.createOrder({order_type:n}).then(function(e){var o,t,i,c=null!==(o=null===e||void 0===e?void 0:e.data)&&void 0!==o?o:e,a=null===c||void 0===c?void 0:c.status,r=null!==(t=null===c||void 0===c?void 0:c.order_id)&&void 0!==t?t:0;if("completed"===a&&0===r)return l().setStorageSync("is_member",!0),l().showToast({title:"\u5df2\u662f\u4f1a\u5458",icon:"success"}),void setTimeout(function(){return l().redirectTo({url:"/pages/profile/index"})},1200);E(!1),l().showModal({title:"\u5f00\u901a\u4f1a\u5458",content:"\u786e\u8ba4\u5f00\u901a".concat(p[n]||n,"\uff1f\xa5").concat(null!==(i=null===c||void 0===c?void 0:c.amount)&&void 0!==i?i:m[n],"\u3002\u652f\u4ed8\u540e\u7acb\u5373\u751f\u6548\u3002"),success:function(n){n.confirm&&r>0&&(E(!0),s.paymentApi.confirmPaid(r).then(function(){l().setStorageSync("is_member",!0),s.userApi.getProfile().then(function(n){var e,o,t,i,c,a,r,l,s,d=null!==(e=null===n||void 0===n?void 0:n.data)&&void 0!==e?e:n;(null!==(o=null===d||void 0===d?void 0:d.user_id)&&void 0!==o?o:null===d||void 0===d?void 0:d.userId)&&b((0,u.iA)({userId:null!==(t=d.user_id)&&void 0!==t?t:d.userId,openid:null!==(i=d.openid)&&void 0!==i?i:"",nickname:null!==(c=d.nickname)&&void 0!==c?c:"\u88c5\u4fee\u7528\u6237",avatarUrl:null!==(a=null!==(r=d.avatar_url)&&void 0!==r?r:d.avatarUrl)&&void 0!==a?a:"",phone:null!==(l=d.phone)&&void 0!==l?l:"",phoneVerified:null!==(s=d.phone_verified)&&void 0!==s&&s,isMember:!0}))}),l().showToast({title:"\u5f00\u901a\u6210\u529f",icon:"success",duration:2e3}),setTimeout(function(){return l().redirectTo({url:"/pages/profile/index"})},1500)}).catch(function(n){var e;E(!1),l().showToast({title:(null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.detail)||"\u652f\u4ed8\u786e\u8ba4\u5931\u8d25",icon:"none"})}))}})}).catch(function(n){var e,o;E(!1),l().showToast({title:null!==(e=null===n||void 0===n||null===(o=n.data)||void 0===o?void 0:o.detail)&&void 0!==e?e:"\u521b\u5efa\u8ba2\u5355\u5931\u8d25",icon:"none"})}))},V=function(){var n=Number(g);n&&l().showModal({title:"\u652f\u4ed8\u786e\u8ba4",content:"\u786e\u8ba4\u652f\u4ed8 \xa5".concat(N,"\uff1f"),success:function(e){e.confirm&&(E(!0),s.paymentApi.confirmPaid(n).then(function(){l().showToast({title:"\u652f\u4ed8\u6210\u529f",icon:"success"}),setTimeout(function(){return l().redirectTo({url:"/pages/order-list/index"})},1500)}).catch(function(n){var e;E(!1),l().showToast({title:(null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.detail)||"\u652f\u4ed8\u5931\u8d25",icon:"none"})}))}})},W=function(){if(!j)return x?L():y?R():S?V():void l().showToast({title:"\u53c2\u6570\u9519\u8bef",icon:"none"})},q=(x||y&&"\u5f00\u901a".concat(p[O]||"\u4f1a\u5458"),x?"\u7acb\u5373\u89e3\u9501 \xa5".concat(U):y?"\u7acb\u5373\u5f00\u901a \xa5".concat(U):"\u7acb\u5373\u652f\u4ed8 \xa5".concat(U));return(0,v.jsxs)(a.Ss,{className:"payment-page",children:[x&&(0,v.jsxs)(a.Ss,{className:"benefits",children:[(0,v.jsx)(a.EY,{children:"\u2705 \u8be6\u7ec6\u98ce\u9669\u5206\u6790\u53ca\u6574\u6539\u5efa\u8bae"}),(0,v.jsx)(a.EY,{children:"\u2705 \u62a5\u544aPDF\u5bfc\u51fa\u6743\u9650"}),(0,v.jsx)(a.EY,{children:"\u2705 \u4e13\u4e1a\u5f8b\u5e08\u89e3\u8bfb\uff08\u6587\u5b57\u7248\uff09"}),(0,v.jsx)(a.EY,{children:"\u2705 1\u5bf91\u5ba2\u670d\u7b54\u7591\uff087\u5929\u5185\uff09"})]}),y&&(0,v.jsxs)(a.Ss,{className:"benefits",children:[(0,v.jsx)(a.EY,{children:"\u2705 \u6240\u6709\u62a5\u544a\u514d\u8d39\u89e3\u9501"}),(0,v.jsx)(a.EY,{children:"\u2705 6\u5927\u9636\u6bb5AI\u9a8c\u6536\u65e0\u9650\u6b21"}),(0,v.jsx)(a.EY,{children:"\u2705 \u4f1a\u5458\u4e13\u5c5e\u5ba2\u670d"}),(0,v.jsx)(a.EY,{children:"\u2705 \u6570\u636e\u56de\u6536\u7ad9\u3001PDF\u5bfc\u51fa\u65e0\u9650\u5236"})]}),S&&F&&(0,v.jsxs)(a.Ss,{className:"benefits",children:[(0,v.jsxs)(a.EY,{children:["\u8ba2\u5355\u53f7\uff1a",g]}),(0,v.jsxs)(a.EY,{children:["\u652f\u4ed8\u91d1\u989d\uff1a\xa5",N]})]}),F&&!(S&&N<=0)&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(a.Ss,{className:"btn primary",onClick:W,children:(0,v.jsx)(a.EY,{children:j?"\u5904\u7406\u4e2d...":q})}),(0,v.jsxs)(a.EY,{className:"tip",children:[x&&"\u57fa\u7840\u98ce\u63a7\u514d\u8d39\uff0c\u6269\u5c55\u5185\u5bb9\u4ed8\u8d39\u3002\u4e00\u7ecf\u89e3\u9501\u4e0d\u652f\u6301\u9000\u6b3e\uff0cPDF\u5bfc\u51fa\u6c38\u4e45\u6709\u6548",y&&"\u4f1a\u5458\u5f00\u901a\u540e\u7acb\u5373\u751f\u6548\uff0c\u652f\u63017\u5929\u65e0\u7406\u7531\u9000\u6b3e\uff08\u672a\u4f7f\u7528\u6743\u76ca\uff09",S&&"\u652f\u4ed8\u6210\u529f\u540e\u8ba2\u5355\u72b6\u6001\u5c06\u66f4\u65b0"]})]})]})},f=h,_={};Page((0,t.createPageConfig)(f,"pages/payment/index",{root:{cn:[]}},_||{}))}},function(n){var e=function(e){return n(n.s=e)};n.O(0,[6907,8096,2076],function(){return e(1109)});n.O()}]);