"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[2280],{51:function(n,e,a){var s=a(7842),t=a(1212),c=a(467),i=a(436),r=a(5544),o=a(6540),l=a(118),u=a(758),m=a.n(u),p=a(4746),d=a(4848),h="company_scan_history",y=10,g=function(){var n=(0,o.useState)(""),e=(0,r.A)(n,2),a=e[0],s=e[1],u=(0,o.useState)(!1),g=(0,r.A)(u,2),f=g[0],x=g[1],v=(0,o.useState)([]),N=(0,r.A)(v,2),S=N[0],j=N[1],k=(0,o.useState)(!1),A=(0,r.A)(k,2),E=A[0],w=A[1],C=(0,o.useState)([]),Y=(0,r.A)(C,2),I=Y[0],b=Y[1];(0,o.useEffect)(function(){var n=a.replace(/\s+/g,"").replace(/[^\u4e00-\u9fa5a-zA-Z]/g,"");n.length<3?j([]):p.companyApi.search(n,5).then(function(n){var e,a=null!==(e=null===n||void 0===n?void 0:n.list)&&void 0!==e?e:[];j(a.map(function(n){return n.name||n}).filter(Boolean))}).catch(function(){return j([])})},[a]),(0,o.useEffect)(function(){try{var n=m().getStorageSync(h),e=n?Array.isArray(n)?n:JSON.parse(n):[];b(e.slice(0,y))}catch(n){b([])}},[E]);var T=a.replace(/\s+/g,"").slice(0,50),_=T.length>=3,B=T.length,O=function(n){var e;return s(((null===(e=n.detail)||void 0===e?void 0:e.value)||"").replace(/\s+/g," ").trim())},J=function(){return s("")},R=function(n){s(n),x(!1)},U=function(n){try{var e=m().getStorageSync(h),a=e?Array.isArray(e)?e:JSON.parse(e):[],s=[{name:n,time:(new Date).toISOString()}].concat((0,i.A)(a.filter(function(e){return e.name!==n}))).slice(0,y);m().setStorageSync(h,JSON.stringify(s))}catch(n){}},P=function(n){var e=I.filter(function(e){return e.name!==n});m().setStorageSync(h,JSON.stringify(e)),b(e)},F=function(){var n=(0,c.A)((0,t.A)().m(function n(){var e,s,c,i,r;return(0,t.A)().w(function(n){while(1)switch(n.p=n.n){case 0:if(_){n.n=1;break}return m().showToast({title:"\u8bf7\u8f93\u5165\u6709\u6548\u516c\u53f8\u540d\u79f0",icon:"none"}),n.a(2);case 1:return e=T||a.trim(),n.p=2,n.n=3,(0,p.postWithAuth)("/companies/scan",{company_name:e});case 3:r=n.v,U(e),m().setStorageSync("has_company_scan",!0),m().navigateTo({url:"/pages/scan-progress/index?scanId=".concat(null!==(s=null!==(c=null===r||void 0===r?void 0:r.id)&&void 0!==c?c:null===r||void 0===r||null===(i=r.data)||void 0===i?void 0:i.id)&&void 0!==s?s:0,"&companyName=").concat(encodeURIComponent(e),"&type=company")}),n.n=5;break;case 4:n.p=4,n.v,m().setStorageSync("has_company_scan",!0),m().navigateTo({url:"/pages/scan-progress/index?scanId=0&companyName=".concat(encodeURIComponent(e),"&type=company")});case 5:return n.a(2)}},n,null,[[2,4]])}));return function(){return n.apply(this,arguments)}}(),D=function(){m().showModal({title:"\u786e\u8ba4\u63d0\u4ea4\uff1f",content:"\u4eba\u5de5\u68c0\u6d4b\u5c06\u57281-2\u4e2a\u5de5\u4f5c\u65e5\u5b8c\u6210\uff0c\u7ed3\u679c\u5c06\u63a8\u9001\u81f3\u6d88\u606f\u4e2d\u5fc3",success:function(n){n.confirm&&(U(T||a.trim()),m().navigateTo({url:"/pages/scan-progress/index?scanId=0&companyName=".concat(encodeURIComponent(T||a.trim()),"&type=company")}))}})},M=function(){var n=(0,c.A)((0,t.A)().m(function n(e){var a,s,c,i;return(0,t.A)().w(function(n){while(1)switch(n.p=n.n){case 0:return w(!1),n.p=1,n.n=2,(0,p.postWithAuth)("/companies/scan",{company_name:e});case 2:i=n.v,U(e),m().navigateTo({url:"/pages/scan-progress/index?scanId=".concat(null!==(a=null!==(s=null===i||void 0===i?void 0:i.id)&&void 0!==s?s:null===i||void 0===i||null===(c=i.data)||void 0===c?void 0:c.id)&&void 0!==a?a:0,"&companyName=").concat(encodeURIComponent(e),"&type=company")}),n.n=4;break;case 3:n.p=3,n.v,m().navigateTo({url:"/pages/scan-progress/index?scanId=0&companyName=".concat(encodeURIComponent(e),"&type=company")});case 4:return n.a(2)}},n,null,[[1,3]])}));return function(e){return n.apply(this,arguments)}}();return(0,d.jsxs)(l.Ss,{className:"company-scan-page",children:[(0,d.jsxs)(l.Ss,{className:"content",children:[(0,d.jsxs)(l.Ss,{className:"top-row",children:[(0,d.jsx)(l.EY,{className:"page-title",children:"\u88c5\u4fee\u516c\u53f8\u68c0\u6d4b"}),(0,d.jsx)(l.EY,{className:"history-link-top",onClick:function(){return w(!0)},children:"\u5386\u53f2\u8bb0\u5f55"})]}),(0,d.jsxs)(l.Ss,{className:"input-container",children:[(0,d.jsxs)(l.Ss,{className:"input-wrapper",children:[(0,d.jsx)(l.EY,{className:"search-icon",children:"\ud83d\udd0d"}),(0,d.jsx)(l.pd,{className:"input",placeholder:"\u8bf7\u8f93\u5165\u88c5\u4fee\u516c\u53f8\u540d\u79f0/\u62fc\u97f3\u9996\u5b57\u6bcd",placeholderClass:"placeholder",value:a,onInput:O,onFocus:function(){return x(!0)},onBlur:function(){return setTimeout(function(){return x(!1)},200)},maxlength:50}),(0,d.jsxs)(l.EY,{className:"char-count",children:["\u5df2\u8f93\u5165",B,"/50\u5b57"]}),a.length>0&&(0,d.jsx)(l.EY,{className:"clear-btn",onClick:J,children:"\xd7"})]}),S.length>0&&f&&(0,d.jsx)(l.Ss,{className:"suggestions",children:S.map(function(n){return(0,d.jsx)(l.Ss,{className:"suggestion-item",onClick:function(){return R(n)},children:(0,d.jsx)(l.EY,{className:"main-text",children:n})},n)})}),f&&0===S.length&&_&&(0,d.jsxs)(l.Ss,{className:"empty-suggest",children:[(0,d.jsx)(l.EY,{className:"empty-icon",children:"\ud83d\udced"}),(0,d.jsx)(l.EY,{className:"empty-text",children:"\u672a\u627e\u5230\u76f8\u5173\u516c\u53f8\uff0c\u8bf7\u6838\u5bf9\u540d\u79f0/\u5730\u533a"}),(0,d.jsx)(l.Ss,{className:"manual-btn",onClick:D,children:(0,d.jsx)(l.EY,{children:"\u624b\u52a8\u63d0\u4ea4\u68c0\u6d4b"})})]})]}),(0,d.jsx)(l.Ss,{className:"scan-btn ".concat(_?"active":"disabled"),onClick:_?F:function(){return m().showToast({title:"\u8bf7\u8f93\u5165\u6709\u6548\u516c\u53f8\u540d\u79f0",icon:"none"})},children:(0,d.jsx)(l.EY,{className:"btn-text",children:"\u5f00\u59cb\u68c0\u6d4b"})}),(0,d.jsx)(l.Ss,{className:"notice",children:(0,d.jsx)(l.EY,{className:"notice-text",children:"\u68c0\u6d4b\u6570\u636e\u6765\u6e90\u4e8e\u516c\u5f00\u5de5\u5546\u4fe1\u606f/\u6295\u8bc9\u5e73\u53f0\uff0c\u4ec5\u4f9b\u53c2\u8003"})})]}),E&&(0,d.jsx)(l.Ss,{className:"history-mask",onClick:function(){return w(!1)},children:(0,d.jsxs)(l.Ss,{className:"history-modal",onClick:function(n){return n.stopPropagation()},children:[(0,d.jsx)(l.EY,{className:"history-title",children:"\u5386\u53f2\u8bb0\u5f55"}),0===I.length?(0,d.jsx)(l.EY,{className:"history-empty",children:"\u6682\u65e0\u68c0\u6d4b\u8bb0\u5f55"}):(0,d.jsx)(l.BM,{scrollY:!0,className:"history-list",children:I.map(function(n){return(0,d.jsxs)(l.Ss,{className:"history-item",children:[(0,d.jsx)(l.EY,{className:"history-name",children:n.name}),(0,d.jsxs)(l.Ss,{className:"history-actions",children:[(0,d.jsx)(l.EY,{className:"history-link",onClick:function(){return M(n.name)},children:"\u91cd\u65b0\u68c0\u6d4b"}),(0,d.jsx)(l.EY,{className:"history-link danger",onClick:function(){return P(n.name)},children:"\u5220\u9664"})]})]},n.name)})}),(0,d.jsx)(l.EY,{className:"history-close",onClick:function(){return w(!1)},children:"\u5173\u95ed"})]})})]})},f=g,x={navigationBarTitleText:"\u516c\u53f8\u98ce\u9669\u68c0\u6d4b",navigationBarBackgroundColor:"#1677FF",navigationBarTextStyle:"white",enablePullDownRefresh:!0};Page((0,s.createPageConfig)(f,"pages/company-scan/index",{root:{cn:[]}},x||{}))}},function(n){var e=function(e){return n(n.s=e)};n.O(0,[6907,8096,2076],function(){return e(51)});n.O()}]);