"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[1421],{8227:function(e,n,s){var t=s(7842),a=s(9867),c=s(1212),i=s(467),r=s(9379),o=s(5544),l=s(6540),u=s(118),d=s(758),m=s.n(d),h=s(3247),f=s(3),g=s(1281),p=s(4848),x=function(e){var n=e.visible,s=e.type,t=e.onConfirm,a=e.onGoScan,c=e.onClose,i=(0,l.useState)(!1),r=(0,o.A)(i,2),d=r[0],m=r[1],h="quote"===s?"\u5efa\u8bae\u5148\u68c0\u6d4b\u88c5\u4fee\u516c\u53f8\u98ce\u9669\uff0c\u518d\u4e0a\u4f20\u62a5\u4ef7\u5355":"\u5efa\u8bae\u5148\u68c0\u6d4b\u88c5\u4fee\u516c\u53f8\u98ce\u9669\uff0c\u518d\u4e0a\u4f20\u5408\u540c";if(!n)return null;var f=function(){t(d)};return(0,p.jsx)(u.Ss,{className:"upload-confirm-mask",onClick:c,children:(0,p.jsxs)(u.Ss,{className:"upload-confirm-modal",onClick:function(e){return e.stopPropagation()},children:[(0,p.jsx)(u.EY,{className:"close-btn",onClick:c,children:"\xd7"}),(0,p.jsx)(u.EY,{className:"modal-title",children:"\u6e29\u99a8\u63d0\u793a"}),(0,p.jsx)(u.EY,{className:"modal-content",children:h}),(0,p.jsxs)(u.Ss,{className:"checkbox-row",onClick:function(){return m(!d)},children:[(0,p.jsx)(u.EY,{className:"checkbox ".concat(d?"checked":""),children:d?"\u2713":""}),(0,p.jsx)(u.EY,{className:"checkbox-label",children:"\u4e0d\u518d\u63d0\u793a"})]}),(0,p.jsxs)(u.Ss,{className:"modal-btns",children:[(0,p.jsx)(u.Ss,{className:"btn secondary",onClick:a,children:(0,p.jsx)(u.EY,{children:"\u53bb\u68c0\u6d4b"})}),(0,p.jsx)(u.Ss,{className:"btn primary",onClick:f,children:(0,p.jsx)(u.EY,{children:"\u7ee7\u7eed\u4e0a\u4f20"})})]})]})})},v=x,S=[{label:"\u5317\u4eac",value:"\u5317\u4eac\u5e02"},{label:"\u4e0a\u6d77",value:"\u4e0a\u6d77\u5e02"},{label:"\u5e7f\u5dde",value:"\u5e7f\u5dde\u5e02"},{label:"\u6df1\u5733",value:"\u6df1\u5733\u5e02"},{label:"\u676d\u5dde",value:"\u676d\u5dde\u5e02"}],j={"\u5e7f\u4e1c":["\u5e7f\u5dde\u5e02","\u6df1\u5733\u5e02","\u4e1c\u839e\u5e02","\u4f5b\u5c71\u5e02","\u73e0\u6d77\u5e02","\u60e0\u5dde\u5e02","\u4e2d\u5c71\u5e02","\u6c5f\u95e8\u5e02","\u6e5b\u6c5f\u5e02","\u8302\u540d\u5e02","\u8087\u5e86\u5e02","\u6885\u5dde\u5e02","\u6c55\u5c3e\u5e02","\u6cb3\u6e90\u5e02","\u9633\u6c5f\u5e02","\u6e05\u8fdc\u5e02","\u6f6e\u5dde\u5e02","\u63ed\u9633\u5e02","\u4e91\u6d6e\u5e02"],"\u5317\u4eac":["\u5317\u4eac\u5e02"],"\u4e0a\u6d77":["\u4e0a\u6d77\u5e02"],"\u6d59\u6c5f":["\u676d\u5dde\u5e02","\u5b81\u6ce2\u5e02","\u6e29\u5dde\u5e02","\u5609\u5174\u5e02","\u6e56\u5dde\u5e02","\u7ecd\u5174\u5e02","\u91d1\u534e\u5e02","\u8862\u5dde\u5e02","\u821f\u5c71\u5e02","\u53f0\u5dde\u5e02","\u4e3d\u6c34\u5e02"],"\u6c5f\u82cf":["\u5357\u4eac\u5e02","\u82cf\u5dde\u5e02","\u65e0\u9521\u5e02","\u5e38\u5dde\u5e02","\u5357\u901a\u5e02","\u626c\u5dde\u5e02","\u5f90\u5dde\u5e02","\u9547\u6c5f\u5e02","\u6cf0\u5dde\u5e02","\u76d0\u57ce\u5e02","\u8fde\u4e91\u6e2f\u5e02","\u6dee\u5b89\u5e02","\u5bbf\u8fc1\u5e02"],"\u56db\u5ddd":["\u6210\u90fd\u5e02","\u7ef5\u9633\u5e02","\u5fb7\u9633\u5e02","\u5357\u5145\u5e02","\u5b9c\u5bbe\u5e02","\u81ea\u8d21\u5e02","\u4e50\u5c71\u5e02","\u6cf8\u5dde\u5e02","\u8fbe\u5dde\u5e02","\u5185\u6c5f\u5e02","\u9042\u5b81\u5e02","\u6500\u679d\u82b1\u5e02","\u7709\u5c71\u5e02","\u5e7f\u5b89\u5e02","\u8d44\u9633\u5e02","\u51c9\u5c71\u5dde"],"\u6e56\u5317":["\u6b66\u6c49\u5e02","\u5b9c\u660c\u5e02","\u8944\u9633\u5e02","\u8346\u5dde\u5e02","\u5341\u5830\u5e02","\u9ec4\u77f3\u5e02","\u8346\u95e8\u5e02","\u9102\u5dde\u5e02","\u5b5d\u611f\u5e02","\u9ec4\u5188\u5e02","\u54b8\u5b81\u5e02","\u968f\u5dde\u5e02","\u6069\u65bd\u5dde"],"\u9655\u897f":["\u897f\u5b89\u5e02","\u54b8\u9633\u5e02","\u5b9d\u9e21\u5e02","\u6e2d\u5357\u5e02","\u6c49\u4e2d\u5e02","\u6986\u6797\u5e02","\u5ef6\u5b89\u5e02","\u5b89\u5eb7\u5e02","\u5546\u6d1b\u5e02","\u94dc\u5ddd\u5e02"],"\u5c71\u4e1c":["\u6d4e\u5357\u5e02","\u9752\u5c9b\u5e02","\u70df\u53f0\u5e02","\u6f4d\u574a\u5e02","\u4e34\u6c82\u5e02","\u6dc4\u535a\u5e02","\u6d4e\u5b81\u5e02","\u6cf0\u5b89\u5e02","\u5a01\u6d77\u5e02","\u5fb7\u5dde\u5e02","\u804a\u57ce\u5e02","\u6ee8\u5dde\u5e02","\u83cf\u6cfd\u5e02","\u67a3\u5e84\u5e02","\u65e5\u7167\u5e02","\u4e1c\u8425\u5e02"],"\u6cb3\u5357":["\u90d1\u5dde\u5e02","\u6d1b\u9633\u5e02","\u5357\u9633\u5e02","\u8bb8\u660c\u5e02","\u5468\u53e3\u5e02","\u5546\u4e18\u5e02","\u65b0\u4e61\u5e02","\u5b89\u9633\u5e02","\u4fe1\u9633\u5e02","\u5f00\u5c01\u5e02","\u5e73\u9876\u5c71\u5e02","\u9a7b\u9a6c\u5e97\u5e02","\u7126\u4f5c\u5e02","\u6f2f\u6cb3\u5e02","\u6fee\u9633\u5e02","\u4e09\u95e8\u5ce1\u5e02","\u9e64\u58c1\u5e02","\u8bb8\u660c\u5e02"],"\u798f\u5efa":["\u798f\u5dde\u5e02","\u53a6\u95e8\u5e02","\u6cc9\u5dde\u5e02","\u6f33\u5dde\u5e02","\u8386\u7530\u5e02","\u9f99\u5ca9\u5e02","\u4e09\u660e\u5e02","\u5357\u5e73\u5e02","\u5b81\u5fb7\u5e02"],"\u6e56\u5357":["\u957f\u6c99\u5e02","\u682a\u6d32\u5e02","\u6e58\u6f6d\u5e02","\u8861\u9633\u5e02","\u5cb3\u9633\u5e02","\u5e38\u5fb7\u5e02","\u90b5\u9633\u5e02","\u76ca\u9633\u5e02","\u5a04\u5e95\u5e02","\u90f4\u5dde\u5e02","\u6c38\u5dde\u5e02","\u6000\u5316\u5e02","\u5f20\u5bb6\u754c\u5e02","\u6e58\u897f\u5dde"]},N=Object.keys(j),w="\u5e7f\u4e1c",A=N.flatMap(function(e){return j[e]}),y=function(e){var n=e.visible,s=e.onConfirm,t=e.onClose,a=(0,l.useState)(""),c=(0,o.A)(a,2),i=c[0],r=c[1],d=(0,l.useState)(w),h=(0,o.A)(d,2),f=h[0],g=h[1],x=(0,l.useState)(""),v=(0,o.A)(x,2),y=v[0],k=v[1],b=(0,l.useState)("loading"),E=(0,o.A)(b,2),C=E[0],Y=E[1],T=(0,l.useState)(""),I=(0,o.A)(T,2),_=I[0],M=I[1],P=(0,l.useMemo)(function(){var e=i.trim().toLowerCase();return e?A.filter(function(n){return n.toLowerCase().includes(e)||n.replace(/\u5e02$/,"").toLowerCase().includes(e)}):[]},[i]),D=f&&j[f]||[];(0,l.useEffect)(function(){n&&(r(""),k(""),g(w),m().getLocation({type:"wgs84",success:function(){Y("success");var e=m().getStorageSync("selected_city");M(e||"\u5f53\u524d\u57ce\u5e02"),e&&e.trim()&&k(e.trim())},fail:function(){return Y("fail")}}))},[n]);var q=function(){console.log("[\u57ce\u5e02\u9009\u62e9] handleConfirm \u88ab\u8c03\u7528",{selectedCity:y,keyword:i,filteredCities:P});var e=y||(i.trim()&&1===P.length?P[0]:"");console.log("[\u57ce\u5e02\u9009\u62e9] \u6700\u7ec8\u9009\u62e9\u7684\u57ce\u5e02",e),e?(m().setStorageSync("selected_city",e),console.log("[\u57ce\u5e02\u9009\u62e9] \u5df2\u4fdd\u5b58\u57ce\u5e02\u5230storage",e),s&&(console.log("[\u57ce\u5e02\u9009\u62e9] \u8c03\u7528onConfirm\u56de\u8c03",e),s(e)),m().showToast({title:"\u5df2\u9009\u62e9".concat(e),icon:"success",duration:2e3})):m().showToast({title:"\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u57ce\u5e02",icon:"none",duration:2e3})},B=function(){t&&t()},$=!!y||i.trim()&&1===P.length;return(0,l.useEffect)(function(){n&&console.log("[\u57ce\u5e02\u9009\u62e9] \u72b6\u6001\u66f4\u65b0",{selectedCity:y,hasSelection:$,keyword:i,filteredCities:P.length})},[y,$,i,P.length,n]),n?(0,p.jsx)(u.Ss,{className:"city-picker-modal-mask",onClick:B,children:(0,p.jsxs)(u.Ss,{className:"city-picker-modal",onClick:function(e){return e.stopPropagation()},children:[(0,p.jsxs)(u.Ss,{className:"city-picker-header",children:[(0,p.jsx)(u.EY,{className:"city-picker-title",children:"\u9009\u62e9\u57ce\u5e02"}),(0,p.jsx)(u.Ss,{className:"city-picker-close",onClick:B,children:(0,p.jsx)(u.EY,{children:"\u2715"})})]}),(0,p.jsx)(u.BM,{scrollY:!0,className:"city-picker-content-outer",enhanced:!0,showScrollbar:!1,children:(0,p.jsxs)(u.Ss,{className:"city-picker-content",children:[(0,p.jsxs)(u.Ss,{className:"location-tip",children:["loading"===C&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(u.EY,{className:"location-icon",children:"\ud83d\udccd"}),(0,p.jsx)(u.EY,{className:"location-text loading",children:"\u5b9a\u4f4d\u4e2d..."})]}),"success"===C&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(u.EY,{className:"location-icon",children:"\ud83d\udccd"}),(0,p.jsx)(u.EY,{className:"location-text",children:"\u5f53\u524d\u5b9a\u4f4d\u57ce\u5e02\uff1a"}),(0,p.jsx)(u.EY,{className:"location-city",children:_})]}),"fail"===C&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(u.EY,{className:"location-icon",children:"\u26a0\ufe0f"}),(0,p.jsx)(u.EY,{className:"location-text fail",children:"\u5b9a\u4f4d\u5931\u8d25\uff0c\u8bf7\u624b\u52a8\u9009\u62e9\u57ce\u5e02"})]})]}),(0,p.jsxs)(u.Ss,{className:"hot-section",children:[(0,p.jsx)(u.EY,{className:"section-title",children:"\u70ed\u95e8\u57ce\u5e02"}),(0,p.jsx)(u.Ss,{className:"hot-tags",children:S.map(function(e){return(0,p.jsx)(u.Ss,{className:"hot-tag ".concat(y===e.value?"active":""),onClick:function(n){n.stopPropagation(),console.log("[\u57ce\u5e02\u9009\u62e9] \u70b9\u51fb\u70ed\u95e8\u57ce\u5e02",e.value),k(e.value)},children:(0,p.jsx)(u.EY,{children:e.label})},e.value)})})]}),(0,p.jsxs)(u.Ss,{className:"search-section",children:[(0,p.jsxs)(u.Ss,{className:"search-wrap",children:[(0,p.jsx)(u.EY,{className:"search-icon",children:"\ud83d\udd0d"}),(0,p.jsx)(u.pd,{className:"search-input",placeholder:"\u8f93\u5165\u57ce\u5e02\u540d\u6216\u62fc\u97f3\u641c\u7d22",placeholderClass:"search-placeholder",value:i,onInput:function(e){var n;return r((null===(n=e.detail)||void 0===n?void 0:n.value)||"")}})]}),i.trim()&&(0,p.jsx)(u.Ss,{className:"search-result-wrap",children:0===P.length?(0,p.jsx)(u.EY,{className:"search-no-result",children:"\u672a\u627e\u5230\u76f8\u5173\u57ce\u5e02"}):(0,p.jsx)(u.Ss,{className:"search-result-list",children:P.map(function(e){return(0,p.jsx)(u.Ss,{className:"search-result-item ".concat(y===e?"active":""),onClick:function(){return k(e)},children:(0,p.jsx)(u.EY,{children:e})},e)})})})]}),!i.trim()&&(0,p.jsx)(u.Ss,{className:"pick-section",children:(0,p.jsxs)(u.Ss,{className:"pick-row",children:[(0,p.jsx)(u.BM,{scrollY:!0,className:"province-list",enhanced:!0,showScrollbar:!1,children:N.map(function(e){return(0,p.jsx)(u.Ss,{className:"province-item ".concat(f===e?"active":""),onClick:function(){g(e),k("")},children:(0,p.jsx)(u.EY,{children:e})},e)})}),(0,p.jsx)(u.BM,{scrollY:!0,className:"city-list",enhanced:!0,showScrollbar:!1,children:D.map(function(e){return(0,p.jsx)(u.Ss,{className:"city-item ".concat(y===e?"active":""),onClick:function(){return k(e)},children:(0,p.jsx)(u.EY,{children:e})},e)})})]})})]})}),(0,p.jsx)(u.Ss,{className:"city-picker-footer",style:{position:"relative",zIndex:100},children:(0,p.jsx)(u.Ss,{className:"confirm-btn ".concat($?"active":""),onClick:function(e){e.stopPropagation(),console.log("[\u57ce\u5e02\u9009\u62e9] \u70b9\u51fb\u786e\u8ba4\u6309\u94ae",{hasSelection:$,selectedCity:y,keyword:i,filteredCities:P}),$?q():(console.log("[\u57ce\u5e02\u9009\u62e9] \u6ca1\u6709\u9009\u62e9\u57ce\u5e02\uff0c\u663e\u793a\u63d0\u793a"),m().showToast({title:"\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u57ce\u5e02",icon:"none",duration:2e3}))},children:(0,p.jsx)(u.EY,{className:"btn-text",children:"\u786e\u8ba4\u9009\u62e9"})})})]})}):null},k=y,b=s(436),E=s(4746),C=function(e){if(!e)return"";var n=e;return n=n.replace(/```[\s\S]*?```/g,function(e){var n=e.replace(/^```[a-zA-Z]*\n?/,"").replace(/\n?```$/,"");return"\u3010\u4ee3\u7801\u3011".concat(n,"\u3010/\u4ee3\u7801\u3011")}),n=n.replace(/`([^`]+)`/g,"$1"),n=n.replace(/\*\*(.+?)\*\*/g,"$1"),n=n.replace(/\*(.+?)\*/g,"$1"),n=n.replace(/^#{1,6}\s+(.+)$/gm,"$1\n"),n=n.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1"),n=n.replace(/^>\s+(.+)$/gm,"$1"),n=n.replace(/^(\s*)[-\*]\s+(.+)$/gm,function(e,n,s){return"".concat(n,"\u2022 ").concat(s)}),n=n.replace(/^(\s*)(\d+)\.\s+(.+)$/gm,function(e,n,s,t){return"".concat(n).concat(s,". ").concat(t)}),n=n.replace(/^[-*_]{3,}$/gm,"---"),n},Y=function(e){if(!e)return"";for(var n=C(e),s=n.split("\n"),t=[],a=0;a<s.length;a++){var c=s[a].trim();if(c){var i=c.startsWith("\u2022 ")||/^\d+\.\s/.test(c);i?t.push("  ".concat(c)):"---"===c?t.push("\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500"):t.push(c)}else t.push("\n\n")}var r=t.join("\n");return r=r.replace(/\n{3,}/g,"\n\n"),r.trim()},T=function(e){var n=e.showDragHint,s=void 0===n||n,t=e.initialPosition,a=void 0===t?{x:20,y:200}:t,r=e.fixedMode,d=void 0!==r&&r,h=(e.fixedContainerClassName,(0,l.useState)(a)),f=(0,o.A)(h,2),g=f[0],x=f[1],v=(0,l.useState)(!1),S=(0,o.A)(v,2),j=S[0],N=S[1],w=(0,l.useState)(!1),A=(0,o.A)(w,2),y=A[0],k=A[1],C=(0,l.useState)(""),T=(0,o.A)(C,2),I=T[0],_=T[1],M=(0,l.useState)(!1),P=(0,o.A)(M,2),D=P[0],q=P[1],B=(0,l.useState)(s),$=(0,o.A)(B,2),F=$[0],L=$[1],R=(0,l.useState)(!0),O=(0,o.A)(R,2),X=O[0],z=O[1],W=(0,l.useState)(!0),U=(0,o.A)(W,2),V=U[0],G=U[1],H=(0,l.useState)(!1),J=(0,o.A)(H,2),Z=J[0],K=J[1],Q=(0,l.useState)(""),ee=(0,o.A)(Q,2),ne=ee[0],se=ee[1],te=(0,l.useState)([]),ae=(0,o.A)(te,2),ce=ae[0],ie=ae[1],re=(0,l.useState)(!1),oe=(0,o.A)(re,2),le=oe[0],ue=oe[1],de=(0,l.useRef)({x:0,y:0}),me=(0,l.useRef)(null),he=(0,l.useRef)(null),fe=(0,l.useRef)(null);(0,l.useEffect)(function(){var e=m().getStorageSync("has_seen_designer_avatar");e?(z(!1),L(!1)):(z(!0),m().setStorageSync("has_seen_designer_avatar","1")),d&&G(!0)},[d]);var ge=function(e){if(!d){var n=e.touches[0];de.current={x:n.clientX-g.x,y:n.clientY-g.y},N(!0),L(!1),G(!1)}},pe=function(e){if(j&&!d){var n=e.touches[0],s=n.clientX-de.current.x,t=n.clientY-de.current.y,a=m().getSystemInfoSync().windowWidth,c=m().getSystemInfoSync().windowHeight,i=60,r=Math.max(0,Math.min(s,a-i)),o=Math.max(0,Math.min(t,c-i));x({x:r,y:o})}},xe=function(){N(!1),m().setStorageSync("designer_avatar_position",JSON.stringify(g))},ve=function(){var e=m().getStorageSync("token")||m().getStorageSync("access_token");return!!e},Se=function(){var e=(0,i.A)((0,c.A)().m(function e(){return(0,c.A)().w(function(e){while(1)switch(e.n){case 0:if(!j){e.n=1;break}return e.a(2);case 1:if(K(!0),G(!1),d&&!Z&&L(!0),ve()){e.n=2;break}return m().showModal({title:"\u8bf7\u5148\u767b\u5f55",content:"\u4f7f\u7528AI\u8bbe\u8ba1\u5e08\u529f\u80fd\u9700\u8981\u5148\u767b\u5f55\u8d26\u53f7",confirmText:"\u53bb\u767b\u5f55",cancelText:"\u53d6\u6d88",success:function(e){e.confirm&&m().switchTab({url:"/pages/profile/index"})}}),e.a(2);case 2:if(k(!0),L(!1),ne){e.n=3;break}return e.n=3,je();case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),je=function(){var e=(0,i.A)((0,c.A)().m(function e(){var n,s,t,a,i,r,o,l,u,d,h,f,g;return(0,c.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(ve()){e.n=1;break}return k(!1),m().showToast({title:"\u8bf7\u5148\u767b\u5f55",icon:"none"}),e.a(2);case 1:return e.p=1,ue(!0),n=new Promise(function(e,n){setTimeout(function(){return n(new Error("\u521b\u5efa\u4f1a\u8bdd\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5"))},12e4)}),s=E.designerApi.createChatSession(),e.n=2,Promise.race([s,n]);case 2:t=e.v,se(t.session_id),ie(t.messages||[]),t.messages&&0!==t.messages.length||(a={role:"assistant",content:"\u60a8\u597d\uff01\u6211\u662f\u60a8\u7684AI\u88c5\u4fee\u8bbe\u8ba1\u5e08 - \u6f2b\u6e38\u89c6\u9891\u751f\u6210\u5668\uff01\u6211\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u6237\u578b\u56fe\u751f\u6210\u88c5\u4fee\u6548\u679c\u56fe\u548c\u6f2b\u6e38\u89c6\u9891\u3002\u8bf7\u4e0a\u4f20\u60a8\u7684\u6237\u578b\u56fe\u5f00\u59cb\u4f53\u9a8c\u5427\uff01",timestamp:Date.now()/1e3},ie([a])),e.n=7;break;case 3:if(e.p=3,g=e.v,console.error("\u521b\u5efa\u804a\u5929session\u5931\u8d25:",g),!(null!==g&&void 0!==g&&null!==(i=g.message)&&void 0!==i&&i.includes("\u8d85\u65f6")||null!==g&&void 0!==g&&null!==(r=g.errMsg)&&void 0!==r&&r.includes("timeout"))){e.n=4;break}console.log("[AI\u8bbe\u8ba1\u5e08] \u521b\u5efa\u4f1a\u8bdd\u8d85\u65f6\uff0c\u53ef\u80fd\u662f\u7f51\u7edc\u95ee\u9898"),m().showToast({title:"\u7f51\u7edc\u8fde\u63a5\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u540e\u91cd\u8bd5",icon:"none",duration:3e3}),e.n=6;break;case 4:if(h=401===g.statusCode||401===g.code||g.response&&401===g.response.status||(null===(o=g.message)||void 0===o?void 0:o.includes("\u672a\u6388\u6743"))||(null===(l=g.message)||void 0===l?void 0:l.includes("Unauthorized"))||(null===(u=g.message)||void 0===u?void 0:u.includes("\u767b\u5f55"))||(null===(d=g.message)||void 0===d?void 0:d.includes("\u8ba4\u8bc1")),!h){e.n=5;break}return console.log("401\u9519\u8bef\u5df2\u7531postWithAuth\u5904\u7406\uff0c\u5173\u95ed\u5bf9\u8bdd\u6846\uff0c\u4e0d\u663e\u793a\u9519\u8bef\u63d0\u793a"),k(!1),e.a(2);case 5:m().showToast({title:g.message||"\u521b\u5efa\u5bf9\u8bdd\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",icon:"none"});case 6:f={role:"assistant",content:"\u60a8\u597d\uff01\u6211\u662f\u60a8\u7684AI\u88c5\u4fee\u8bbe\u8ba1\u5e08 - \u6f2b\u6e38\u89c6\u9891\u751f\u6210\u5668\uff01\u6211\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u6237\u578b\u56fe\u751f\u6210\u88c5\u4fee\u6548\u679c\u56fe\u548c\u6f2b\u6e38\u89c6\u9891\u3002\u8bf7\u4e0a\u4f20\u60a8\u7684\u6237\u578b\u56fe\u5f00\u59cb\u4f53\u9a8c\u5427\uff01",timestamp:Date.now()/1e3},ie([f]);case 7:return e.p=7,ue(!1),e.f(7);case 8:return e.a(2)}},e,null,[[1,3,7,8]])}));return function(){return e.apply(this,arguments)}}(),Ne=function(){k(!1),_("")},we=function(){var e=(0,i.A)((0,c.A)().m(function e(){var n,s,t,a,i,r,o,l,u,d,h,f,g,p;return(0,c.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(I.trim()&&ne){e.n=1;break}return m().showToast({title:"\u8bf7\u8f93\u5165\u6d88\u606f",icon:"none"}),e.a(2);case 1:if(ve()){e.n=2;break}return m().showModal({title:"\u8bf7\u5148\u767b\u5f55",content:"\u53d1\u9001\u6d88\u606f\u9700\u8981\u5148\u767b\u5f55\u8d26\u53f7",confirmText:"\u53bb\u767b\u5f55",cancelText:"\u53d6\u6d88",success:function(e){e.confirm&&m().switchTab({url:"/pages/profile/index"})}}),e.a(2);case 2:return n=I.trim(),_(""),s={role:"user",content:n,timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[s])}),q(!0),e.p=3,t=new Promise(function(e,n){setTimeout(function(){return n(new Error("\u8bf7\u6c42\u8d85\u65f6\uff0cAI\u54cd\u5e94\u65f6\u95f4\u8f83\u957f\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"))},6e5)}),a=E.designerApi.sendChatMessage(ne,n),e.n=4,Promise.race([a,t]);case 4:i=e.v,r={role:"assistant",content:i.answer,timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[r])}),setTimeout(function(){if(fe.current)try{var e,n;null===(e=(n=fe.current).scrollToBottom)||void 0===e||e.call(n)}catch(e){if(console.log("\u6eda\u52a8\u5230\u5e95\u90e8\u5931\u8d25:",e),he.current){var s=he.current;s&&1===s.nodeType&&s.scrollIntoView&&s.scrollIntoView({behavior:"smooth",block:"end"})}}},100),e.n=6;break;case 5:e.p=5,p=e.v,console.error("\u53d1\u9001\u6d88\u606f\u5931\u8d25:",p),null!==p&&void 0!==p&&null!==(o=p.message)&&void 0!==o&&o.includes("\u8d85\u65f6")||null!==p&&void 0!==p&&null!==(l=p.errMsg)&&void 0!==l&&l.includes("timeout")?(console.log("[AI\u8bbe\u8ba1\u5e08] \u8bf7\u6c42\u8d85\u65f6\uff0c\u53ef\u80fd\u662fAI\u751f\u6210\u65f6\u95f4\u8f83\u957f\u6216\u7f51\u7edc\u95ee\u9898"),m().showToast({title:"AI\u54cd\u5e94\u65f6\u95f4\u8f83\u957f\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",icon:"none",duration:3e3}),h={role:"assistant",content:"\u62b1\u6b49\uff0cAI\u54cd\u5e94\u65f6\u95f4\u8f83\u957f\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u6216\u7b80\u5316\u60a8\u7684\u95ee\u9898\u3002",timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[h])})):401===p.statusCode||null!==(u=p.message)&&void 0!==u&&u.includes("\u672a\u6388\u6743")||null!==(d=p.message)&&void 0!==d&&d.includes("\u767b\u5f55")?console.log("\u53d1\u9001\u6d88\u606f\u65f6401\u9519\u8bef\u5df2\u7531postWithAuth\u5904\u7406"):(console.log("[AI\u8bbe\u8ba1\u5e08] \u9519\u8bef\u8be6\u60c5:",{message:p.message,statusCode:p.statusCode,response:p.response,data:null===(f=p.response)||void 0===f?void 0:f.data}),m().showToast({title:p.message||"\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",icon:"none"}),g={role:"assistant",content:"\u62b1\u6b49\uff0c\u6211\u6682\u65f6\u65e0\u6cd5\u56de\u7b54\u60a8\u7684\u95ee\u9898\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002",timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[g])}));case 6:return e.p=6,q(!1),e.f(6);case 7:return e.a(2)}},e,null,[[3,5,6,7]])}));return function(){return e.apply(this,arguments)}}(),Ae=["\u73b0\u4ee3\u7b80\u7ea6\u98ce\u683c\u7684\u7279\u70b9\u662f\u4ec0\u4e48\uff1f","\u5c0f\u6237\u578b\u5982\u4f55\u8bbe\u8ba1\u663e\u5f97\u7a7a\u95f4\u66f4\u5927\uff1f","\u88c5\u4fee\u9884\u7b97\u600e\u4e48\u5206\u914d\u6bd4\u8f83\u5408\u7406\uff1f","\u9009\u62e9\u5730\u677f\u8fd8\u662f\u74f7\u7816\u6bd4\u8f83\u597d\uff1f","\u53a8\u623f\u88c5\u4fee\u8981\u6ce8\u610f\u54ea\u4e9b\u7ec6\u8282\uff1f"],ye=function(){var e=(0,i.A)((0,c.A)().m(function e(){var n,s,t,a,i,r,o,l,u,d,h,f,g,p,x,v,S,j,N,w,A,y,k,C,Y,T,I;return(0,c.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(ve()){e.n=1;break}return m().showModal({title:"\u8bf7\u5148\u767b\u5f55",content:"\u4e0a\u4f20\u56fe\u7247\u9700\u8981\u5148\u767b\u5f55\u8d26\u53f7",confirmText:"\u53bb\u767b\u5f55",cancelText:"\u53d6\u6d88",success:function(e){e.confirm&&m().switchTab({url:"/pages/profile/index"})}}),e.a(2);case 1:return e.p=1,e.n=2,m().chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"]});case 2:if(n=e.v,!(n.tempFilePaths.length>0)){e.n=16;break}return s=n.tempFilePaths[0],t="designer_".concat(Date.now(),".jpg"),m().showLoading({title:"\u4e0a\u4f20\u6237\u578b\u56fe\u4e2d..."}),e.p=3,a=new Promise(function(e,n){setTimeout(function(){return n(new Error("\u56fe\u7247\u4e0a\u4f20\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5"))},12e4)}),i=E.designerApi.uploadImage(s,t),e.n=4,Promise.race([i,a]);case 4:if(r=e.v,!r.success||!r.image_url){e.n=13;break}if(m().hideLoading(),m().showToast({title:"\u6237\u578b\u56fe\u4e0a\u4f20\u6210\u529f\uff01",icon:"success",duration:2e3}),o={role:"user",content:"\ud83d\udcf8 \u5df2\u4e0a\u4f20\u6237\u578b\u56fe\uff0c\u8bf7\u5e2e\u6211\u5206\u6790\u4e00\u4e0b",timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[o])}),!ne){e.n=10;break}return q(!0),e.p=5,l=new Promise(function(e,n){setTimeout(function(){return n(new Error("AI\u5206\u6790\u8d85\u65f6\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"))},6e5)}),u=E.designerApi.sendChatMessage(ne,"\u8bf7\u5e2e\u6211\u5206\u6790\u4e00\u4e0b\u8fd9\u4e2a\u6237\u578b\u56fe\uff0c\u7ed9\u51fa\u88c5\u4fee\u5efa\u8bae\u548c\u6548\u679c\u56fe\u751f\u6210\u601d\u8def\u3002",[r.image_url]),e.n=6,Promise.race([u,l]);case 6:d=e.v,h={role:"assistant",content:d.answer,timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[h])}),e.n=8;break;case 7:e.p=7,Y=e.v,console.error("\u53d1\u9001\u56fe\u7247\u6d88\u606f\u5931\u8d25:",Y),null!==Y&&void 0!==Y&&null!==(f=Y.message)&&void 0!==f&&f.includes("\u8d85\u65f6")||null!==Y&&void 0!==Y&&null!==(g=Y.errMsg)&&void 0!==g&&g.includes("timeout")?(console.log("[AI\u8bbe\u8ba1\u5e08] \u56fe\u7247\u5206\u6790\u8d85\u65f6\uff0c\u53ef\u80fd\u662fAI\u5904\u7406\u65f6\u95f4\u8f83\u957f"),p={role:"assistant",content:"\u611f\u8c22\u4e0a\u4f20\u6237\u578b\u56fe\uff01AI\u5206\u6790\u65f6\u95f4\u8f83\u957f\uff0c\u53ef\u80fd\u9700\u8981\u66f4\u591a\u65f6\u95f4\u5904\u7406\u3002\n\n\u60a8\u53ef\u4ee5\u9009\u62e9\uff1a\n1. \u7a0d\u540e\u91cd\u8bd5\u67e5\u770b\u5206\u6790\u7ed3\u679c\n2. \u6216\u8005\u5148\u95ee\u5176\u4ed6\u88c5\u4fee\u95ee\u9898\n\n\u6237\u578b\u56fe\u5206\u6790\u3001\u6548\u679c\u56fe\u751f\u6210\u548c\u6f2b\u6e38\u89c6\u9891\u529f\u80fd\u5df2\u4e0a\u7ebf\uff0c\u6211\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u4e13\u4e1a\u7684\u88c5\u4fee\u5efa\u8bae\uff01",timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[p])}),x={role:"assistant",content:"RETRY_ANALYSIS_BUTTON",timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[x])})):(v={role:"assistant",content:"\u611f\u8c22\u4e0a\u4f20\u6237\u578b\u56fe\uff01\u6211\u6b63\u5728\u5206\u6790\u60a8\u7684\u6237\u578b...\n\n\u6237\u578b\u56fe\u5206\u6790\u3001\u6548\u679c\u56fe\u751f\u6210\u548c\u6f2b\u6e38\u89c6\u9891\u529f\u80fd\u5df2\u4e0a\u7ebf\uff0c\u6211\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u4e13\u4e1a\u7684\u88c5\u4fee\u5efa\u8bae\uff01",timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[v])}));case 8:return e.p=8,q(!1),e.f(8);case 9:e.n=12;break;case 10:return e.n=11,je();case 11:S={role:"assistant",content:"\u611f\u8c22\u4e0a\u4f20\u6237\u578b\u56fe\uff01\u6211\u6b63\u5728\u5206\u6790\u60a8\u7684\u6237\u578b...\n\n\u6237\u578b\u56fe\u5206\u6790\u3001\u6548\u679c\u56fe\u751f\u6210\u548c\u6f2b\u6e38\u89c6\u9891\u529f\u80fd\u5df2\u4e0a\u7ebf\uff0c\u6211\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u4e13\u4e1a\u7684\u88c5\u4fee\u5efa\u8bae\uff01",timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[S])});case 12:e.n=14;break;case 13:m().hideLoading(),m().showToast({title:r.error_message||"\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",icon:"none",duration:3e3});case 14:e.n=16;break;case 15:e.p=15,T=e.v,m().hideLoading(),console.error("\u4e0a\u4f20\u56fe\u7247\u5931\u8d25:",T),null!==T&&void 0!==T&&null!==(j=T.message)&&void 0!==j&&j.includes("\u8d85\u65f6")||null!==T&&void 0!==T&&null!==(N=T.errMsg)&&void 0!==N&&N.includes("timeout")?(console.log("[AI\u8bbe\u8ba1\u5e08] \u56fe\u7247\u4e0a\u4f20\u8d85\u65f6\uff0c\u53ef\u80fd\u662f\u7f51\u7edc\u95ee\u9898"),m().showToast({title:"\u56fe\u7247\u4e0a\u4f20\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5",icon:"none",duration:3e3})):401===T.statusCode||null!==(w=T.message)&&void 0!==w&&w.includes("\u672a\u6388\u6743")||null!==(A=T.message)&&void 0!==A&&A.includes("\u767b\u5f55")?console.log("\u4e0a\u4f20\u56fe\u7247\u65f6401\u9519\u8bef\u5df2\u5904\u7406"):m().showToast({title:T.message||"\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc",icon:"none",duration:3e3}),y={role:"user",content:"\ud83d\udcf8 \u5c1d\u8bd5\u4e0a\u4f20\u6237\u578b\u56fe\uff08\u4e0a\u4f20\u5931\u8d25\uff09",timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[y])}),k={role:"assistant",content:"\u6237\u578b\u56fe\u4e0a\u4f20\u529f\u80fd\u5df2\u4e0a\u7ebf\uff01\u4e0b\u6b21\u8bf7\u518d\u8bd5\u4e00\u4e0b\u4e0a\u4f20\u60a8\u7684\u6237\u578b\u56fe\uff0c\u6211\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u4e13\u4e1a\u7684\u88c5\u4fee\u5206\u6790\u548c\u6548\u679c\u56fe\u751f\u6210\u5efa\u8bae\u3002",timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[k])});case 16:e.n=18;break;case 17:e.p=17,I=e.v,m().hideLoading(),C=I.errMsg&&(I.errMsg.includes("cancel")||I.errMsg.includes("\u53d6\u6d88")||"chooseImage:fail cancel"===I.errMsg),C?console.log("\u7528\u6237\u53d6\u6d88\u4e86\u56fe\u7247\u9009\u62e9"):(console.error("\u9009\u62e9\u56fe\u7247\u5931\u8d25:",I),m().showToast({title:I.errMsg||"\u9009\u62e9\u56fe\u7247\u5931\u8d25",icon:"none",duration:2e3}));case 18:return e.a(2)}},e,null,[[5,7,8,9],[3,15],[1,17]])}));return function(){return e.apply(this,arguments)}}(),ke=function(e){_(e)},be=function(){var e=(0,i.A)((0,c.A)().m(function e(){var n,s,t,a,i,r,o,l;return(0,c.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(ne){e.n=1;break}return e.a(2);case 1:if(ve()){e.n=2;break}return m().showModal({title:"\u8bf7\u5148\u767b\u5f55",content:"\u6e05\u7a7a\u5bf9\u8bdd\u9700\u8981\u5148\u767b\u5f55\u8d26\u53f7",confirmText:"\u53bb\u767b\u5f55",cancelText:"\u53d6\u6d88",success:function(e){e.confirm&&m().switchTab({url:"/pages/profile/index"})}}),e.a(2);case 2:return e.p=2,n=new Promise(function(e,n){setTimeout(function(){return n(new Error("\u6e05\u7a7a\u5bf9\u8bdd\u8d85\u65f6\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"))},6e4)}),s=E.designerApi.clearChatHistory(ne),e.n=3,Promise.race([s,n]);case 3:t={role:"assistant",content:"\u5bf9\u8bdd\u5df2\u6e05\u7a7a\uff01\u6211\u662f\u60a8\u7684AI\u88c5\u4fee\u8bbe\u8ba1\u5e08 - \u6f2b\u6e38\u89c6\u9891\u751f\u6210\u5668\uff01\u6211\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u6237\u578b\u56fe\u751f\u6210\u88c5\u4fee\u6548\u679c\u56fe\u548c\u6f2b\u6e38\u89c6\u9891\u3002\u8bf7\u4e0a\u4f20\u60a8\u7684\u6237\u578b\u56fe\u5f00\u59cb\u4f53\u9a8c\u5427\uff01",timestamp:Date.now()/1e3},ie([t]),m().showToast({title:"\u5bf9\u8bdd\u5df2\u6e05\u7a7a",icon:"success"}),e.n=5;break;case 4:e.p=4,l=e.v,console.error("\u6e05\u7a7a\u5bf9\u8bdd\u5931\u8d25:",l),null!==l&&void 0!==l&&null!==(a=l.message)&&void 0!==a&&a.includes("\u8d85\u65f6")||null!==l&&void 0!==l&&null!==(i=l.errMsg)&&void 0!==i&&i.includes("timeout")?(console.log("[AI\u8bbe\u8ba1\u5e08] \u6e05\u7a7a\u5bf9\u8bdd\u8d85\u65f6\uff0c\u53ef\u80fd\u662f\u7f51\u7edc\u95ee\u9898"),m().showToast({title:"\u6e05\u7a7a\u5bf9\u8bdd\u8d85\u65f6\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",icon:"none",duration:3e3})):401===l.statusCode||null!==(r=l.message)&&void 0!==r&&r.includes("\u672a\u6388\u6743")||null!==(o=l.message)&&void 0!==o&&o.includes("\u767b\u5f55")?console.log("\u6e05\u7a7a\u5bf9\u8bdd\u65f6401\u9519\u8bef\u5df2\u7531postWithAuth\u5904\u7406"):m().showToast({title:l.message||"\u6e05\u7a7a\u5931\u8d25",icon:"none"});case 5:return e.a(2)}},e,null,[[2,4]])}));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)(function(){try{var e=m().getStorageSync("designer_avatar_position");if(e){var n=JSON.parse(e);x(n)}}catch(e){console.error("\u52a0\u8f7d\u60ac\u6d6e\u5934\u50cf\u4f4d\u7f6e\u5931\u8d25:",e)}},[]),(0,l.useEffect)(function(){if(F){var e=setTimeout(function(){L(!1)},5e3);return function(){return clearTimeout(e)}}},[F]),(0,l.useEffect)(function(){ce.length>0&&fe.current&&setTimeout(function(){if(fe.current)try{var e,n;null===(e=(n=fe.current).scrollToBottom)||void 0===e||e.call(n)}catch(e){if(console.log("\u6eda\u52a8\u5230\u5e95\u90e8\u5931\u8d25:",e),he.current){var s=he.current;s&&1===s.nodeType&&s.scrollIntoView&&s.scrollIntoView({behavior:"smooth",block:"end"})}}},100)},[ce]);var Ee=function(e){var n=new Date(1e3*e);return"".concat(n.getHours().toString().padStart(2,"0"),":").concat(n.getMinutes().toString().padStart(2,"0"))};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(u.Ss,{className:"floating-designer-avatar ".concat(j?"dragging":""),style:{left:"".concat(g.x,"px"),top:"".concat(g.y,"px"),transform:j?"scale(1.1)":"scale(1)"},onTouchStart:ge,onTouchMove:pe,onTouchEnd:xe,onClick:Se,ref:me,children:[(0,p.jsxs)(u.Ss,{className:"avatar-container",children:[(0,p.jsx)(u._V,{className:"avatar-image",src:"https://zhuangxiu-images-dev.oss-cn-hangzhou.aliyuncs.com/avatar/avatar.png",mode:"aspectFill"}),(0,p.jsx)(u.Ss,{className:"avatar-badge",children:"AI"})]}),V&&d&&(0,p.jsx)(u.Ss,{className:"static-hint",children:(0,p.jsx)(u.EY,{className:"static-hint-text",children:"\u8bd5\u8bd5\u548cAI\u8bbe\u8ba1\u5e08\u54a8\u8be2"})}),F&&X&&(0,p.jsxs)(u.Ss,{className:"drag-hint",children:[(0,p.jsx)(u.EY,{className:"hint-text",children:"\u8bd5\u8bd5\u62d6\u62fd\u5b83\u5230\u5408\u9002\u7684\u4f4d\u7f6e"}),(0,p.jsx)(u.Ss,{className:"hint-arrow",children:"\u2193"})]})]}),y&&(0,p.jsx)(u.Ss,{className:"designer-dialog-mask",onClick:Ne,children:(0,p.jsxs)(u.Ss,{className:"designer-dialog",onClick:function(e){return e.stopPropagation()},children:[(0,p.jsxs)(u.Ss,{className:"dialog-header",children:[(0,p.jsx)(u.EY,{className:"dialog-title",children:"AI\u8bbe\u8ba1\u5e08\u804a\u5929"}),(0,p.jsxs)(u.Ss,{className:"dialog-actions",children:[(0,p.jsx)(u.$n,{className:"clear-btn",onClick:be,disabled:ce.length<=1,children:"\u6e05\u7a7a"}),(0,p.jsx)(u.Ss,{className:"dialog-close",onClick:Ne,children:"\xd7"})]})]}),(0,p.jsx)(u.Ss,{className:"dialog-content",children:le?(0,p.jsx)(u.Ss,{className:"loading-container",children:(0,p.jsx)(u.EY,{children:"\u6b63\u5728\u521d\u59cb\u5316\u5bf9\u8bdd..."})}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(u.BM,{className:"chat-messages",scrollY:!0,ref:fe,scrollWithAnimation:!0,children:[ce.map(function(e,n){if("RETRY_ANALYSIS_BUTTON"===e.content)return(0,p.jsx)(u.Ss,{className:"message-item ai-message",children:(0,p.jsxs)(u.Ss,{className:"message-content",children:[(0,p.jsxs)(u.Ss,{className:"retry-button-container",children:[(0,p.jsx)(u.EY,{className:"retry-button-text",children:"AI\u5206\u6790\u53ef\u80fd\u9700\u8981\u66f4\u591a\u65f6\u95f4"}),(0,p.jsx)(u.$n,{className:"retry-button",onClick:(0,i.A)((0,c.A)().m(function e(){var n,s,t,a,i,r,o,l;return(0,c.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(n=(0,b.A)(ce).reverse().find(function(e){return"user"===e.role}),!n||!n.content.includes("\u5df2\u4e0a\u4f20\u6237\u578b\u56fe")){e.n=5;break}return e.p=1,q(!0),s=new Promise(function(e,n){setTimeout(function(){return n(new Error("\u8bf7\u6c42\u8d85\u65f6\uff0cAI\u54cd\u5e94\u65f6\u95f4\u8f83\u957f\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"))},6e5)}),t=E.designerApi.sendChatMessage(ne,"\u8bf7\u5e2e\u6211\u5206\u6790\u4e00\u4e0b\u8fd9\u4e2a\u6237\u578b\u56fe\uff0c\u7ed9\u51fa\u88c5\u4fee\u5efa\u8bae\u548c\u6548\u679c\u56fe\u751f\u6210\u601d\u8def\u3002",[]),e.n=2,Promise.race([t,s]);case 2:a=e.v,i={role:"assistant",content:a.answer,timestamp:Date.now()/1e3},ie(function(e){return[].concat((0,b.A)(e),[i])}),ie(function(e){return e.filter(function(e){return"RETRY_ANALYSIS_BUTTON"!==e.content})}),e.n=4;break;case 3:e.p=3,l=e.v,console.error("\u91cd\u8bd5\u5206\u6790\u5931\u8d25:",l),null!==l&&void 0!==l&&null!==(r=l.message)&&void 0!==r&&r.includes("\u8d85\u65f6")||null!==l&&void 0!==l&&null!==(o=l.errMsg)&&void 0!==o&&o.includes("timeout")?(console.log("[AI\u8bbe\u8ba1\u5e08] \u91cd\u8bd5\u5206\u6790\u8d85\u65f6"),m().showToast({title:"AI\u54cd\u5e94\u65f6\u95f4\u8f83\u957f\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",icon:"none",duration:3e3})):m().showToast({title:l.message||"\u91cd\u8bd5\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",icon:"none"});case 4:return e.p=4,q(!1),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])})),children:"\u91cd\u8bd5\u67e5\u770b\u5206\u6790\u7ed3\u679c"})]}),(0,p.jsx)(u.EY,{className:"message-time",children:Ee(e.timestamp)})]})},n);var s="assistant"===e.role;return(0,p.jsx)(u.Ss,{className:"message-item ".concat("user"===e.role?"user-message":"ai-message"),children:(0,p.jsxs)(u.Ss,{className:"message-content",children:[(0,p.jsx)(u.EY,{className:"message-text",children:s?Y(e.content):e.content}),(0,p.jsx)(u.EY,{className:"message-time",children:Ee(e.timestamp)})]})},n)}),(0,p.jsx)(u.Ss,{ref:he})]}),ce.length<=2&&(0,p.jsx)(u.Ss,{className:"upload-hint-section",children:(0,p.jsxs)(u.Ss,{className:"upload-hint-card",children:[(0,p.jsx)(u.EY,{className:"upload-hint-icon",children:"\ud83d\udcf8"}),(0,p.jsx)(u.EY,{className:"upload-hint-title",children:"\u4e0a\u4f20\u6237\u578b\u56fe\uff0c\u4e00\u952e\u751f\u6210"}),(0,p.jsx)(u.EY,{className:"upload-hint-subtitle",children:"\u88c5\u4fee\u6548\u679c\u56fe + \u6f2b\u6e38\u89c6\u9891"}),(0,p.jsx)(u.Ss,{className:"upload-hint-btn",onClick:ye,children:(0,p.jsx)(u.EY,{className:"upload-hint-btn-text",children:"\u4e0a\u4f20\u6237\u578b\u56fe"})}),(0,p.jsx)(u.EY,{className:"upload-hint-tip",children:"\u652f\u6301 JPG\u3001PNG \u683c\u5f0f\uff0c\u5efa\u8bae\u4e0a\u4f20\u6e05\u6670\u6237\u578b\u56fe"})]})}),ce.length<=2&&(0,p.jsxs)(u.Ss,{className:"quick-questions",children:[(0,p.jsx)(u.EY,{className:"quick-title",children:"\u6216\u8005\u5feb\u901f\u63d0\u95ee\uff1a"}),(0,p.jsx)(u.Ss,{className:"quick-questions-grid",children:Ae.map(function(e,n){return(0,p.jsx)(u.Ss,{className:"quick-question-item",onClick:function(){return ke(e)},children:(0,p.jsx)(u.EY,{className:"quick-question-text",children:e})},n)})})]}),(0,p.jsxs)(u.Ss,{className:"input-area",children:[(0,p.jsx)(u.Ss,{className:"input-left",children:(0,p.jsx)(u.pd,{className:"message-input",placeholder:"\u8f93\u5165\u60a8\u7684\u95ee\u9898\u6216\u4e0a\u4f20\u6237\u578b\u56fe...",value:I,onInput:function(e){return _(e.detail.value)},focus:!I,confirmType:"send",onConfirm:we})}),(0,p.jsxs)(u.Ss,{className:"input-right",children:[(0,p.jsxs)(u.Ss,{className:"upload-btn-large",onClick:ye,children:[(0,p.jsx)(u.EY,{className:"upload-btn-large-icon",children:"\ud83d\udcf7"}),(0,p.jsx)(u.EY,{className:"upload-btn-large-text",children:"\u4e0a\u4f20"})]}),(0,p.jsx)(u.$n,{className:"send-btn",onClick:we,disabled:D||!I.trim(),children:D?"\u601d\u8003\u4e2d...":"\u53d1\u9001"})]})]})]})}),(0,p.jsx)(u.Ss,{className:"dialog-footer",children:(0,p.jsx)(u.EY,{className:"footer-text",children:"AI\u88c5\u4fee\u8bbe\u8ba1\u5e08 - \u6f2b\u6e38\u89c6\u9891\u751f\u6210\u5668 | \u4e0a\u4f20\u6237\u578b\u56fe\u751f\u6210\u6548\u679c\u56fe+\u89c6\u9891"})})]})})]})},I=T;function _(){var e=m().getStorageSync("selected_city");if(!e||!e.trim())return"\u5b9a\u4f4d";var n=e.replace(/\u5e02$/,"").trim();return n.charAt(0)||"\u5b9a\u4f4d"}var M="show_remind_permission_modal",P="show_city_selection_modal",D=function(){var e=(0,l.useState)(0),n=(0,o.A)(e,2),t=n[0],x=n[1],S=(0,l.useState)(!1),j=(0,o.A)(S,2),N=j[0],w=j[1],A=(0,l.useState)(!1),y=(0,o.A)(A,2),b=y[0],E=y[1],C=(0,l.useState)({visible:!1,type:"quote",url:""}),Y=(0,o.A)(C,2),T=Y[0],D=Y[1],q=(0,l.useState)(!1),B=(0,o.A)(q,2),$=B[0],F=B[1],L=(0,l.useState)(!1),R=(0,o.A)(L,2),O=R[0],X=R[1],z=(0,l.useState)(function(){return _()}),W=(0,o.A)(z,2),U=W[0],V=W[1],G=(0,l.useRef)(!0),H=(0,l.useRef)(null);(0,l.useEffect)(function(){G.current=!0;var e=function(){try{if(!G.current)return;var e=m().getStorageSync("selected_city"),n=e&&e.replace(/\u5e02$/,"").trim().charAt(0)||"\u5b9a\u4f4d";if(!G.current)return;V(n)}catch(e){}};return H.current=setInterval(e,500),function(){G.current=!1,H.current&&(clearInterval(H.current),H.current=null)}},[]);var J=[{id:1,title:"\u82b130\u4e07\u88c5\u4fee\uff0c\u4e0d\u8be5\u9760\u8fd0\u6c14",subtitle:"AI\u5e2e\u4f60\u907f\u5751",action:"guide",image:h.wC[0]},{id:2,title:"\u88c5\u4fee\u516c\u53f8\u9760\u8c31\u5417\uff1f",subtitle:"10\u79d2AI\u6838\u9a8c",action:"company",image:h.wC[1]},{id:3,title:"\u62a5\u4ef7\u5355/\u5408\u540c\u85cf\u9677\u9631\uff1f",subtitle:"AI\u9010\u6761\u5206\u6790",action:"upload",image:h.wC[2]}],Z=function(){m().navigateTo({url:"/pages/company-scan/index"})},K=function(e,n){var s=m().getStorageSync("has_company_scan");s||b?m().navigateTo({url:n}):D({visible:!0,type:e,url:n})},Q=function(e,n){D(function(e){return(0,r.A)((0,r.A)({},e),{},{visible:!1})}),e&&(E(!0),m().setStorageSync("no_upload_prompt","1")),m().navigateTo({url:n})},ee=function(){D(function(e){return(0,r.A)((0,r.A)({},e),{},{visible:!1})}),m().navigateTo({url:"/pages/company-scan/index"})},ne=function(){return K("quote","/pages/quote-upload/index")},se=function(){return K("contract","/pages/contract-upload/index")};(0,l.useEffect)(function(){var e=m().getStorageSync("no_upload_prompt");e&&E(!0)},[]),(0,l.useEffect)(function(){try{var e=m().getStorageSync("selected_city"),n=e&&e.trim(),s=m().getStorageSync(P)||!n;s?(m().removeStorageSync(P),n?te():X(!0)):te()}catch(e){}},[]);var te=function(){try{m().getStorageSync(M)&&(m().removeStorageSync(M),F(!0))}catch(e){}},ae=function(e){console.log("[\u9996\u9875] \u57ce\u5e02\u9009\u62e9\u786e\u8ba4",e),X(!1);var n=m().getStorageSync("selected_city"),s=n&&n.replace(/\u5e02$/,"").trim().charAt(0)||"\u5b9a\u4f4d";V(s),console.log("[\u9996\u9875] \u66f4\u65b0\u57ce\u5e02\u663e\u793a",s),setTimeout(function(){te()},300)},ce=function(){X(!1),setTimeout(function(){te()},300)};(0,l.useEffect)(function(){var e=function(){var e=(0,i.A)((0,c.A)().m(function e(){var n,s,t,a,i,r,o,l,u,d,h,g,p,x,v;return(0,c.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(e.p=0,a=m().getStorageSync("access_token"),i=m().getStorageSync("user_id"),a){e.n=1;break}return w(!1),e.a(2);case 1:return r=new Promise(function(e,n){setTimeout(function(){return n(new Error("\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5"))},1e4)}),o=m().request({url:"".concat(f.env.apiBaseUrl,"/messages/unread-count"),method:"GET",header:{Authorization:"Bearer ".concat(a),"X-User-Id":null!=i&&""!==i?String(i):"","Content-Type":"application/json"},timeout:1e4}),e.n=2,Promise.race([o,r]);case 2:l=e.v,u=null!==(n=null===(s=l.data)||void 0===s?void 0:s.data)&&void 0!==n?n:l.data,d=null!==(t=null===u||void 0===u?void 0:u.count)&&void 0!==t?t:0,w(d>0),e.n=4;break;case 3:e.p=3,v=e.v,console.log("[\u9996\u9875] \u83b7\u53d6\u672a\u8bfb\u6d88\u606f\u6570\u5931\u8d25:",v),w(!1),null!==v&&void 0!==v&&null!==(h=v.errMsg)&&void 0!==h&&h.includes("timeout")||null!==v&&void 0!==v&&null!==(g=v.message)&&void 0!==g&&g.includes("\u8d85\u65f6")?console.log("[\u9996\u9875] \u7f51\u7edc\u8bf7\u6c42\u8d85\u65f6\uff0c\u53ef\u80fd\u662f\u7f51\u7edc\u8fde\u63a5\u95ee\u9898\u6216\u670d\u52a1\u5668\u54cd\u5e94\u6162"):null!==v&&void 0!==v&&null!==(p=v.errMsg)&&void 0!==p&&p.includes("fail")||404===(null===v||void 0===v?void 0:v.statusCode)||500===(null===v||void 0===v?void 0:v.statusCode)?console.log("[\u9996\u9875] \u670d\u52a1\u5668\u8bf7\u6c42\u5931\u8d25\uff0c\u72b6\u6001\u7801:",null===v||void 0===v?void 0:v.statusCode):null!==v&&void 0!==v&&null!==(x=v.errMsg)&&void 0!==x&&x.includes("cancel")||console.warn("[\u9996\u9875] \u83b7\u53d6\u672a\u8bfb\u6d88\u606f\u6570\u5f02\u5e38:",v);case 4:return e.a(2)}},e,null,[[0,3]])}));return function(){return e.apply(this,arguments)}}();e()},[]),(0,d.useDidShow)(function(){return V(_())});var ie=function(){var e=m().getStorageSync("construction_start_date");e?(0,g.XS)(g.EN):m().showActionSheet({itemList:["7\u5929\u540e\u5f00\u5de5","15\u5929\u540e\u5f00\u5de5","30\u5929\u540e\u5f00\u5de5","\u9009\u62e9\u5176\u4ed6\u65e5\u671f"],success:function(e){if(3!==e.tapIndex){var n=[7,15,30][e.tapIndex],t=new Date;t.setDate(t.getDate()+n);var c=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0");m().setStorageSync("construction_start_date",c);var i=m().getStorageSync("access_token");i&&Promise.resolve().then(function(){return(0,a.A)(s(4746))}).then(function(e){var n=e.postWithAuth;n("/constructions/start-date",{start_date:c}).catch(function(){})}),m().showToast({title:"\u8fdb\u5ea6\u8ba1\u5212\u5df2\u66f4\u65b0",icon:"success"}),(0,g.XS)(g.EN,{defer:150})}else(0,g.XS)(g.EN,{defer:150})},fail:function(){}})},re=function(e){m().setStorageSync("construction_scroll_stage",e),(0,g.XS)(g.EN)},oe=function(){F(!1);try{"function"===typeof m().requestSubscribeMessage&&m().requestSubscribeMessage({tmplIds:[],entityIds:[],success:function(){return m().setStorageSync("remind_permission_granted",!0)},fail:function(){}}).catch(function(){})}catch(e){}},le=function(){F(!1)},ue=function(e){switch(e){case"guide":m().navigateTo({url:"/pages/guide/index"});break;case"company":Z();break;case"upload":m().showActionSheet({itemList:["\u4e0a\u4f20\u62a5\u4ef7\u5355","\u4e0a\u4f20\u5408\u540c"],success:function(e){0===e.tapIndex?ne():1===e.tapIndex&&se()},fail:function(){}});break}};return(0,p.jsxs)(u.Ss,{className:"index-page",children:[(0,p.jsxs)(u.Ss,{className:"header",children:[(0,p.jsx)(u.Ss,{className:"city-entry",onClick:function(){return m().navigateTo({url:"/pages/city-picker/index"})},children:(0,p.jsx)(u.EY,{className:"city-entry-text",children:U})}),(0,p.jsx)(u.EY,{className:"title",children:"\u88c5\u4fee\u907f\u5751\u7ba1\u5bb6"}),(0,p.jsxs)(u.Ss,{className:"message-icon",onClick:function(){return m().navigateTo({url:"/pages/message/index"})},children:[(0,p.jsx)(u.EY,{className:"icon-text",children:"\ud83d\udd14"}),N&&(0,p.jsx)(u.Ss,{className:"dot"})]})]}),(0,p.jsx)(u.Ss,{className:"swiper-container",children:(0,p.jsx)(u.RC,{className:"swiper",indicatorDots:!0,indicatorColor:"rgba(255,255,255,0.4)",indicatorActiveColor:"#fff",autoplay:!0,interval:3e3,circular:!0,current:t,onChange:function(e){return x(e.detail.current)},children:J.map(function(e){return(0,p.jsx)(u.wu,{children:(0,p.jsxs)(u.Ss,{className:"swiper-item",onClick:function(){return ue(e.action)},children:[h.ih&&e.image?(0,p.jsx)(u._V,{src:e.image,className:"swiper-img",mode:"aspectFill"}):(0,p.jsx)(u.Ss,{className:"swiper-bg"}),(0,p.jsxs)(u.Ss,{className:"swiper-content",children:[(0,p.jsx)(u.EY,{className:"swiper-title",style:{color:"#FFD700"},children:e.title}),(0,p.jsx)(u.EY,{className:"swiper-subtitle",style:{color:"#FFEB3B"},children:e.subtitle})]})]})},e.id)})})}),(0,p.jsxs)(u.Ss,{className:"main-actions grid-four",children:[(0,p.jsxs)(u.Ss,{className:"action-card",onClick:Z,children:[(0,p.jsx)(u.EY,{className:"action-card-icon",children:"\ud83c\udfe2"}),(0,p.jsx)(u.EY,{className:"action-card-text",children:"\u88c5\u4fee\u516c\u53f8\u68c0\u6d4b"})]}),(0,p.jsxs)(u.Ss,{className:"action-card",onClick:ne,children:[(0,p.jsx)(u.EY,{className:"action-card-icon",children:"\ud83d\udcb0"}),(0,p.jsx)(u.EY,{className:"action-card-text",children:"\u88c5\u4fee\u62a5\u4ef7\u5206\u6790"})]}),(0,p.jsxs)(u.Ss,{className:"action-card",onClick:se,children:[(0,p.jsx)(u.EY,{className:"action-card-icon",children:"\ud83d\udcdc"}),(0,p.jsx)(u.EY,{className:"action-card-text",children:"\u88c5\u4fee\u5408\u540c\u5ba1\u6838"})]}),(0,p.jsxs)(u.Ss,{className:"action-card highlight",onClick:ie,children:[(0,p.jsx)(u.EY,{className:"action-card-icon",children:"\ud83d\udd0d"}),(0,p.jsx)(u.EY,{className:"action-card-text",children:"AI\u65bd\u5de5\u9a8c\u6536"}),(0,p.jsx)(u.EY,{className:"action-card-hint",children:"6\u5927\u9636\u6bb5"})]})]}),(0,p.jsx)(u.Ss,{className:"section-label",children:(0,p.jsx)(u.EY,{children:"6\u5927\u9636\u6bb5"})}),(0,p.jsx)(u.BM,{scrollX:!0,className:"stage-quick-scroll",showScrollbar:!1,children:(0,p.jsx)(u.Ss,{className:"stage-quick-list",children:["S00\u6750\u6599","S01\u9690\u853d","S02\u6ce5\u74e6","S03\u6728\u5de5","S04\u6cb9\u6f06","S05\u6536\u5c3e"].map(function(e,n){return(0,p.jsxs)(u.Ss,{className:"stage-quick-item",onClick:function(){return re(n)},children:[(0,p.jsx)(u.EY,{className:"stage-quick-icon",children:["\ud83d\udce6","\ud83d\udd0c","\ud83e\uddf1","\ud83e\udeb5","\ud83d\udd8c","\u2705"][n]}),(0,p.jsx)(u.EY,{className:"stage-quick-text",children:e})]},n)})})}),(0,p.jsxs)(u.Ss,{className:"member-card",onClick:function(){return m().navigateTo({url:"/pages/membership/index"})},children:[(0,p.jsx)(u.EY,{className:"member-card-text",children:"6\u5927\u9636\u6bb5\u5168\u62a5\u544a\u89e3\u9501+\u65e0\u9650\u6b21AI\u63d0\u9192"}),(0,p.jsx)(u.EY,{className:"member-card-btn",children:"\u7acb\u5373\u5f00\u901a"})]}),(0,p.jsx)(u.Ss,{className:"ai-designer-fixed-container",children:(0,p.jsx)(I,{showDragHint:!0,initialPosition:{x:0,y:0},fixedMode:!0,fixedContainerClassName:"ai-designer-fixed"})}),(0,p.jsx)(u.EY,{className:"tips-text",children:"\u672c\u5730\u88c5\u4fee\u884c\u4e1a\u89c4\u8303\u5b9e\u65f6\u66f4\u65b0\uff0cAI\u68c0\u6d4b\u66f4\u7cbe\u51c6"}),(0,p.jsx)(v,{visible:T.visible,type:T.type,onConfirm:function(e){return Q(e,T.url)},onGoScan:ee,onClose:function(){return D(function(e){return(0,r.A)((0,r.A)({},e),{},{visible:!1})})}}),(0,p.jsx)(k,{visible:O,onConfirm:ae,onClose:ce}),$&&(0,p.jsx)(u.Ss,{className:"remind-permission-mask",onClick:le,children:(0,p.jsxs)(u.Ss,{className:"remind-permission-modal",onClick:function(e){return e.stopPropagation()},children:[(0,p.jsx)(u.EY,{className:"remind-permission-title",children:"\u8fdb\u5ea6+\u6d88\u606f\u63d0\u9192"}),(0,p.jsx)(u.EY,{className:"remind-permission-desc",children:"\u5f00\u542f\u540e\uff0c6\u5927\u9636\u6bb5\u5f00\u59cb/\u9a8c\u6536\u524d\u5c06\u4e3a\u60a8\u63a8\u9001\u5fae\u4fe1\u670d\u52a1\u901a\u77e5\uff0c\u88c5\u4fee\u4e0d\u9057\u6f0f"}),(0,p.jsxs)(u.Ss,{className:"remind-permission-btns",children:[(0,p.jsx)(u.Ss,{className:"remind-permission-btn reject",onClick:le,children:(0,p.jsx)(u.EY,{children:"\u62d2\u7edd"})}),(0,p.jsx)(u.Ss,{className:"remind-permission-btn allow",onClick:oe,children:(0,p.jsx)(u.EY,{children:"\u5141\u8bb8"})})]}),(0,p.jsx)(u.EY,{className:"remind-permission-hint",children:"\u62d2\u7edd\u540e\u53ef\u5728\u3010\u6211\u7684-\u8bbe\u7f6e\u3011\u4e8c\u6b21\u5f00\u542f"})]})})]})},q=D,B={navigationBarTitleText:"\u88c5\u4fee\u907f\u5751\u7ba1\u5bb6",navigationBarBackgroundColor:"#1677FF",navigationBarTextStyle:"white",enableShareAppMessage:!0,onReachBottomDistance:50};q.enableShareAppMessage=!0;Page((0,t.createPageConfig)(q,"pages/index/index",{root:{cn:[]}},B||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[6907,8096,2076],function(){return n(8227)});e.O()}]);