"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[398],{8316:function(e,s,t){var n=t(7842),a=t(1212),c=t(467),r=t(5544),i=t(6540),l=t(118),o=t(758),u=t.n(o),d=t(4746),h=t(4848),m=function(){var e=(0,i.useState)(null),s=(0,r.A)(e,2),t=s[0],n=s[1],o=(0,i.useState)(""),m=(0,r.A)(o,2),p=m[0],x=m[1],f=(0,i.useState)(!1),j=(0,r.A)(f,2),N=(j[0],j[1]),g=(0,i.useState)(""),S=(0,r.A)(g,2),w=(S[0],S[1]),v=[{key:"demolition",name:"\u62c6\u6539\u9636\u6bb5"},{key:"water_electric",name:"\u6c34\u7535\u9636\u6bb5"},{key:"masonry",name:"\u6ce5\u5de5\u9636\u6bb5"},{key:"carpentry",name:"\u6728\u5de5\u9636\u6bb5"},{key:"paint",name:"\u6cb9\u6f06\u9636\u6bb5"},{key:"installation",name:"\u5b89\u88c5\u9636\u6bb5"}],k=function(){var e=(0,c.A)((0,a.A)().m(function e(){var s,t;return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,d.MH.getSchedule();case 1:s=e.v,n(s),s.start_date&&(x(s.start_date),w(s.current_stage||"")),e.n=3;break;case 2:e.p=2,t=e.v,console.error("\u52a0\u8f7d\u8fdb\u5ea6\u5931\u8d25:",t);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)(function(){k()},[]);var E=function(){var e=(0,c.A)((0,a.A)().m(function e(){return(0,a.A)().w(function(e){while(1)switch(e.n){case 0:u().showModal({title:"\u8bbe\u7f6e\u5f00\u5de5\u65e5\u671f",editable:!0,placeholderText:"\u8bf7\u9009\u62e9\u5f00\u5de5\u65e5\u671f",success:function(){var e=(0,c.A)((0,a.A)().m(function e(s){return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(!s.confirm||!s.content){e.n=5;break}return N(!0),e.p=1,e.n=2,d.MH.setStartDate(s.content);case 2:x(s.content),u().showToast({title:"\u8bbe\u7f6e\u6210\u529f",icon:"success"}),k(),e.n=4;break;case 3:e.p=3,e.v,u().showToast({title:"\u8bbe\u7f6e\u5931\u8d25",icon:"none"});case 4:return e.p=4,N(!1),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])}));function s(s){return e.apply(this,arguments)}return s}()});case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=(0,c.A)((0,a.A)().m(function e(s,t){return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return N(!0),e.p=1,e.n=2,d.MH.updateStageStatus(s,t);case 2:u().showToast({title:"\u66f4\u65b0\u6210\u529f",icon:"success"}),k(),e.n=4;break;case 3:e.p=3,e.v,u().showToast({title:"\u66f4\u65b0\u5931\u8d25",icon:"none"});case 4:return e.p=4,N(!1),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])}));return function(s,t){return e.apply(this,arguments)}}(),y=function(){u().showModal({title:"\u91cd\u7f6e\u8fdb\u5ea6",content:"\u786e\u5b9a\u8981\u91cd\u7f6e\u6240\u6709\u8fdb\u5ea6\u5417\uff1f",success:function(){var e=(0,c.A)((0,a.A)().m(function e(s){return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(!s.confirm){e.n=5;break}return N(!0),e.p=1,e.n=2,d.MH.resetSchedule();case 2:n(null),x(""),w(""),u().showToast({title:"\u91cd\u7f6e\u6210\u529f",icon:"success"}),e.n=4;break;case 3:e.p=3,e.v,u().showToast({title:"\u91cd\u7f6e\u5931\u8d25",icon:"none"});case 4:return e.p=4,N(!1),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])}));function s(s){return e.apply(this,arguments)}return s}()})},b=function(){if(!t||!t.stages)return 0;var e=0,s=v.length;return v.forEach(function(s){var n=t.stages[s.key];n&&"completed"===n.status&&e++}),Math.round(e/s*100)},A=function(){if(!p)return"-";var e=new Date(p),s=new Date(e);return s.setDate(s.getDate()+60),s.toLocaleDateString("zh-CN")};return(0,h.jsxs)(l.BM,{scrollY:!0,className:"construction-page",children:[(0,h.jsx)(l.Ss,{className:"header",children:(0,h.jsx)(l.EY,{className:"title",children:"\u65bd\u5de5\u966a\u4f34"})}),(0,h.jsxs)(l.Ss,{className:"content",children:[(0,h.jsxs)(l.Ss,{className:"date-section",children:[(0,h.jsxs)(l.Ss,{className:"section-header",children:[(0,h.jsx)(l.EY,{className:"section-title",children:"\u5f00\u5de5\u65e5\u671f"}),(0,h.jsx)(l.EY,{className:"edit-btn",onClick:E,children:p?"\u4fee\u6539":"\u8bbe\u7f6e"})]}),p?(0,h.jsxs)(l.Ss,{className:"date-display",children:[(0,h.jsx)(l.EY,{className:"date-text",children:p}),(0,h.jsx)(l.EY,{className:"date-label",children:"\u5f00\u5de5\u65e5"})]}):(0,h.jsxs)(l.Ss,{className:"date-empty",children:[(0,h.jsx)(l.EY,{className:"empty-text",children:"\u8bf7\u8bbe\u7f6e\u5f00\u5de5\u65e5\u671f"}),(0,h.jsx)(l.EY,{className:"empty-hint",children:"\u8bbe\u7f6e\u540e\u5c06\u81ea\u52a8\u751f\u6210\u8fdb\u5ea6\u8ba1\u5212"})]})]}),p&&(0,h.jsxs)(l.Ss,{className:"progress-section",children:[(0,h.jsxs)(l.Ss,{className:"progress-header",children:[(0,h.jsx)(l.EY,{className:"progress-title",children:"\u603b\u4f53\u8fdb\u5ea6"}),(0,h.jsxs)(l.EY,{className:"progress-value",children:[b(),"%"]})]}),(0,h.jsx)(l.Ss,{className:"progress-bar",children:(0,h.jsx)(l.Ss,{className:"progress-fill",style:{width:"".concat(b(),"%")}})}),(0,h.jsxs)(l.Ss,{className:"date-summary",children:[(0,h.jsxs)(l.Ss,{className:"date-item",children:[(0,h.jsx)(l.EY,{className:"date-label",children:"\u5f00\u5de5"}),(0,h.jsx)(l.EY,{className:"date-value",children:p})]}),(0,h.jsxs)(l.Ss,{className:"date-item",children:[(0,h.jsx)(l.EY,{className:"date-label",children:"\u9884\u8ba1\u5b8c\u6210"}),(0,h.jsx)(l.EY,{className:"date-value",children:A()})]})]})]}),p&&(0,h.jsxs)(l.Ss,{className:"stages-section",children:[(0,h.jsx)(l.EY,{className:"section-title",children:"\u9636\u6bb5\u8fdb\u5ea6"}),v.map(function(e,s){var n,a=null===t||void 0===t||null===(n=t.stages)||void 0===n?void 0:n[e.key],c=(null===a||void 0===a?void 0:a.status)||"pending";return(0,h.jsxs)(l.Ss,{className:"stage-item",children:[(0,h.jsxs)(l.Ss,{className:"stage-header",children:[(0,h.jsxs)(l.Ss,{className:"stage-info",children:[(0,h.jsx)(l.EY,{className:"stage-number",children:s+1}),(0,h.jsxs)(l.Ss,{children:[(0,h.jsx)(l.EY,{className:"stage-name",children:e.name}),(0,h.jsxs)(l.EY,{className:"stage-status",children:["completed"===c&&"\u2705 \u5df2\u5b8c\u6210","in_progress"===c&&"\u23f3 \u8fdb\u884c\u4e2d","pending"===c&&"\u2b55 \u672a\u5f00\u59cb"]})]})]}),(0,h.jsxs)(l.Ss,{className:"stage-actions",children:["pending"===c&&(0,h.jsx)(l.EY,{className:"action-btn start",onClick:function(){return Y(e.key,"in_progress")},children:"\u5f00\u59cb"}),"in_progress"===c&&(0,h.jsx)(l.EY,{className:"action-btn complete",onClick:function(){return Y(e.key,"completed")},children:"\u5b8c\u6210"})]})]}),(null===a||void 0===a?void 0:a.tasks)&&a.tasks.length>0&&(0,h.jsx)(l.Ss,{className:"stage-tasks",children:a.tasks.map(function(e,s){return(0,h.jsx)(l.Ss,{className:"task-item",children:(0,h.jsx)(l.EY,{className:"task-text",children:e.name})},s)})})]},e.key)})]}),p&&(0,h.jsx)(l.Ss,{className:"action-buttons",children:(0,h.jsx)(l.Ss,{className:"reset-btn",onClick:y,children:(0,h.jsx)(l.EY,{className:"reset-text",children:"\u91cd\u7f6e\u8fdb\u5ea6"})})}),(0,h.jsxs)(l.Ss,{className:"tips",children:[(0,h.jsx)(l.EY,{className:"tips-title",children:"\u6e29\u99a8\u63d0\u793a"}),(0,h.jsx)(l.EY,{className:"tips-text",children:'\u2022 \u70b9\u51fb"\u5f00\u59cb"\u6807\u8bb0\u9636\u6bb5\u8fdb\u884c\u4e2d'}),(0,h.jsx)(l.EY,{className:"tips-text",children:'\u2022 \u5b8c\u6210\u9a8c\u6536\u540e\u70b9\u51fb"\u5b8c\u6210"\u6807\u8bb0\u9636\u6bb5\u7ed3\u675f'}),(0,h.jsx)(l.EY,{className:"tips-text",children:"\u2022 \u91cd\u7f6e\u8fdb\u5ea6\u5c06\u6e05\u7a7a\u6240\u6709\u9636\u6bb5\u72b6\u6001"})]})]})]})},p=m,x={navigationBarTitleText:"\u65bd\u5de5\u966a\u4f34",navigationBarBackgroundColor:"#1677FF",navigationBarTextStyle:"white",enablePullDownRefresh:!0};Page((0,n.createPageConfig)(p,"pages/construction/index",{root:{cn:[]}},x||{}))}},function(e){var s=function(s){return e(e.s=s)};e.O(0,[907,96,76],function(){return s(8316)});e.O()}]);