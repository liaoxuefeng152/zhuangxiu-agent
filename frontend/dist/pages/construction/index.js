"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[398],{1691:function(e,n,t){var s=t(7842),a=t(4467),i=t(1212),c=t(9379),r=t(467),l=t(5544),o=t(6540),d=t(118),u=t(758),m=t.n(u),h=t(4353),f=t.n(h),g=t(1281),S=t(4848),v={material:{title:"S00 \u6750\u6599\u8fdb\u573a\u6838\u5bf9\u6307\u5f15",points:["1. \u6838\u5bf9\u6750\u6599\u6e05\u5355\u4e0e\u5408\u540c/\u62a5\u4ef7\u5355\u662f\u5426\u4e00\u81f4","2. \u54c1\u724c\u3001\u89c4\u683c\u3001\u6570\u91cf\u9010\u4e00\u5bf9\u7167","3. \u5fc5\u62cd\uff1a\u6750\u6599\u6e05\u5355+\u5b9e\u7269\u5bf9\u6bd4\u7167","4. \u4e0d\u5408\u683c\u9879\u8bb0\u5f55\u5e76\u8981\u6c42\u66f4\u6362"]},plumbing:{title:"S01 \u9690\u853d\u5de5\u7a0b\u9a8c\u6536\u8981\u70b9",points:["1. \u5f3a\u7535\u4e0e\u5f31\u7535\u95f4\u8ddd\u226530cm\uff0c\u4ea4\u53c9\u5904\u9521\u7b94\u7eb8\u5c4f\u853d","2. \u7ebf\u7ba1\u5f2f\u66f2\u534a\u5f84\u22656\u500d\u7ba1\u5f84\uff0c\u65e0\u6b7b\u5f2f","3. \u7535\u7ebf\u63a5\u5934\u6302\u9521\u6216\u4f7f\u7528\u63a5\u7ebf\u7aef\u5b50","4. \u6c34\u7ba1\u6253\u538b0.6-0.8MPa\uff0c30\u5206\u949f\u538b\u964d\u22640.05MPa","5. \u51b7\u70ed\u6c34\u7ba1\u5de6\u70ed\u53f3\u51b7\uff0c\u95f4\u8ddd\u226515cm"]},water_electric:{title:"\u6c34\u7535\u9a8c\u6536\u8981\u70b9",points:["1. \u5f3a\u7535\u4e0e\u5f31\u7535\u95f4\u8ddd\u226530cm\uff0c\u4ea4\u53c9\u5904\u9521\u7b94\u7eb8\u5c4f\u853d","2. \u7ebf\u7ba1\u5f2f\u66f2\u534a\u5f84\u22656\u500d\u7ba1\u5f84\uff0c\u65e0\u6b7b\u5f2f","3. \u7535\u7ebf\u63a5\u5934\u6302\u9521\u6216\u4f7f\u7528\u63a5\u7ebf\u7aef\u5b50","4. \u6c34\u7ba1\u6253\u538b0.6-0.8MPa\uff0c30\u5206\u949f\u538b\u964d\u22640.05MPa","5. \u51b7\u70ed\u6c34\u7ba1\u5de6\u70ed\u53f3\u51b7\uff0c\u95f4\u8ddd\u226515cm"]},carpentry:{title:"S02 \u6ce5\u74e6\u5de5\u9a8c\u6536\u8981\u70b9",points:["1. \u74f7\u7816\u7a7a\u9f13\u7387\u22645%\uff0c\u91cd\u70b9\u68c0\u67e5\u8fb9\u89d2","2. \u540a\u9876\u9f99\u9aa8\u95f4\u8ddd\u7b26\u5408\u89c4\u8303\uff0c\u7262\u56fa\u65e0\u677e\u52a8","3. \u6728\u8d28\u6750\u6599\u505a\u597d\u9632\u6f6e\u9632\u8150\u5904\u7406","4. \u9634\u9633\u89d2\u5782\u76f4\u5ea6\u504f\u5dee\u22643mm"]},woodwork:{title:"S03 \u6728\u5de5\u9a8c\u6536\u8981\u70b9",points:["1. \u540a\u9876\u9f99\u9aa8\u95f4\u8ddd\u7b26\u5408\u89c4\u8303\uff0c\u7262\u56fa\u65e0\u677e\u52a8","2. \u6728\u8d28\u6750\u6599\u9632\u6f6e\u9632\u8150\u5904\u7406\u5230\u4f4d","3. \u9634\u9633\u89d2\u5782\u76f4\u5ea6\u504f\u5dee\u22643mm","4. \u67dc\u4f53\u5b89\u88c5\u7262\u56fa\u3001\u95e8\u7f1d\u5747\u5300"]},masonry_wood:{title:"\u6ce5\u6728\u9a8c\u6536\u8981\u70b9",points:["1. \u74f7\u7816\u7a7a\u9f13\u7387\u22645%\uff0c\u91cd\u70b9\u68c0\u67e5\u8fb9\u89d2","2. \u540a\u9876\u9f99\u9aa8\u95f4\u8ddd\u7b26\u5408\u89c4\u8303\uff0c\u7262\u56fa\u65e0\u677e\u52a8","3. \u6728\u8d28\u6750\u6599\u505a\u597d\u9632\u6f6e\u9632\u8150\u5904\u7406","4. \u9634\u9633\u89d2\u5782\u76f4\u5ea6\u504f\u5dee\u22643mm"]},painting:{title:"S04 \u6cb9\u6f06\u9a8c\u6536\u8981\u70b9",points:["1. \u5899\u9762\u5e73\u6574\uff0c\u65e0\u88c2\u7eb9\u3001\u8d77\u76ae\u3001\u6d41\u5760","2. \u9634\u9633\u89d2\u987a\u76f4\uff0c\u65e0\u7f3a\u68f1\u6389\u89d2","3. \u6d82\u6599\u8272\u6cfd\u5747\u5300\uff0c\u65e0\u8272\u5dee","4. \u6cb9\u6f06\u8868\u9762\u5149\u6ed1\uff0c\u65e0\u9897\u7c92\u3001\u5237\u75d5"]},paint:{title:"\u6cb9\u6f06\u9a8c\u6536\u8981\u70b9",points:["1. \u5899\u9762\u5e73\u6574\uff0c\u65e0\u88c2\u7eb9\u3001\u8d77\u76ae\u3001\u6d41\u5760","2. \u9634\u9633\u89d2\u987a\u76f4\uff0c\u65e0\u7f3a\u68f1\u6389\u89d2","3. \u6d82\u6599\u8272\u6cfd\u5747\u5300\uff0c\u65e0\u8272\u5dee","4. \u6cb9\u6f06\u8868\u9762\u5149\u6ed1\uff0c\u65e0\u9897\u7c92\u3001\u5237\u75d5"]},installation:{title:"S05 \u5b89\u88c5\u6536\u5c3e\u9a8c\u6536\u8981\u70b9",points:["1. \u6a71\u67dc/\u536b\u6d74/\u95e8\u5b89\u88c5\u7262\u56fa\uff0c\u5f00\u5173\u987a\u7545","2. \u4e94\u91d1\u4ef6\u65e0\u7f3a\u5931\u3001\u65e0\u677e\u52a8","3. \u706f\u5177/\u5f00\u5173\u63d2\u5ea7\u901a\u7535\u6b63\u5e38","4. \u6574\u4f53\u4fdd\u6d01\u5b8c\u6210\uff0c\u65e0\u9057\u6f0f"]},floor:{title:"\u5730\u677f\u9a8c\u6536\u8981\u70b9",points:["1. \u5730\u9762\u5e73\u6574\u5ea6\u22643mm/2m","2. \u5730\u677f\u62fc\u63a5\u7d27\u5bc6\uff0c\u65e0\u8d77\u62f1\u3001\u5f02\u54cd","3. \u6536\u8fb9\u6761\u5b89\u88c5\u7262\u56fa\uff0c\u65e0\u7f1d\u9699","4. \u5730\u6696\u533a\u57df\u4f7f\u7528\u4e13\u7528\u5730\u677f"]},soft_furnishing:{title:"\u8f6f\u88c5\u9a8c\u6536\u8981\u70b9",points:["1. \u5b9a\u5236\u5bb6\u5177\u5c3a\u5bf8\u4e0e\u56fe\u7eb8\u4e00\u81f4","2. \u4e94\u91d1\u4ef6\u5b89\u88c5\u7262\u56fa\uff0c\u5f00\u5173\u987a\u7545","3. \u8f6f\u88c5\u6750\u8d28\u65e0\u5f02\u5473\uff0c\u73af\u4fdd\u8fbe\u6807","4. \u6574\u4f53\u98ce\u683c\u534f\u8c03\uff0c\u65e0\u660e\u663e\u7455\u75b5"]},soft:{title:"\u8f6f\u88c5\u9a8c\u6536\u8981\u70b9",points:["1. \u5b9a\u5236\u5bb6\u5177\u5c3a\u5bf8\u4e0e\u56fe\u7eb8\u4e00\u81f4","2. \u4e94\u91d1\u4ef6\u5b89\u88c5\u7262\u56fa\uff0c\u5f00\u5173\u987a\u7545","3. \u8f6f\u88c5\u6750\u8d28\u65e0\u5f02\u5473\uff0c\u73af\u4fdd\u8fbe\u6807","4. \u6574\u4f53\u98ce\u683c\u534f\u8c03\uff0c\u65e0\u660e\u663e\u7455\u75b5"]}},x=function(e){var n=e.stageKey,t=e.visible,s=e.onClose;if(!t)return null;var a=v[n]||v.material||v.plumbing;return(0,S.jsx)(d.Ss,{className:"guide-modal-mask",onClick:s,children:(0,S.jsxs)(d.Ss,{className:"guide-modal",onClick:function(e){return e.stopPropagation()},children:[(0,S.jsx)(d.EY,{className:"close-btn",onClick:s,children:"\xd7"}),(0,S.jsx)(d.EY,{className:"modal-title",children:a.title}),(0,S.jsx)(d.BM,{scrollY:!0,className:"guide-content",children:a.points.map(function(e,n){return(0,S.jsx)(d.EY,{className:"guide-point",children:e},n)})})]})})},p=x,y=t(4746),j=t(5898),N=[{key:"material",name:"\u6750\u6599\u8fdb\u573a\u6838\u5bf9",days:3,label:"S00",icon:"\ud83d\udce6"},{key:"plumbing",name:"\u9690\u853d\u5de5\u7a0b",days:7,label:"S01",icon:"\ud83d\udd0c"},{key:"carpentry",name:"\u6ce5\u74e6\u5de5",days:10,label:"S02",icon:"\ud83e\uddf1"},{key:"woodwork",name:"\u6728\u5de5",days:7,label:"S03",icon:"\ud83e\ude9a"},{key:"painting",name:"\u6cb9\u6f06",days:7,label:"S04",icon:"\ud83d\udd8c\ufe0f"},{key:"installation",name:"\u5b89\u88c5\u6536\u5c3e",days:5,label:"S05",icon:"\ud83d\udd27"}],Y=(N.reduce(function(e,n){return e+n.days},0),"construction_start_date"),k="construction_stage_calibrate",w=[1,2,3,5,7],b="accept",E=function(){var e={};return N.forEach(function(n){e[n.key]="pending"}),e},A=function(e,n){return"rectify"===n?"need_rectify":"completed"===n?(0,j.PR)(e):null},C=function(){var e,n=(0,o.useState)(""),t=(0,l.A)(n,2),s=t[0],h=t[1],v=(0,o.useState)(E()),x=(0,l.A)(v,2),C=x[0],_=x[1],M=(0,o.useState)(null),T=(0,l.A)(M,2),D=T[0],O=T[1],B=(0,o.useState)(!0),P=(0,l.A)(B,2),J=P[0],L=P[1],W=(0,o.useState)(!1),K=(0,l.A)(W,2),I=K[0],R=K[1],q=(0,o.useState)(null),F=(0,l.A)(q,2),X=F[0],z=F[1],V=(0,o.useState)(null),$=(0,l.A)(V,2),G=$[0],H=$[1],Q=(0,o.useState)(null),U=(0,l.A)(Q,2),Z=(U[0],U[1],(0,o.useState)(!1)),ee=(0,l.A)(Z,2),ne=ee[0],te=ee[1],se=(0,o.useState)(3),ae=(0,l.A)(se,2),ie=ae[0],ce=ae[1],re=(0,o.useState)(!0),le=(0,l.A)(re,2),oe=le[0],de=le[1],ue=(0,o.useState)(""),me=(0,l.A)(ue,2),he=(me[0],me[1],(0,o.useState)({})),fe=(0,l.A)(he,2),ge=fe[0],Se=fe[1],ve=(0,o.useState)(new Set),xe=(0,l.A)(ve,2),pe=xe[0],ye=xe[1],je=(0,o.useState)(null),Ne=(0,l.A)(je,2),Ye=Ne[0],ke=Ne[1],we=!!m().getStorageSync("access_token"),be=(0,o.useCallback)((0,r.A)((0,i.A)().m(function e(){var n,t,s,a,r,l,o,d,u,g,S,v,x,p,w,b,A,C,M;return(0,i.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(we){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,(0,y.getWithAuth)("/constructions/schedule");case 2:s=e.v,a=null!==(n=null===s||void 0===s?void 0:s.data)&&void 0!==n?n:s,r=null!==(t=null===a||void 0===a?void 0:a.stages)&&void 0!==t?t:{},l=E(),o={},N.forEach(function(e){var n,t,s=(0,j.Ax)(e.key),a=null===(n=r[s])||void 0===n?void 0:n.status;l[e.key]=(0,j.$f)(a,e.key),null!==(t=r[s])&&void 0!==t&&t.end_date&&(o[e.key]=f()(r[s].end_date).format("YYYY-MM-DD"))}),null!==a&&void 0!==a&&a.start_date?(d=f()(a.start_date).format("YYYY-MM-DD"),h(d),Ce(d,l)):(h(""),m().removeStorageSync(Y),m().setStorageSync(j.Wj,JSON.stringify(l))),_(l),ye(new Set),Object.keys(o).length>0&&Se(function(e){return(0,c.A)((0,c.A)({},e),o)}),R(!0),y.materialChecksApi.getMaterialList().then(function(e){var n,t,s,a=null!==(n=null!==(t=null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.list)&&void 0!==t?t:null===e||void 0===e?void 0:e.list)&&void 0!==n?n:[];ke(Array.isArray(a)&&a.length>0)}).catch(function(){return ke(!1)}),e.n=4;break;case 3:if(e.p=3,M=e.v,x=404===(null===M||void 0===M?void 0:M.statusCode)||404===(null===M||void 0===M||null===(u=M.response)||void 0===u?void 0:u.status)||(null===M||void 0===M||null===(g=M.message)||void 0===g?void 0:g.includes("404")),p=401===(null===M||void 0===M?void 0:M.statusCode)||401===(null===M||void 0===M||null===(S=M.response)||void 0===S?void 0:S.status)||(null===M||void 0===M||null===(v=M.message)||void 0===v?void 0:v.includes("\u8bf7\u7a0d\u540e\u91cd\u8bd5"))||(null===M||void 0===M?void 0:M.isSilent),x||p){if(w=m().getStorageSync(Y),b=m().getStorageSync(j.Wj),A=m().getStorageSync(k),w&&h(w),b)try{C="string"===typeof b?JSON.parse(b):b,_((0,c.A)((0,c.A)({},E()),C))}catch(e){_(E())}else _(E());if(A)try{Se("string"===typeof A?JSON.parse(A):A)}catch(e){}}R(!1);case 4:return e.p=4,L(!1),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])})),[we]),Ee=(0,o.useCallback)(function(){var e=m().getStorageSync(Y),n=m().getStorageSync(j.Wj),t=m().getStorageSync(k);if(e&&h(e),n)try{var s="string"===typeof n?JSON.parse(n):n;_((0,c.A)((0,c.A)({},E()),s))}catch(e){_(E())}else _(E());if(t)try{Se("string"===typeof t?JSON.parse(t):t)}catch(e){}var a=m().getStorageSync("remind_days");"number"===typeof a&&w.includes(a)&&ce(a);var i=m().getStorageSync("smart_remind");"boolean"===typeof i&&de(i),R(!1),L(!1)},[]);(0,o.useEffect)(function(){we?be():Ee()},[we,be,Ee]),(0,u.useDidShow)(function(){if(we?be():Ee(),s){var e=m().getStorageSync("construction_scroll_stage"),n="number"===typeof e?e:parseInt(String(null!==e&&void 0!==e?e:""),10);n>=0&&n<N.length&&(m().removeStorageSync("construction_scroll_stage"),z("stage-".concat(n)),H(n),setTimeout(function(){H(null),z(null)},3500))}});var Ae=(0,o.useRef)(!0);(0,o.useEffect)(function(){return Ae.current=!0,function(){Ae.current=!1}},[]),(0,o.useEffect)(function(){if(s){var e=m().getStorageSync("construction_scroll_stage"),n="number"===typeof e?e:parseInt(String(null!==e&&void 0!==e?e:""),10);if(n>=0&&n<N.length){m().removeStorageSync("construction_scroll_stage"),z("stage-".concat(n)),H(n);var t=setTimeout(function(){Ae.current&&(H(null),z(null))},3500);return function(){return clearTimeout(t)}}}},[s]),(0,o.useEffect)(function(){I&&we&&0!==pe.size&&pe.forEach(function(e){var n=A(e,C[e]);n?(0,y.putWithAuth)("/constructions/stage-status",{stage:(0,j.Ax)(e),status:n}).then(function(){(0,j.li)(e,n),_e(e)}).catch(function(){}):_e(e)})},[I,we,pe,C,_e]);var Ce=function(e,n){m().setStorageSync(Y,e),m().setStorageSync(j.Wj,JSON.stringify(n))},_e=((0,o.useCallback)(function(e){ye(function(n){var t=new Set(n);return t.add(e),t})},[]),(0,o.useCallback)(function(e){ye(function(n){if(!n.has(e))return n;var t=new Set(n);return t.delete(e),t})},[])),Me=(0,o.useMemo)(function(){if(!s)return{schedule:[],endDate:"",progress:0,completedCount:0,daysBehind:0,behindStageKey:""};for(var e=f()(s),n=e,t=[],a=0,i="",c=0,r=N;c<r.length;c++){var l=r[c],o=C[l.key]||"pending",d=n.format("YYYY-MM-DD"),u=ge[l.key],m=u?f()(u):n.add(l.days,"day"),h=m.format("YYYY-MM-DD"),g=void 0;if("in_progress"===o||"pending"===o){var S=f()();if(S.isAfter(m)){var v=S.diff(m,"day");v>a&&(a=v,i=l.key)}g=Math.max(0,m.diff(f()(),"day"))}t.push({key:l.key,name:l.name,days:l.days,start:d,end:h,status:o,remaining:g}),n=m.add(1,"day")}var x=t.filter(function(e){return"completed"===e.status}).length,p=Math.round(x/N.length*100),y=t.length>0?t[t.length-1].end:"";return{schedule:t,endDate:y,progress:p,completedCount:x,daysBehind:a,behindStageKey:i}},[s,C,ge]),Te=Me.schedule,De=(Me.endDate,Me.progress),Oe=(Me.completedCount,Me.daysBehind),Be=Me.behindStageKey,Pe=function(){var e=(0,r.A)((0,i.A)().m(function e(n){var t,s,a,c,r;return(0,i.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(s=null===(t=n.detail)||void 0===t?void 0:t.value,s){e.n=1;break}return e.a(2);case 1:if(a=f()(s),!a.isBefore(f()(),"day")){e.n=2;break}return m().showToast({title:"\u8bf7\u9009\u62e9\u4eca\u65e5\u53ca\u4ee5\u540e\u7684\u65e5\u671f",icon:"none"}),e.a(2);case 2:if(c=a.format("YYYY-MM-DD"),!I||!we){e.n=8;break}return e.p=3,e.n=4,(0,y.postWithAuth)("/constructions/start-date",{start_date:c});case 4:return h(c),e.n=5,be();case 5:m().showToast({title:"\u8fdb\u5ea6\u8ba1\u5212\u66f4\u65b0\u6210\u529f",icon:"success"}),e.n=7;break;case 6:e.p=6,e.v,m().showToast({title:"\u66f4\u65b0\u5931\u8d25",icon:"none"});case 7:e.n=9;break;case 8:h(c),r=E(),_(r),Ce(c,r),m().showToast({title:"\u8fdb\u5ea6\u8ba1\u5212\u66f4\u65b0\u6210\u529f",icon:"success"});case 9:return e.a(2)}},e,null,[[3,6]])}));return function(n){return e.apply(this,arguments)}}(),Je=function(e){var n=f()().add(e,"day").format("YYYY-MM-DD");if(I&&we)(0,y.postWithAuth)("/constructions/start-date",{start_date:n}).then((0,r.A)((0,i.A)().m(function e(){return(0,i.A)().w(function(e){while(1)switch(e.n){case 0:return h(n),e.n=1,be();case 1:m().showToast({title:"\u8fdb\u5ea6\u8ba1\u5212\u66f4\u65b0\u6210\u529f",icon:"success"});case 2:return e.a(2)}},e)}))).catch(function(){return m().showToast({title:"\u66f4\u65b0\u5931\u8d25",icon:"none"})});else{h(n);var t=E();_(t),Ce(n,t),m().showToast({title:"\u8fdb\u5ea6\u8ba1\u5212\u66f4\u65b0\u6210\u529f",icon:"success"})}},Le=function(e){if(0===e)return!1;var n=C[N[e-1].key];return"completed"!==n&&"rectify_done"!==n},We=function(e,n){var t=0===n;return"completed"===e.status?t?"\u5df2\u6838\u5bf9":"\u5df2\u901a\u8fc7":"rectify"===e.status||"rectify_done"===e.status?"\u5f85\u6574\u6539":(e.status,t?"\u5f85\u4eba\u5de5\u6838\u5bf9":"\u5f85\u9a8c\u6536")},Ke=function(e){var n=N[e],t=Le(e);if(t){var s=1===e?"\u8bf7\u5148\u5b8c\u6210\u6750\u6599\u8fdb\u573a\u4eba\u5de5\u6838\u5bf9":"\u8bf7\u5148\u5b8c\u6210".concat(N[e-1].name,"\u9a8c\u6536");m().showToast({title:s,icon:"none"})}else{var a=0===e;if(a){if(!1===Ye)return void m().showToast({title:"\u8bf7\u5148\u4e0a\u4f20\u62a5\u4ef7\u5355\u4ee5\u83b7\u53d6\u6750\u6599\u6e05\u5355",icon:"none",duration:2500});m().navigateTo({url:"/pages/material-check/index?stage=material&scene=check"}),m().showToast({title:"\u8bf7\u6309\u6e05\u5355\u9010\u9879\u52fe\u9009\u5e76\u62cd\u7167\u7559\u8bc1",icon:"none",duration:2500})}else m().navigateTo({url:"/pages/photo/index?stage=".concat(n.key,"&scene=").concat(b)}),m().showToast({title:"\u8bf7\u62cd\u6444/\u4e0a\u4f20\u65bd\u5de5\u7167\u7247\u5b8c\u6210\u9a8c\u6536",icon:"none",duration:2500})}},Ie=function(){m().setStorageSync("remind_days",ie),m().setStorageSync("smart_remind",oe),te(!1),m().showToast({title:"\u63d0\u9192\u8bbe\u7f6e\u6210\u529f",icon:"success"})},Re=function(e,n,t){var s,i=null===t||void 0===t||null===(s=t.detail)||void 0===s?void 0:s.value;if(i){var r=f()(i),l=f()().startOf("day"),o=f()(n).startOf("day");if(r.isBefore(l))m().showToast({title:"\u8bf7\u9009\u62e9\u5f53\u524d\u65e5\u671f\u53ca\u4ee5\u540e\u7684\u65f6\u95f4",icon:"none",duration:2500});else if(r.isAfter(o)){var d=r.format("YYYY-MM-DD"),u=(0,c.A)((0,c.A)({},ge),{},(0,a.A)({},e,d));Se(u),m().setStorageSync(k,JSON.stringify(u)),ye(function(n){var t=new Set(n);return t.delete(e),t});var h=function(){return m().showToast({title:"\u65f6\u95f4\u6821\u51c6\u6210\u529f\uff0c\u540e\u7eed\u8fdb\u5ea6\u8ba1\u5212\u5df2\u540c\u6b65\u66f4\u65b0",icon:"none",duration:3e3})},g=function(){ye(function(n){return new Set(n).add(e)}),m().showToast({title:"\u65f6\u95f4\u5df2\u7f13\u5b58\uff0c\u8054\u7f51\u540e\u81ea\u52a8\u66f4\u65b0",icon:"none",duration:3e3})};I&&we?constructionApi.calibrateStageEnd(e,d).then(h).catch(g):h()}else m().showToast({title:"\u6821\u51c6\u65f6\u95f4\u987b\u5927\u4e8e\u9884\u8ba1\u5f00\u59cb\u65f6\u95f4",icon:"none",duration:2500})}};return J?(0,S.jsxs)(d.Ss,{className:"construction-page",children:[(0,S.jsx)(d.Ss,{className:"nav-bar",children:(0,S.jsx)(d.EY,{className:"nav-title",children:"\u65bd\u5de5\u966a\u4f34"})}),(0,S.jsx)(d.Ss,{className:"loading-wrap",children:(0,S.jsx)(d.EY,{children:"\u52a0\u8f7d\u4e2d\u2026"})})]}):s?(0,S.jsxs)(d.Ss,{className:"construction-page",children:[(0,S.jsxs)(d.Ss,{className:"nav-bar",children:[(0,S.jsx)(d.EY,{className:"nav-back",onClick:function(){return(0,g.XS)(g.w8)},children:"\u8fd4\u56de"}),(0,S.jsx)(d.EY,{className:"nav-title",children:"\u65bd\u5de5\u966a\u4f34"}),(0,S.jsx)(d.Ss,{className:"nav-placeholder"})]}),(0,S.jsx)(d.BM,{scrollY:!0,className:"scroll-body-outer",scrollIntoView:X||void 0,children:(0,S.jsxs)(d.Ss,{className:"scroll-body",children:[(0,S.jsxs)(d.Ss,{className:"date-card",children:[(0,S.jsxs)(d.EY,{className:"date-text",children:["\u5f00\u5de5\u65e5\u671f\uff1a",s]}),(0,S.jsxs)(d.Ss,{className:"date-actions",children:[(0,S.jsx)(d.LC,{mode:"date",value:s,start:f()().format("YYYY-MM-DD"),onChange:Pe,children:(0,S.jsx)(d.EY,{className:"date-edit",children:"\u7f16\u8f91"})}),(0,S.jsxs)(d.Ss,{className:"remind-set",onClick:function(){return te(!0)},children:[(0,S.jsx)(d.EY,{className:"remind-icon",children:"\ud83d\udd14"}),(0,S.jsx)(d.EY,{className:"remind-text",children:"\u63d0\u9192\u8bbe\u7f6e"})]})]})]}),(0,S.jsxs)(d.Ss,{className:"overview-card",children:[(0,S.jsxs)(d.EY,{className:"overview-main",children:["\u6574\u4f53\u8fdb\u5ea6\uff1a",De,"%"]}),Oe>0&&(0,S.jsxs)(d.EY,{className:"overview-warn",children:[(null===(e=N.find(function(e){return e.key===Be}))||void 0===e?void 0:e.name)||"\u5f53\u524d","\u9636\u6bb5\u843d\u540e\u8ba1\u5212",Oe,"\u5929"]}),(0,S.jsx)(d.EY,{className:"overview-remind",children:"\u5f85\u63d0\u9192\u4e8b\u9879\u5c06\u663e\u793a\u4e8e\u6b64"})]}),(0,S.jsx)(d.Ss,{className:"stages",children:Te.map(function(e,n){var t=Le(n),s=0===n,a=s&&!1===Ye,i="completed"===e.status?100:"in_progress"===e.status||"rectify"===e.status||"rectify_done"===e.status?50:0,c=f()(),r=f()(e.start).diff(c,"day"),l=f()(e.end).diff(c,"day"),o="completed"!==e.status&&r>=0&&r<=ie||l>=0&&l<=ie;return(0,S.jsxs)(d.Ss,{id:"stage-".concat(n),className:"stage-card ".concat(G===n?"stage-card-highlight":""),children:[o&&(0,S.jsx)(d.Ss,{className:"stage-reddot"}),(0,S.jsxs)(d.Ss,{className:"stage-header",children:[(0,S.jsxs)(d.Ss,{className:"stage-name-row",children:[(0,S.jsx)(d.EY,{className:"stage-icon",children:N[n].icon}),(0,S.jsxs)(d.EY,{className:"stage-name",children:[N[n].label," ",e.name]}),(0,S.jsx)(d.Ss,{className:"status-badge ".concat(e.status),children:(0,S.jsx)(d.EY,{children:We(e,n)})})]}),(0,S.jsxs)(d.EY,{className:"stage-plan-time",children:[e.start," ~ ",e.end,pe.has(e.key)&&(0,S.jsx)(d.EY,{className:"stage-pending-sync",children:"\uff08\u5f85\u540c\u6b65\uff09"})]})]}),(0,S.jsx)(d.Ss,{className:"progress-bar-wrap",children:(0,S.jsx)(d.Ss,{className:"progress-fill ".concat(e.status),style:{width:"".concat(i,"%")}})}),(0,S.jsxs)(d.Ss,{className:"stage-actions",children:[(0,S.jsxs)(d.Ss,{className:"actions-left",children:[(0,S.jsx)(d.EY,{className:"action-item ".concat(t||a?"disabled":""),onClick:function(){t?m().showToast({title:1===n?"\u8bf7\u5148\u5b8c\u6210\u6750\u6599\u8fdb\u573a\u4eba\u5de5\u6838\u5bf9":"\u8bf7\u5148\u5b8c\u6210".concat(N[n-1].name,"\u9a8c\u6536"),icon:"none"}):a?m().showToast({title:"\u8bf7\u5148\u4e0a\u4f20\u62a5\u4ef7\u5355\u4ee5\u83b7\u53d6\u6750\u6599\u6e05\u5355",icon:"none",duration:2500}):Ke(n)},children:s?"\ud83d\udccb \u4eba\u5de5\u6838\u5bf9":"\ud83d\udd0d AI\u9a8c\u6536"}),(0,S.jsx)(d.EY,{className:"action-item ".concat(t?"disabled":""),onClick:function(){t?m().showToast({title:1===n?"\u8bf7\u5148\u5b8c\u6210\u6750\u6599\u8fdb\u573a\u4eba\u5de5\u6838\u5bf9":"\u8bf7\u5148\u5b8c\u6210".concat(N[n-1].name,"\u9a8c\u6536"),icon:"none"}):O(e.key)},children:s?"\ud83d\udccb \u6838\u5bf9\u6307\u5f15":"\ud83d\udccb \u9a8c\u6536\u6307\u5f15"})]}),(0,S.jsxs)(d.Ss,{className:"actions-right",children:[t||"in_progress"!==e.status&&"pending"!==e.status?null:(0,S.jsx)(d.LC,{mode:"date",value:e.end,start:f()().format("YYYY-MM-DD"),onChange:function(n){return Re(e.key,e.start,n)},children:(0,S.jsx)(d.EY,{className:"link-txt",children:"\u8c03\u6574\u65f6\u95f4"})}),(0,S.jsx)(d.Ss,{className:"btn-done ".concat("completed"===e.status?"active":""),children:(0,S.jsx)(d.EY,{children:We(e,n)})})]})]}),"completed"===e.status&&(0,S.jsxs)(d.Ss,{className:"record-panel",children:[(0,S.jsxs)(d.EY,{className:"record-text",children:[e.name,"\u8bb0\u5f55\uff1a\u5df2\u901a\u8fc7"]}),(0,S.jsx)(d.EY,{className:"link-txt",onClick:function(){t?m().showToast({title:1===n?"\u8bf7\u5148\u5b8c\u6210\u6750\u6599\u8fdb\u573a\u4eba\u5de5\u6838\u5bf9":"\u8bf7\u5148\u5b8c\u6210".concat(N[n-1].name,"\u9a8c\u6536"),icon:"none"}):m().navigateTo({url:s?"/pages/material-check/index?stage=material":"/pages/acceptance/index?stage=".concat(e.key)})},children:"\u67e5\u770b\u53f0\u8d26/\u62a5\u544a"})]}),"completed"!==e.status&&(0,S.jsx)(d.Ss,{className:"record-panel",children:(0,S.jsxs)(d.EY,{className:"record-text",children:[e.name,"\u8bb0\u5f55\uff1a","rectify"===e.status||"rectify_done"===e.status?"\u5f85\u6574\u6539":s?"\u5f85\u4eba\u5de5\u6838\u5bf9":"\u5f85\u9a8c\u6536"]})})]},e.key)})}),(0,S.jsx)(d.Ss,{className:"share-wrap",children:(0,S.jsx)(d.Ss,{className:"btn-share",onClick:function(){return m().navigateTo({url:"/pages/progress-share/index"})},children:(0,S.jsx)(d.EY,{children:"\u4e00\u952e\u5206\u4eab\u8fdb\u5ea6"})})})]})}),ne&&(0,S.jsx)(d.Ss,{className:"remind-modal-mask",onClick:function(){return te(!1)},children:(0,S.jsxs)(d.Ss,{className:"remind-modal",onClick:function(e){return e.stopPropagation()},children:[(0,S.jsx)(d.EY,{className:"remind-modal-title",children:"\u63d0\u9192\u8bbe\u7f6e"}),(0,S.jsxs)(d.Ss,{className:"remind-row",children:[(0,S.jsx)(d.EY,{children:"\u667a\u80fd\u63d0\u9192\u603b\u5f00\u5173"}),(0,S.jsx)(d.Ss,{className:"switch-wrap ".concat(oe?"on":""),onClick:function(){return de(!oe)},children:(0,S.jsx)(d.EY,{className:"switch-dot",style:{marginLeft:oe?"40rpx":"0"}})})]}),(0,S.jsxs)(d.Ss,{className:"remind-row",children:[(0,S.jsx)(d.EY,{children:"\u63d0\u9192\u63d0\u524d\u5929\u6570"}),(0,S.jsx)(d.LC,{mode:"selector",range:w,value:w.indexOf(ie),onChange:function(e){var n;return ce(null!==(n=w[Number(e.detail.value)])&&void 0!==n?n:3)},children:(0,S.jsxs)(d.EY,{className:"picker-text",children:[ie,"\u5929"]})})]}),(0,S.jsx)(d.Ss,{className:"remind-save-btn",onClick:Ie,children:(0,S.jsx)(d.EY,{children:"\u4fdd\u5b58\u8bbe\u7f6e"})})]})}),(0,S.jsx)(p,{stageKey:D||"material",visible:!!D,onClose:function(){return O(null)}})]}):(0,S.jsxs)(d.Ss,{className:"construction-page",children:[(0,S.jsxs)(d.Ss,{className:"nav-bar",children:[(0,S.jsx)(d.EY,{className:"nav-back",onClick:function(){return(0,g.XS)(g.w8)},children:"\u8fd4\u56de"}),(0,S.jsx)(d.EY,{className:"nav-title",children:"\u65bd\u5de5\u966a\u4f34"}),(0,S.jsx)(d.Ss,{className:"nav-placeholder"})]}),(0,S.jsxs)(d.Ss,{className:"empty-state",children:[(0,S.jsx)(d.EY,{className:"empty-icon",children:"\ud83d\udcc5"}),(0,S.jsx)(d.EY,{className:"empty-text",children:"\u8bf7\u5148\u8bbe\u7f6e\u5f00\u5de5\u65e5\u671f"}),(0,S.jsxs)(d.Ss,{className:"date-card empty",children:[(0,S.jsx)(d.EY,{className:"date-label",children:"\u8bbe\u7f6e\u5f00\u5de5\u65e5\u671f"}),(0,S.jsxs)(d.Ss,{className:"date-actions",children:[(0,S.jsxs)(d.Ss,{className:"remind-set",onClick:function(){return te(!0)},children:[(0,S.jsx)(d.EY,{className:"remind-icon",children:"\ud83d\udd14"}),(0,S.jsx)(d.EY,{className:"remind-text",children:"\u63d0\u9192\u8bbe\u7f6e"})]}),(0,S.jsx)(d.Ss,{className:"quick-date-row",children:[7,15,30].map(function(e){return(0,S.jsx)(d.Ss,{className:"quick-btn",onClick:function(){return Je(e)},children:(0,S.jsxs)(d.EY,{children:[e,"\u5929\u540e\u5f00\u5de5"]})},e)})}),(0,S.jsx)(d.LC,{mode:"date",value:f()().format("YYYY-MM-DD"),start:f()().format("YYYY-MM-DD"),onChange:Pe,children:(0,S.jsx)(d.Ss,{className:"set-date-btn",children:(0,S.jsx)(d.EY,{children:"\u9009\u62e9\u5176\u4ed6\u65e5\u671f"})})})]})]})]}),ne&&(0,S.jsx)(d.Ss,{className:"remind-modal-mask",onClick:function(){return te(!1)},children:(0,S.jsxs)(d.Ss,{className:"remind-modal",onClick:function(e){return e.stopPropagation()},children:[(0,S.jsx)(d.EY,{className:"remind-modal-title",children:"\u63d0\u9192\u8bbe\u7f6e"}),(0,S.jsxs)(d.Ss,{className:"remind-row",children:[(0,S.jsx)(d.EY,{children:"\u667a\u80fd\u63d0\u9192\u603b\u5f00\u5173"}),(0,S.jsx)(d.Ss,{className:"switch-wrap ".concat(oe?"on":""),onClick:function(){return de(!oe)},children:(0,S.jsx)(d.EY,{className:"switch-dot",style:{marginLeft:oe?"40rpx":"0"}})})]}),(0,S.jsxs)(d.Ss,{className:"remind-row",children:[(0,S.jsx)(d.EY,{children:"\u63d0\u9192\u63d0\u524d\u5929\u6570"}),(0,S.jsx)(d.LC,{mode:"selector",range:w,value:w.indexOf(ie),onChange:function(e){var n;return ce(null!==(n=w[Number(e.detail.value)])&&void 0!==n?n:3)},children:(0,S.jsxs)(d.EY,{className:"picker-text",children:[ie,"\u5929"]})})]}),(0,S.jsx)(d.Ss,{className:"remind-save-btn",onClick:Ie,children:(0,S.jsx)(d.EY,{children:"\u4fdd\u5b58\u8bbe\u7f6e"})})]})})]})},_=C,M={navigationBarTitleText:"\u65bd\u5de5\u966a\u4f34",navigationBarBackgroundColor:"#1677FF",navigationBarTextStyle:"white",enablePullDownRefresh:!0};Page((0,s.createPageConfig)(_,"pages/construction/index",{root:{cn:[]}},M||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[6907,8096,2076],function(){return n(1691)});e.O()}]);