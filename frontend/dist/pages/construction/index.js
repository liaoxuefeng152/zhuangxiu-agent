"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[398],{1691:function(e,n,t){var s=t(7842),a=t(4467),i=t(1212),c=t(9379),r=t(467),l=t(5544),o=t(6540),d=t(118),u=t(758),m=t.n(u),h=t(4353),f=t.n(h),g=t(1281),v=t(4848),S={material:{title:"S00 \u6750\u6599\u8fdb\u573a\u6838\u5bf9\u6307\u5f15",points:["1. \u6838\u5bf9\u6750\u6599\u6e05\u5355\u4e0e\u5408\u540c/\u62a5\u4ef7\u5355\u662f\u5426\u4e00\u81f4","2. \u54c1\u724c\u3001\u89c4\u683c\u3001\u6570\u91cf\u9010\u4e00\u5bf9\u7167","3. \u5fc5\u62cd\uff1a\u6750\u6599\u6e05\u5355+\u5b9e\u7269\u5bf9\u6bd4\u7167","4. \u4e0d\u5408\u683c\u9879\u8bb0\u5f55\u5e76\u8981\u6c42\u66f4\u6362"]},plumbing:{title:"S01 \u9690\u853d\u5de5\u7a0b\u9a8c\u6536\u8981\u70b9",points:["1. \u5f3a\u7535\u4e0e\u5f31\u7535\u95f4\u8ddd\u226530cm\uff0c\u4ea4\u53c9\u5904\u9521\u7b94\u7eb8\u5c4f\u853d","2. \u7ebf\u7ba1\u5f2f\u66f2\u534a\u5f84\u22656\u500d\u7ba1\u5f84\uff0c\u65e0\u6b7b\u5f2f","3. \u7535\u7ebf\u63a5\u5934\u6302\u9521\u6216\u4f7f\u7528\u63a5\u7ebf\u7aef\u5b50","4. \u6c34\u7ba1\u6253\u538b0.6-0.8MPa\uff0c30\u5206\u949f\u538b\u964d\u22640.05MPa","5. \u51b7\u70ed\u6c34\u7ba1\u5de6\u70ed\u53f3\u51b7\uff0c\u95f4\u8ddd\u226515cm"]},water_electric:{title:"\u6c34\u7535\u9a8c\u6536\u8981\u70b9",points:["1. \u5f3a\u7535\u4e0e\u5f31\u7535\u95f4\u8ddd\u226530cm\uff0c\u4ea4\u53c9\u5904\u9521\u7b94\u7eb8\u5c4f\u853d","2. \u7ebf\u7ba1\u5f2f\u66f2\u534a\u5f84\u22656\u500d\u7ba1\u5f84\uff0c\u65e0\u6b7b\u5f2f","3. \u7535\u7ebf\u63a5\u5934\u6302\u9521\u6216\u4f7f\u7528\u63a5\u7ebf\u7aef\u5b50","4. \u6c34\u7ba1\u6253\u538b0.6-0.8MPa\uff0c30\u5206\u949f\u538b\u964d\u22640.05MPa","5. \u51b7\u70ed\u6c34\u7ba1\u5de6\u70ed\u53f3\u51b7\uff0c\u95f4\u8ddd\u226515cm"]},carpentry:{title:"S02 \u6ce5\u74e6\u5de5\u9a8c\u6536\u8981\u70b9",points:["1. \u74f7\u7816\u7a7a\u9f13\u7387\u22645%\uff0c\u91cd\u70b9\u68c0\u67e5\u8fb9\u89d2","2. \u540a\u9876\u9f99\u9aa8\u95f4\u8ddd\u7b26\u5408\u89c4\u8303\uff0c\u7262\u56fa\u65e0\u677e\u52a8","3. \u6728\u8d28\u6750\u6599\u505a\u597d\u9632\u6f6e\u9632\u8150\u5904\u7406","4. \u9634\u9633\u89d2\u5782\u76f4\u5ea6\u504f\u5dee\u22643mm"]},woodwork:{title:"S03 \u6728\u5de5\u9a8c\u6536\u8981\u70b9",points:["1. \u540a\u9876\u9f99\u9aa8\u95f4\u8ddd\u7b26\u5408\u89c4\u8303\uff0c\u7262\u56fa\u65e0\u677e\u52a8","2. \u6728\u8d28\u6750\u6599\u9632\u6f6e\u9632\u8150\u5904\u7406\u5230\u4f4d","3. \u9634\u9633\u89d2\u5782\u76f4\u5ea6\u504f\u5dee\u22643mm","4. \u67dc\u4f53\u5b89\u88c5\u7262\u56fa\u3001\u95e8\u7f1d\u5747\u5300"]},masonry_wood:{title:"\u6ce5\u6728\u9a8c\u6536\u8981\u70b9",points:["1. \u74f7\u7816\u7a7a\u9f13\u7387\u22645%\uff0c\u91cd\u70b9\u68c0\u67e5\u8fb9\u89d2","2. \u540a\u9876\u9f99\u9aa8\u95f4\u8ddd\u7b26\u5408\u89c4\u8303\uff0c\u7262\u56fa\u65e0\u677e\u52a8","3. \u6728\u8d28\u6750\u6599\u505a\u597d\u9632\u6f6e\u9632\u8150\u5904\u7406","4. \u9634\u9633\u89d2\u5782\u76f4\u5ea6\u504f\u5dee\u22643mm"]},painting:{title:"S04 \u6cb9\u6f06\u9a8c\u6536\u8981\u70b9",points:["1. \u5899\u9762\u5e73\u6574\uff0c\u65e0\u88c2\u7eb9\u3001\u8d77\u76ae\u3001\u6d41\u5760","2. \u9634\u9633\u89d2\u987a\u76f4\uff0c\u65e0\u7f3a\u68f1\u6389\u89d2","3. \u6d82\u6599\u8272\u6cfd\u5747\u5300\uff0c\u65e0\u8272\u5dee","4. \u6cb9\u6f06\u8868\u9762\u5149\u6ed1\uff0c\u65e0\u9897\u7c92\u3001\u5237\u75d5"]},paint:{title:"\u6cb9\u6f06\u9a8c\u6536\u8981\u70b9",points:["1. \u5899\u9762\u5e73\u6574\uff0c\u65e0\u88c2\u7eb9\u3001\u8d77\u76ae\u3001\u6d41\u5760","2. \u9634\u9633\u89d2\u987a\u76f4\uff0c\u65e0\u7f3a\u68f1\u6389\u89d2","3. \u6d82\u6599\u8272\u6cfd\u5747\u5300\uff0c\u65e0\u8272\u5dee","4. \u6cb9\u6f06\u8868\u9762\u5149\u6ed1\uff0c\u65e0\u9897\u7c92\u3001\u5237\u75d5"]},installation:{title:"S05 \u5b89\u88c5\u6536\u5c3e\u9a8c\u6536\u8981\u70b9",points:["1. \u6a71\u67dc/\u536b\u6d74/\u95e8\u5b89\u88c5\u7262\u56fa\uff0c\u5f00\u5173\u987a\u7545","2. \u4e94\u91d1\u4ef6\u65e0\u7f3a\u5931\u3001\u65e0\u677e\u52a8","3. \u706f\u5177/\u5f00\u5173\u63d2\u5ea7\u901a\u7535\u6b63\u5e38","4. \u6574\u4f53\u4fdd\u6d01\u5b8c\u6210\uff0c\u65e0\u9057\u6f0f"]},floor:{title:"\u5730\u677f\u9a8c\u6536\u8981\u70b9",points:["1. \u5730\u9762\u5e73\u6574\u5ea6\u22643mm/2m","2. \u5730\u677f\u62fc\u63a5\u7d27\u5bc6\uff0c\u65e0\u8d77\u62f1\u3001\u5f02\u54cd","3. \u6536\u8fb9\u6761\u5b89\u88c5\u7262\u56fa\uff0c\u65e0\u7f1d\u9699","4. \u5730\u6696\u533a\u57df\u4f7f\u7528\u4e13\u7528\u5730\u677f"]},soft_furnishing:{title:"\u8f6f\u88c5\u9a8c\u6536\u8981\u70b9",points:["1. \u5b9a\u5236\u5bb6\u5177\u5c3a\u5bf8\u4e0e\u56fe\u7eb8\u4e00\u81f4","2. \u4e94\u91d1\u4ef6\u5b89\u88c5\u7262\u56fa\uff0c\u5f00\u5173\u987a\u7545","3. \u8f6f\u88c5\u6750\u8d28\u65e0\u5f02\u5473\uff0c\u73af\u4fdd\u8fbe\u6807","4. \u6574\u4f53\u98ce\u683c\u534f\u8c03\uff0c\u65e0\u660e\u663e\u7455\u75b5"]},soft:{title:"\u8f6f\u88c5\u9a8c\u6536\u8981\u70b9",points:["1. \u5b9a\u5236\u5bb6\u5177\u5c3a\u5bf8\u4e0e\u56fe\u7eb8\u4e00\u81f4","2. \u4e94\u91d1\u4ef6\u5b89\u88c5\u7262\u56fa\uff0c\u5f00\u5173\u987a\u7545","3. \u8f6f\u88c5\u6750\u8d28\u65e0\u5f02\u5473\uff0c\u73af\u4fdd\u8fbe\u6807","4. \u6574\u4f53\u98ce\u683c\u534f\u8c03\uff0c\u65e0\u660e\u663e\u7455\u75b5"]}},p=function(e){var n=e.stageKey,t=e.visible,s=e.onClose;if(!t)return null;var a=S[n]||S.material||S.plumbing;return(0,v.jsx)(d.Ss,{className:"guide-modal-mask",onClick:s,children:(0,v.jsxs)(d.Ss,{className:"guide-modal",onClick:function(e){return e.stopPropagation()},children:[(0,v.jsx)(d.EY,{className:"close-btn",onClick:s,children:"\xd7"}),(0,v.jsx)(d.EY,{className:"modal-title",children:a.title}),(0,v.jsx)(d.BM,{scrollY:!0,className:"guide-content",children:a.points.map(function(e,n){return(0,v.jsx)(d.EY,{className:"guide-point",children:e},n)})})]})})},x=p,y=t(4746),j=t(5898),N=[{key:"material",name:"\u6750\u6599\u8fdb\u573a\u6838\u5bf9",days:3,label:"S00",icon:"\ud83d\udce6"},{key:"plumbing",name:"\u9690\u853d\u5de5\u7a0b",days:7,label:"S01",icon:"\ud83d\udd0c"},{key:"carpentry",name:"\u6ce5\u74e6\u5de5",days:10,label:"S02",icon:"\ud83e\uddf1"},{key:"woodwork",name:"\u6728\u5de5",days:7,label:"S03",icon:"\ud83e\ude9a"},{key:"painting",name:"\u6cb9\u6f06",days:7,label:"S04",icon:"\ud83d\udd8c\ufe0f"},{key:"installation",name:"\u5b89\u88c5\u6536\u5c3e",days:5,label:"S05",icon:"\ud83d\udd27"}],Y=(N.reduce(function(e,n){return e+n.days},0),"construction_start_date"),k="construction_stage_calibrate",w=[1,2,3,5,7],b="accept",E=function(){var e={};return N.forEach(function(n){e[n.key]="pending"}),e},_=function(e,n){return"rectify"===n?"need_rectify":"completed"===n?(0,j.PR)(e):null},A=function(){var e,n=(0,o.useState)(""),t=(0,l.A)(n,2),s=t[0],h=t[1],S=(0,o.useState)(E()),p=(0,l.A)(S,2),A=p[0],C=p[1],M=(0,o.useState)(null),T=(0,l.A)(M,2),D=T[0],O=T[1],B=(0,o.useState)(!0),P=(0,l.A)(B,2),J=P[0],L=P[1],W=(0,o.useState)(!1),I=(0,l.A)(W,2),K=I[0],R=I[1],q=(0,o.useState)(null),z=(0,l.A)(q,2),F=z[0],X=z[1],V=(0,o.useState)(null),$=(0,l.A)(V,2),G=$[0],H=$[1],Q=(0,o.useState)(null),U=(0,l.A)(Q,2),Z=(U[0],U[1],(0,o.useState)(!1)),ee=(0,l.A)(Z,2),ne=ee[0],te=ee[1],se=(0,o.useState)(3),ae=(0,l.A)(se,2),ie=ae[0],ce=ae[1],re=(0,o.useState)(!0),le=(0,l.A)(re,2),oe=le[0],de=le[1],ue=(0,o.useState)(""),me=(0,l.A)(ue,2),he=(me[0],me[1],(0,o.useState)({})),fe=(0,l.A)(he,2),ge=fe[0],ve=fe[1],Se=(0,o.useState)(new Set),pe=(0,l.A)(Se,2),xe=pe[0],ye=pe[1],je=(0,o.useState)(null),Ne=(0,l.A)(je,2),Ye=Ne[0],ke=Ne[1],we=(0,o.useState)({}),be=(0,l.A)(we,2),Ee=be[0],_e=be[1],Ae=(0,o.useState)([]),Ce=(0,l.A)(Ae,2),Me=Ce[0],Te=Ce[1],De=!!m().getStorageSync("access_token"),Oe=(0,o.useCallback)((0,r.A)((0,i.A)().m(function e(){var n,t,s,a,r,l,o,d,u,g,v,S,p,x,w,b,_,A,M,T,D,O,B,P,J,W,I;return(0,i.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(De){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,(0,y.getWithAuth)("/constructions/schedule");case 2:return s=e.v,a=null!==(n=null===s||void 0===s?void 0:s.data)&&void 0!==n?n:s,r=null!==(t=null===a||void 0===a?void 0:a.stages)&&void 0!==t?t:{},l=E(),o={},d={},N.forEach(function(e){var n,t,s,a=(0,j.Ax)(e.key),i=null===(n=r[a])||void 0===n?void 0:n.status,c=null===(t=r[a])||void 0===t?void 0:t.locked;"boolean"===typeof c&&(d[e.key]=c),l[e.key]=(0,j.$f)(i,e.key),null!==(s=r[a])&&void 0!==s&&s.end_date&&(o[e.key]=f()(r[a].end_date).format("YYYY-MM-DD"))}),_e(d),null!==a&&void 0!==a&&a.start_date?(u=f()(a.start_date).format("YYYY-MM-DD"),h(u),Je(u,l)):(h(""),m().removeStorageSync(Y),m().setStorageSync(j.Wj,JSON.stringify(l))),C(l),ye(new Set),Object.keys(o).length>0&&ve(function(e){return(0,c.A)((0,c.A)({},e),o)}),R(!0),y.materialChecksApi.getMaterialList().then(function(e){var n,t,s,a=null!==(n=null!==(t=null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.list)&&void 0!==t?t:null===e||void 0===e?void 0:e.list)&&void 0!==n?n:[];ke(Array.isArray(a)&&a.length>0)}).catch(function(){return ke(!1)}),e.p=3,S=f()().format("YYYY-MM-DD"),e.n=4,(0,y.getWithAuth)("/constructions/reminder-schedule?date=".concat(S));case 4:p=e.v,x=null!==(g=null===p||void 0===p?void 0:p.data)&&void 0!==g?g:p,w=null!==(v=null===x||void 0===x?void 0:x.list)&&void 0!==v?v:[],Te(w),e.n=6;break;case 5:e.p=5,W=e.v,console.warn("\u83b7\u53d6\u63d0\u9192\u6570\u636e\u5931\u8d25:",W),Te([]);case 6:e.n=8;break;case 7:if(e.p=7,I=e.v,T=404===(null===I||void 0===I?void 0:I.statusCode)||404===(null===I||void 0===I||null===(b=I.response)||void 0===b?void 0:b.status)||(null===I||void 0===I||null===(_=I.message)||void 0===_?void 0:_.includes("404")),D=401===(null===I||void 0===I?void 0:I.statusCode)||401===(null===I||void 0===I||null===(A=I.response)||void 0===A?void 0:A.status)||(null===I||void 0===I||null===(M=I.message)||void 0===M?void 0:M.includes("\u8bf7\u7a0d\u540e\u91cd\u8bd5"))||(null===I||void 0===I?void 0:I.isSilent),T||D){if(O=m().getStorageSync(Y),B=m().getStorageSync(j.Wj),P=m().getStorageSync(k),O&&h(O),B)try{J="string"===typeof B?JSON.parse(B):B,C((0,c.A)((0,c.A)({},E()),J))}catch(e){C(E())}else C(E());if(P)try{ve("string"===typeof P?JSON.parse(P):P)}catch(e){}}R(!1);case 8:return e.p=8,L(!1),e.f(8);case 9:return e.a(2)}},e,null,[[3,5],[1,7,8,9]])})),[De]),Be=(0,o.useCallback)(function(){var e=m().getStorageSync(Y),n=m().getStorageSync(j.Wj),t=m().getStorageSync(k);if(e&&h(e),n)try{var s="string"===typeof n?JSON.parse(n):n;C((0,c.A)((0,c.A)({},E()),s))}catch(e){C(E())}else C(E());if(t)try{ve("string"===typeof t?JSON.parse(t):t)}catch(e){}var a=m().getStorageSync("remind_days");"number"===typeof a&&w.includes(a)&&ce(a);var i=m().getStorageSync("smart_remind");"boolean"===typeof i&&de(i),R(!1),L(!1)},[]);(0,o.useEffect)(function(){De?Oe():Be()},[De,Oe,Be]),(0,u.useDidShow)(function(){if(De?Oe():Be(),s){var e=null,n=m().getStorageSync("construction_scroll_stage");void 0!==n&&""!==n&&null!==n&&(e="number"===typeof n?n:parseInt(String(n),10),m().removeStorageSync("construction_scroll_stage"));var t=m().getStorageSync("calendar_go_to_stage_index");(null===e||isNaN(e)||e<0)&&void 0!==t&&""!==t&&null!==t&&(e="number"===typeof t?t:parseInt(String(t),10),m().removeStorageSync("calendar_go_to_stage_index")),null!=e&&!isNaN(e)&&e>=0&&e<N.length&&(X("stage-".concat(e)),H(e),setTimeout(function(){H(null),X(null)},3500))}});var Pe=(0,o.useRef)(!0);(0,o.useEffect)(function(){return Pe.current=!0,function(){Pe.current=!1}},[]),(0,o.useEffect)(function(){if(s){var e=null,n=m().getStorageSync("construction_scroll_stage");if(void 0!==n&&""!==n&&null!==n&&(e="number"===typeof n?n:parseInt(String(n),10),m().removeStorageSync("construction_scroll_stage")),null===e||isNaN(e)||e<0){var t=m().getStorageSync("calendar_go_to_stage_index");void 0!==t&&""!==t&&null!==t&&(e="number"===typeof t?t:parseInt(String(t),10),m().removeStorageSync("calendar_go_to_stage_index"))}if(null!=e&&!isNaN(e)&&e>=0&&e<N.length){X("stage-".concat(e)),H(e);var a=setTimeout(function(){Pe.current&&(H(null),X(null))},3500);return function(){return clearTimeout(a)}}}},[s]),(0,o.useEffect)(function(){K&&De&&0!==xe.size&&xe.forEach(function(e){var n=_(e,A[e]);n?(0,y.putWithAuth)("/constructions/stage-status",{stage:(0,j.Ax)(e),status:n}).then(function(){(0,j.li)(e,n),Le(e)}).catch(function(){}):Le(e)})},[K,De,xe,A,Le]);var Je=function(e,n){m().setStorageSync(Y,e),m().setStorageSync(j.Wj,JSON.stringify(n))},Le=((0,o.useCallback)(function(e){ye(function(n){var t=new Set(n);return t.add(e),t})},[]),(0,o.useCallback)(function(e){ye(function(n){if(!n.has(e))return n;var t=new Set(n);return t.delete(e),t})},[])),We=(0,o.useMemo)(function(){if(!s)return{schedule:[],endDate:"",progress:0,completedCount:0,daysBehind:0,behindStageKey:""};for(var e=f()(s),n=e,t=[],a=0,i="",c=0,r=N;c<r.length;c++){var l=r[c],o=A[l.key]||"pending",d=n.format("YYYY-MM-DD"),u=ge[l.key],m=u?f()(u):n.add(l.days,"day"),h=m.format("YYYY-MM-DD"),g=void 0;if("in_progress"===o||"pending"===o){var v=f()();if(v.isAfter(m)){var S=v.diff(m,"day");S>a&&(a=S,i=l.key)}g=Math.max(0,m.diff(f()(),"day"))}t.push({key:l.key,name:l.name,days:l.days,start:d,end:h,status:o,remaining:g}),n=m.add(1,"day")}var p=t.filter(function(e){return"completed"===e.status}).length,x=Math.round(p/N.length*100),y=t.length>0?t[t.length-1].end:"";return{schedule:t,endDate:y,progress:x,completedCount:p,daysBehind:a,behindStageKey:i}},[s,A,ge]),Ie=We.schedule,Ke=(We.endDate,We.progress),Re=(We.completedCount,We.daysBehind),qe=We.behindStageKey,ze=function(){var e=(0,r.A)((0,i.A)().m(function e(n){var t,s,a,c,r;return(0,i.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(s=null===(t=n.detail)||void 0===t?void 0:t.value,s){e.n=1;break}return e.a(2);case 1:if(a=f()(s),!a.isBefore(f()(),"day")){e.n=2;break}return m().showToast({title:"\u8bf7\u9009\u62e9\u4eca\u65e5\u53ca\u4ee5\u540e\u7684\u65e5\u671f",icon:"none"}),e.a(2);case 2:if(c=a.format("YYYY-MM-DD"),!K||!De){e.n=8;break}return e.p=3,e.n=4,(0,y.postWithAuth)("/constructions/start-date",{start_date:c});case 4:return h(c),e.n=5,Oe();case 5:m().showToast({title:"\u8fdb\u5ea6\u8ba1\u5212\u66f4\u65b0\u6210\u529f",icon:"success"}),e.n=7;break;case 6:e.p=6,e.v,m().showToast({title:"\u66f4\u65b0\u5931\u8d25",icon:"none"});case 7:e.n=9;break;case 8:h(c),r=E(),C(r),Je(c,r),m().showToast({title:"\u8fdb\u5ea6\u8ba1\u5212\u66f4\u65b0\u6210\u529f",icon:"success"});case 9:return e.a(2)}},e,null,[[3,6]])}));return function(n){return e.apply(this,arguments)}}(),Fe=function(e){var n=f()().add(e,"day").format("YYYY-MM-DD");if(K&&De)(0,y.postWithAuth)("/constructions/start-date",{start_date:n}).then((0,r.A)((0,i.A)().m(function e(){return(0,i.A)().w(function(e){while(1)switch(e.n){case 0:return h(n),e.n=1,Oe();case 1:m().showToast({title:"\u8fdb\u5ea6\u8ba1\u5212\u66f4\u65b0\u6210\u529f",icon:"success"});case 2:return e.a(2)}},e)}))).catch(function(){return m().showToast({title:"\u66f4\u65b0\u5931\u8d25",icon:"none"})});else{h(n);var t=E();C(t),Je(n,t),m().showToast({title:"\u8fdb\u5ea6\u8ba1\u5212\u66f4\u65b0\u6210\u529f",icon:"success"})}},Xe=function(e){if(0===e)return!1;if(K&&"boolean"===typeof Ee[N[e].key])return Ee[N[e].key];var n=A[N[e-1].key];return"completed"!==n&&"rectify_done"!==n},Ve=function(e,n){var t=0===n;return"completed"===e.status?t?"\u5df2\u6838\u5bf9":"\u5df2\u901a\u8fc7":"rectify"===e.status||"rectify_done"===e.status?"\u5f85\u6574\u6539":(e.status,t?"\u5f85\u4eba\u5de5\u6838\u5bf9":"\u5f85\u9a8c\u6536")},$e=function(e){var n=N[e],t=Xe(e);if(t){var s=1===e?"\u8bf7\u5148\u5b8c\u6210\u6750\u6599\u8fdb\u573a\u4eba\u5de5\u6838\u5bf9":"\u8bf7\u5148\u5b8c\u6210".concat(N[e-1].name,"\u9a8c\u6536");m().showToast({title:s,icon:"none"})}else{var a=0===e;if(a){if(!1===Ye)return void m().showToast({title:"\u8bf7\u5148\u4e0a\u4f20\u62a5\u4ef7\u5355\u4ee5\u83b7\u53d6\u6750\u6599\u6e05\u5355",icon:"none",duration:2500});m().navigateTo({url:"/pages/material-check/index?stage=material&scene=check"}),m().showToast({title:"\u8bf7\u6309\u6e05\u5355\u9010\u9879\u52fe\u9009\u5e76\u62cd\u7167\u7559\u8bc1",icon:"none",duration:2500})}else m().navigateTo({url:"/pages/photo/index?stage=".concat(n.key,"&scene=").concat(b)}),m().showToast({title:"\u8bf7\u62cd\u6444/\u4e0a\u4f20\u65bd\u5de5\u7167\u7247\u5b8c\u6210\u9a8c\u6536",icon:"none",duration:2500})}},Ge=function(){m().setStorageSync("remind_days",ie),m().setStorageSync("smart_remind",oe),te(!1),m().showToast({title:"\u63d0\u9192\u8bbe\u7f6e\u6210\u529f",icon:"success"})},He=function(e,n,t){var s,i=null===t||void 0===t||null===(s=t.detail)||void 0===s?void 0:s.value;if(i){var r=f()(i),l=f()().startOf("day"),o=f()(n).startOf("day");if(r.isBefore(l))m().showToast({title:"\u8bf7\u9009\u62e9\u5f53\u524d\u65e5\u671f\u53ca\u4ee5\u540e\u7684\u65f6\u95f4",icon:"none",duration:2500});else if(r.isAfter(o)){var d=r.format("YYYY-MM-DD"),u=(0,c.A)((0,c.A)({},ge),{},(0,a.A)({},e,d));ve(u),m().setStorageSync(k,JSON.stringify(u)),ye(function(n){var t=new Set(n);return t.delete(e),t});var h=function(){return m().showToast({title:"\u65f6\u95f4\u6821\u51c6\u6210\u529f\uff0c\u540e\u7eed\u8fdb\u5ea6\u8ba1\u5212\u5df2\u540c\u6b65\u66f4\u65b0",icon:"none",duration:3e3})},g=function(){ye(function(n){return new Set(n).add(e)}),m().showToast({title:"\u65f6\u95f4\u5df2\u7f13\u5b58\uff0c\u8054\u7f51\u540e\u81ea\u52a8\u66f4\u65b0",icon:"none",duration:3e3})};K&&De?y.constructionApi.calibrateStageEnd(e,d).then(h).catch(g):h()}else m().showToast({title:"\u6821\u51c6\u65f6\u95f4\u987b\u5927\u4e8e\u9884\u8ba1\u5f00\u59cb\u65f6\u95f4",icon:"none",duration:2500})}};return J?(0,v.jsxs)(d.Ss,{className:"construction-page",children:[(0,v.jsx)(d.Ss,{className:"nav-bar",children:(0,v.jsx)(d.EY,{className:"nav-title",children:"\u65bd\u5de5\u966a\u4f34"})}),(0,v.jsx)(d.Ss,{className:"loading-wrap",children:(0,v.jsx)(d.EY,{children:"\u52a0\u8f7d\u4e2d\u2026"})})]}):s?(0,v.jsxs)(d.Ss,{className:"construction-page",children:[(0,v.jsxs)(d.Ss,{className:"nav-bar",children:[(0,v.jsx)(d.EY,{className:"nav-back",onClick:function(){return(0,g.XS)(g.w8)},children:"\u8fd4\u56de"}),(0,v.jsx)(d.EY,{className:"nav-title",children:"\u65bd\u5de5\u966a\u4f34"}),(0,v.jsx)(d.Ss,{className:"nav-placeholder"})]}),(0,v.jsx)(d.BM,{scrollY:!0,className:"scroll-body-outer",scrollIntoView:F||void 0,children:(0,v.jsxs)(d.Ss,{className:"scroll-body",children:[(0,v.jsxs)(d.Ss,{className:"date-card",children:[(0,v.jsxs)(d.EY,{className:"date-text",children:["\u5f00\u5de5\u65e5\u671f\uff1a",s]}),(0,v.jsxs)(d.Ss,{className:"date-actions",children:[(0,v.jsx)(d.LC,{mode:"date",value:s,start:f()().format("YYYY-MM-DD"),onChange:ze,children:(0,v.jsx)(d.EY,{className:"date-edit",children:"\u7f16\u8f91"})}),(0,v.jsxs)(d.Ss,{className:"remind-set",onClick:function(){return te(!0)},children:[(0,v.jsx)(d.EY,{className:"remind-icon",children:"\ud83d\udd14"}),(0,v.jsx)(d.EY,{className:"remind-text",children:"\u63d0\u9192\u8bbe\u7f6e"})]})]})]}),(0,v.jsxs)(d.Ss,{className:"overview-card",children:[(0,v.jsxs)(d.EY,{className:"overview-main",children:["\u6574\u4f53\u8fdb\u5ea6\uff1a",Ke,"%"]}),Re>0&&(0,v.jsxs)(d.EY,{className:"overview-warn",children:[(null===(e=N.find(function(e){return e.key===qe}))||void 0===e?void 0:e.name)||"\u5f53\u524d","\u9636\u6bb5\u843d\u540e\u8ba1\u5212",Re,"\u5929"]}),(0,v.jsx)(d.Ss,{className:"overview-remind",children:Me.length>0?(0,v.jsx)(d.Ss,{children:Me.map(function(e,n){var t=N.find(function(n){return(0,j.Ax)(n.key)===e.stage})||N.find(function(n){return n.key===e.stage}),s=t?t.name:e.stage,a="stage_start"===e.event_type?"\u5f00\u59cb":"\u9a8c\u6536";return(0,v.jsxs)(d.EY,{className:"reminder-item",children:[s,"\u9636\u6bb5",a,"\u5c06\u4e8e",e.planned_date,"\u8fdb\u884c\uff0c\u63d0\u524d",e.reminder_days_before,"\u5929\u63d0\u9192"]},n)})}):(0,v.jsx)(d.EY,{children:"\u6682\u65e0\u5f85\u63d0\u9192\u4e8b\u9879"})})]}),(0,v.jsx)(d.Ss,{className:"stages",children:Ie.map(function(e,n){var t=Xe(n),s=0===n,a=s&&!1===Ye,c="completed"===e.status?100:"in_progress"===e.status||"rectify"===e.status||"rectify_done"===e.status?50:0,l=f()(),o=f()(e.start).diff(l,"day"),u=f()(e.end).diff(l,"day"),h="completed"!==e.status&&o>=0&&o<=ie||u>=0&&u<=ie;return(0,v.jsxs)(d.Ss,{id:"stage-".concat(n),className:"stage-card ".concat(G===n?"stage-card-highlight":""),children:[h&&(0,v.jsx)(d.Ss,{className:"stage-reddot"}),(0,v.jsxs)(d.Ss,{className:"stage-header",children:[(0,v.jsxs)(d.Ss,{className:"stage-name-row",children:[(0,v.jsx)(d.EY,{className:"stage-icon",children:N[n].icon}),(0,v.jsxs)(d.EY,{className:"stage-name",children:[N[n].label," ",e.name]}),(0,v.jsx)(d.Ss,{className:"status-badge ".concat(e.status),children:(0,v.jsx)(d.EY,{children:Ve(e,n)})})]}),(0,v.jsxs)(d.EY,{className:"stage-plan-time",children:[e.start," ~ ",e.end,xe.has(e.key)&&(0,v.jsx)(d.EY,{className:"stage-pending-sync",children:"\uff08\u5f85\u540c\u6b65\uff09"})]})]}),(0,v.jsx)(d.Ss,{className:"progress-bar-wrap",children:(0,v.jsx)(d.Ss,{className:"progress-fill ".concat(e.status),style:{width:"".concat(c,"%")}})}),(0,v.jsxs)(d.Ss,{className:"stage-actions",children:[(0,v.jsxs)(d.Ss,{className:"actions-left",children:[(0,v.jsx)(d.EY,{className:"action-item ".concat(t||a?"disabled":""),onClick:function(){t?m().showToast({title:1===n?"\u8bf7\u5148\u5b8c\u6210\u6750\u6599\u8fdb\u573a\u4eba\u5de5\u6838\u5bf9":"\u8bf7\u5148\u5b8c\u6210".concat(N[n-1].name,"\u9a8c\u6536"),icon:"none"}):a?m().showToast({title:"\u8bf7\u5148\u4e0a\u4f20\u62a5\u4ef7\u5355\u4ee5\u83b7\u53d6\u6750\u6599\u6e05\u5355",icon:"none",duration:2500}):$e(n)},children:s?"\ud83d\udccb \u4eba\u5de5\u6838\u5bf9":"\ud83d\udd0d AI\u9a8c\u6536"}),(0,v.jsx)(d.EY,{className:"action-item ".concat(t?"disabled":""),onClick:function(){t?m().showToast({title:1===n?"\u8bf7\u5148\u5b8c\u6210\u6750\u6599\u8fdb\u573a\u4eba\u5de5\u6838\u5bf9":"\u8bf7\u5148\u5b8c\u6210".concat(N[n-1].name,"\u9a8c\u6536"),icon:"none"}):O(e.key)},children:s?"\ud83d\udccb \u6838\u5bf9\u6307\u5f15":"\ud83d\udccb \u9a8c\u6536\u6307\u5f15"})]}),(0,v.jsxs)(d.Ss,{className:"actions-right",children:[t||"in_progress"!==e.status&&"pending"!==e.status?null:(0,v.jsx)(d.LC,{mode:"date",value:e.end,start:f()().format("YYYY-MM-DD"),onChange:function(n){return He(e.key,e.start,n)},children:(0,v.jsx)(d.EY,{className:"link-txt",children:"\u8c03\u6574\u65f6\u95f4"})}),(0,v.jsx)(d.Ss,{className:"btn-done ".concat("completed"===e.status?"active":""),children:(0,v.jsx)(d.EY,{children:Ve(e,n)})})]})]}),"completed"===e.status&&(0,v.jsxs)(d.Ss,{className:"record-panel",children:[(0,v.jsxs)(d.EY,{className:"record-text",children:[e.name,"\u8bb0\u5f55\uff1a\u5df2\u901a\u8fc7"]}),(0,v.jsx)(d.EY,{className:"link-txt",onClick:(0,r.A)((0,i.A)().m(function a(){var c,r,l,o,d,u;return(0,i.A)().w(function(a){while(1)switch(a.p=a.n){case 0:if(!t){a.n=1;break}return m().showToast({title:1===n?"\u8bf7\u5148\u5b8c\u6210\u6750\u6599\u8fdb\u573a\u4eba\u5de5\u6838\u5bf9":"\u8bf7\u5148\u5b8c\u6210".concat(N[n-1].name,"\u9a8c\u6536"),icon:"none"}),a.a(2);case 1:if(!s){a.n=2;break}return m().navigateTo({url:"/pages/material-check/index?stage=material"}),a.a(2);case 2:return a.p=2,a.n=3,y.acceptanceApi.getList({stage:e.key,page:1,page_size:1});case 3:d=a.v,u=null!==(c=null!==(r=null===d||void 0===d||null===(l=d.data)||void 0===l?void 0:l.list)&&void 0!==r?r:null===d||void 0===d?void 0:d.list)&&void 0!==c?c:[],null!==u&&void 0!==u&&u.length&&null!==(o=u[0])&&void 0!==o&&o.id?m().navigateTo({url:"/pages/acceptance/index?stage=".concat(e.key,"&id=").concat(u[0].id)}):m().navigateTo({url:"/pages/acceptance/index?stage=".concat(e.key)}),a.n=5;break;case 4:a.p=4,a.v,m().navigateTo({url:"/pages/acceptance/index?stage=".concat(e.key)});case 5:return a.a(2)}},a,null,[[2,4]])})),children:"\u67e5\u770b\u53f0\u8d26/\u62a5\u544a"})]}),"completed"!==e.status&&(0,v.jsx)(d.Ss,{className:"record-panel",children:(0,v.jsxs)(d.EY,{className:"record-text",children:[e.name,"\u8bb0\u5f55\uff1a","rectify"===e.status||"rectify_done"===e.status?"\u5f85\u6574\u6539":s?"\u5f85\u4eba\u5de5\u6838\u5bf9":"\u5f85\u9a8c\u6536"]})})]},e.key)})}),(0,v.jsx)(d.Ss,{className:"share-wrap",children:(0,v.jsx)(d.Ss,{className:"btn-share",onClick:function(){return m().navigateTo({url:"/pages/progress-share/index"})},children:(0,v.jsx)(d.EY,{children:"\u4e00\u952e\u5206\u4eab\u8fdb\u5ea6"})})})]})}),ne&&(0,v.jsx)(d.Ss,{className:"remind-modal-mask",onClick:function(){return te(!1)},children:(0,v.jsxs)(d.Ss,{className:"remind-modal",onClick:function(e){return e.stopPropagation()},children:[(0,v.jsx)(d.EY,{className:"remind-modal-title",children:"\u63d0\u9192\u8bbe\u7f6e"}),(0,v.jsxs)(d.Ss,{className:"remind-row",children:[(0,v.jsx)(d.EY,{children:"\u667a\u80fd\u63d0\u9192\u603b\u5f00\u5173"}),(0,v.jsx)(d.Ss,{className:"switch-wrap ".concat(oe?"on":""),onClick:function(){return de(!oe)},children:(0,v.jsx)(d.EY,{className:"switch-dot",style:{marginLeft:oe?"40rpx":"0"}})})]}),(0,v.jsxs)(d.Ss,{className:"remind-row",children:[(0,v.jsx)(d.EY,{children:"\u63d0\u9192\u63d0\u524d\u5929\u6570"}),(0,v.jsx)(d.LC,{mode:"selector",range:w,value:w.indexOf(ie),onChange:function(e){var n;return ce(null!==(n=w[Number(e.detail.value)])&&void 0!==n?n:3)},children:(0,v.jsxs)(d.EY,{className:"picker-text",children:[ie,"\u5929"]})})]}),(0,v.jsx)(d.Ss,{className:"remind-save-btn",onClick:Ge,children:(0,v.jsx)(d.EY,{children:"\u4fdd\u5b58\u8bbe\u7f6e"})})]})}),(0,v.jsx)(x,{stageKey:D||"material",visible:!!D,onClose:function(){return O(null)}})]}):(0,v.jsxs)(d.Ss,{className:"construction-page",children:[(0,v.jsxs)(d.Ss,{className:"nav-bar",children:[(0,v.jsx)(d.EY,{className:"nav-back",onClick:function(){return(0,g.XS)(g.w8)},children:"\u8fd4\u56de"}),(0,v.jsx)(d.EY,{className:"nav-title",children:"\u65bd\u5de5\u966a\u4f34"}),(0,v.jsx)(d.Ss,{className:"nav-placeholder"})]}),(0,v.jsxs)(d.Ss,{className:"empty-state",children:[(0,v.jsx)(d.EY,{className:"empty-icon",children:"\ud83d\udcc5"}),(0,v.jsx)(d.EY,{className:"empty-text",children:"\u8bf7\u5148\u8bbe\u7f6e\u5f00\u5de5\u65e5\u671f"}),(0,v.jsxs)(d.Ss,{className:"date-card empty",children:[(0,v.jsx)(d.EY,{className:"date-label",children:"\u8bbe\u7f6e\u5f00\u5de5\u65e5\u671f"}),(0,v.jsxs)(d.Ss,{className:"date-actions",children:[(0,v.jsxs)(d.Ss,{className:"remind-set",onClick:function(){return te(!0)},children:[(0,v.jsx)(d.EY,{className:"remind-icon",children:"\ud83d\udd14"}),(0,v.jsx)(d.EY,{className:"remind-text",children:"\u63d0\u9192\u8bbe\u7f6e"})]}),(0,v.jsx)(d.Ss,{className:"quick-date-row",children:[7,15,30].map(function(e){return(0,v.jsx)(d.Ss,{className:"quick-btn",onClick:function(){return Fe(e)},children:(0,v.jsxs)(d.EY,{children:[e,"\u5929\u540e\u5f00\u5de5"]})},e)})}),(0,v.jsx)(d.LC,{mode:"date",value:f()().format("YYYY-MM-DD"),start:f()().format("YYYY-MM-DD"),onChange:ze,children:(0,v.jsx)(d.Ss,{className:"set-date-btn",children:(0,v.jsx)(d.EY,{children:"\u9009\u62e9\u5176\u4ed6\u65e5\u671f"})})})]})]})]}),ne&&(0,v.jsx)(d.Ss,{className:"remind-modal-mask",onClick:function(){return te(!1)},children:(0,v.jsxs)(d.Ss,{className:"remind-modal",onClick:function(e){return e.stopPropagation()},children:[(0,v.jsx)(d.EY,{className:"remind-modal-title",children:"\u63d0\u9192\u8bbe\u7f6e"}),(0,v.jsxs)(d.Ss,{className:"remind-row",children:[(0,v.jsx)(d.EY,{children:"\u667a\u80fd\u63d0\u9192\u603b\u5f00\u5173"}),(0,v.jsx)(d.Ss,{className:"switch-wrap ".concat(oe?"on":""),onClick:function(){return de(!oe)},children:(0,v.jsx)(d.EY,{className:"switch-dot",style:{marginLeft:oe?"40rpx":"0"}})})]}),(0,v.jsxs)(d.Ss,{className:"remind-row",children:[(0,v.jsx)(d.EY,{children:"\u63d0\u9192\u63d0\u524d\u5929\u6570"}),(0,v.jsx)(d.LC,{mode:"selector",range:w,value:w.indexOf(ie),onChange:function(e){var n;return ce(null!==(n=w[Number(e.detail.value)])&&void 0!==n?n:3)},children:(0,v.jsxs)(d.EY,{className:"picker-text",children:[ie,"\u5929"]})})]}),(0,v.jsx)(d.Ss,{className:"remind-save-btn",onClick:Ge,children:(0,v.jsx)(d.EY,{children:"\u4fdd\u5b58\u8bbe\u7f6e"})})]})})]})},C=A,M={navigationBarTitleText:"\u65bd\u5de5\u966a\u4f34",navigationBarBackgroundColor:"#1677FF",navigationBarTextStyle:"white",enablePullDownRefresh:!0};Page((0,s.createPageConfig)(C,"pages/construction/index",{root:{cn:[]}},M||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[6907,8096,2076],function(){return n(1691)});e.O()}]);