import React from 'react'
import { PropsWithChildren } from 'react'
import { launchApp } from '@tarojs/taro'
import { Provider } from 'react-redux'
import store from './store'
import './app.scss'

/**
 * 装修决策Agent - 应用入口
 */
const App: React.FC<PropsWithChildren> = ({ children }) => {
  // 应用启动
  React.useEffect(() => {
    // 检查首次启动
    const hasOnboarded = Taro.getStorageSync('onboarding_completed')

    if (!hasOnboarded) {
      // 首次启动，跳转到引导页
      Taro.redirectTo({
        url: '/pages/onboarding/index'
      })
    }

    // 请求进度提醒权限
    Taro.requestSubscribeMessage({
      tmplIds: ['your_template_id'],
      success: (res) => {
        console.log('订阅成功', res)
      },
      fail: (err) => {
        console.log('订阅失败', err)
      }
    })
  }, [])

  return (
    <Provider store={store}>
      {children}
    </Provider>
  )
}

export default App
